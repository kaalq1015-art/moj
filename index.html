<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…Ø­Ù„Ù„ Ø§Ù„Ø¹Ø¯Ù„ÙŠ Ø§Ù„Ø¨Ù„Ø§ØªÙŠÙ†ÙŠ | Platinum MOJ Parser</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'IBM Plex Sans Arabic', sans-serif; background: #f8fafc; color: #1e293b; }
        .drop-zone {
            border: 3px dashed #cbd5e1;
            background: #ffffff;
            transition: all 0.3s ease;
            position: relative;
            cursor: pointer;
        }
        .drop-zone:hover, .drop-zone.active {
            border-color: #f97316;
            background: linear-gradient(135deg, #fffbeb 0%, #fff7ed 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(249, 115, 22, 0.1);
        }
        .drop-zone input { position: absolute; inset: 0; opacity: 0; cursor: pointer; }
        .deceased-card {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: white;
            border-radius: 16px;
            position: relative;
            overflow: hidden;
        }
        .agent-row {
            background: linear-gradient(90deg, #ffedd5 0%, #fed7aa 100%) !important;
            border-right: 4px solid #ea580c !important;
            position: relative;
        }
        .agent-row::after {
            content: "â­";
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
        }
        .agent-badge {
            background: linear-gradient(135deg, #fdba74 0%, #f97316 100%);
            color: #7c2d12;
            border: 2px solid #ea580c;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.8rem;
            box-shadow: 0 2px 4px rgba(249, 115, 22, 0.2);
        }
        .clause-box {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 1.25rem;
            font-size: 0.95rem;
            line-height: 1.9;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            color: #475569;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }
        .clause-box.found {
            border-left: 5px solid #10b981;
        }
        .clause-box.not-found {
            border-left: 5px solid #ef4444;
        }
        .loader {
            width: 60px;
            height: 60px;
            border: 6px solid #f97316;
            border-bottom-color: transparent;
            border-radius: 50%;
            display: inline-block;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        .fade-in { animation: fadeIn 0.6s ease-out; }
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(20px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }
        .progress-ring {
            transform: rotate(-90deg);
        }
        .progress-ring-circle {
            transition: stroke-dashoffset 0.5s ease;
        }
        .notification {
            position: fixed;
            top: 24px;
            right: 24px;
            padding: 14px 24px;
            border-radius: 12px;
            font-weight: 600;
            z-index: 1000;
            animation: slideIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .highlight-text {
            background: linear-gradient(120deg, #fef3c7 0%, #fde68a 100%);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }
        .arabic-pattern {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23000000' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen bg-gradient-to-br from-slate-50 to-orange-50">
    <div class="max-w-7xl mx-auto space-y-8">
        <header class="bg-white p-6 md:p-8 rounded-2xl shadow-lg border border-orange-200 flex flex-col md:flex-row justify-between items-center gap-6">
            <div class="text-center md:text-right">
                <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">Ø§Ù„Ù…Ø­Ù„Ù„ Ø§Ù„Ø¹Ø¯Ù„ÙŠ <span class="text-transparent bg-clip-text bg-gradient-to-r from-orange-600 to-amber-500">Ø§Ù„Ø¨Ù„Ø§ØªÙŠÙ†ÙŠ</span></h1>
                <p class="text-gray-600">Ù†Ø¸Ø§Ù… Ø°ÙƒÙŠ Ù…ØªÙ‚Ø¯Ù… Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙˆØªØ­Ù„ÙŠÙ„ ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø­Ø§ÙƒÙ… ÙˆØ§Ù„ÙˆÙƒØ§Ù„Ø§Øª Ø§Ù„Ø´Ø±Ø¹ÙŠØ©</p>
            </div>
            <div class="flex flex-wrap gap-3 justify-center">
                <button onclick="location.reload()" class="px-5 py-2.5 bg-gradient-to-r from-gray-100 to-gray-200 hover:from-gray-200 hover:to-gray-300 rounded-xl text-gray-700 font-semibold shadow-sm transition-all">ğŸ”„ Ø¨Ø¯Ø¡ Ø¬Ø¯ÙŠØ¯</button>
                <button onclick="exportToExcel()" id="exportBtn" class="hidden px-5 py-2.5 bg-gradient-to-r from-emerald-500 to-green-600 hover:from-emerald-600 hover:to-green-700 text-white rounded-xl font-semibold shadow-md transition-all">ğŸ“Š ØªØµØ¯ÙŠØ± Excel</button>
            </div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div id="heirsZone" class="drop-zone p-8 rounded-2xl text-center group relative overflow-hidden">
                <div class="arabic-pattern"></div>
                <input type="file" id="heirsFile" accept="application/pdf,image/*" multiple="false">
                <div class="text-6xl mb-4 opacity-60 group-hover:opacity-100 transition-all duration-300">ğŸ“œ</div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">1. ØµÙƒ Ø­ØµØ± Ø§Ù„ÙˆØ±Ø«Ø©</h3>
                <p id="heirsMsg" class="text-sm text-gray-500">Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„Ù Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</p>
                <div class="mt-4 text-xs text-gray-400">ÙŠØ¯Ø¹Ù…: PDF, JPG, PNG, JPEG</div>
            </div>
            
            <div id="poaZone" class="drop-zone p-8 rounded-2xl text-center group relative overflow-hidden">
                <div class="arabic-pattern"></div>
                <input type="file" id="poaFile" accept="application/pdf,image/*" multiple="false">
                <div class="text-6xl mb-4 opacity-60 group-hover:opacity-100 transition-all duration-300">âš–ï¸</div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">2. ÙˆØ«ÙŠÙ‚Ø© Ø§Ù„ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø´Ø±Ø¹ÙŠØ©</h3>
                <p id="poaMsg" class="text-sm text-gray-500">Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„Ù Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</p>
                <div class="mt-4 text-xs text-gray-400">ÙŠØ¯Ø¹Ù…: PDF, JPG, PNG, JPEG</div>
            </div>
        </div>

        <div id="loadingSection" class="hidden text-center py-12 px-4 bg-white/80 backdrop-blur-sm rounded-2xl shadow-sm">
            <div class="relative inline-block">
                <span class="loader"></span>
                <div class="absolute inset-0 flex items-center justify-center">
                    <span id="progressPercent" class="text-sm font-bold text-orange-600">0%</span>
                </div>
            </div>
            <p id="loadingMessage" class="mt-6 text-lg font-semibold text-gray-700">Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…...</p>
            <div class="mt-6 max-w-2xl mx-auto">
                <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                    <div id="progressBar" class="h-full bg-gradient-to-r from-orange-500 to-amber-500 transition-all duration-300 ease-out" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <div id="resultsSection" class="hidden space-y-8 fade-in">
            <div id="deceasedCard" class="hidden deceased-card p-6 md:p-8 shadow-2xl flex flex-col md:flex-row items-center gap-6 md:gap-8">
                <div class="bg-white/20 p-5 rounded-full text-4xl">âš°ï¸</div>
                <div class="flex-1 text-center md:text-right">
                    <h2 class="text-white/80 text-sm uppercase font-bold tracking-widest mb-2">Ø§Ù„Ù…ÙˆØ±Ø« (Ø§Ù„Ù…ØªÙˆÙÙ‰)</h2>
                    <div class="flex flex-col md:flex-row items-center justify-center md:justify-start gap-4 mt-2">
                        <span id="deceasedId" class="text-4xl md:text-5xl font-mono font-bold text-white tracking-tight">---</span>
                        <div class="flex items-center gap-3">
                            <span class="bg-white/20 text-white text-sm px-3 py-1.5 rounded-lg">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</span>
                            <span id="deceasedName" class="text-white text-lg font-semibold bg-white/10 px-4 py-2 rounded-lg">ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="stat-card">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="p-3 bg-blue-100 rounded-xl">
                            <span class="text-2xl text-blue-600">ğŸ‘¥</span>
                        </div>
                        <h3 class="text-lg font-bold text-gray-800">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</h3>
                    </div>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                            <span class="text-gray-700">Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ±Ø«Ø©</span>
                            <span id="totalHeirs" class="text-2xl font-bold text-blue-600">0</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                            <span class="text-gray-700">Ø§Ù„ÙˆØ±Ø«Ø© Ø§Ù„Ù…ÙˆÙƒÙÙ„ÙŠÙ†</span>
                            <span id="appointedHeirs" class="text-2xl font-bold text-emerald-600">0</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                            <span class="text-gray-700">Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙˆÙƒÙŠÙ„</span>
                            <span id="appointmentRate" class="text-2xl font-bold text-orange-600">0%</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="p-3 bg-amber-100 rounded-xl">
                            <span class="text-2xl text-amber-600">ğŸ“Š</span>
                        </div>
                        <h3 class="text-lg font-bold text-gray-800">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©</h3>
                    </div>
                    <div class="flex justify-center items-center">
                        <div class="relative">
                            <svg class="w-40 h-40" viewBox="0 0 100 100">
                                <circle cx="50" cy="50" r="45" fill="none" stroke="#e2e8f0" stroke-width="10"/>
                                <circle id="matchCircle" cx="50" cy="50" r="45" fill="none" stroke="#10b981" 
                                        stroke-width="10" stroke-linecap="round" 
                                        stroke-dasharray="283" stroke-dashoffset="283"
                                        transform="rotate(-90 50 50)"/>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center flex-col">
                                <span id="matchPercentage" class="text-3xl font-bold text-gray-800">0%</span>
                                <span class="text-sm text-gray-500">Ù…Ø·Ø§Ø¨Ù‚Ø©</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="p-3 bg-red-100 rounded-xl">
                            <span class="text-2xl text-red-600">âœ…</span>
                        </div>
                        <h3 class="text-lg font-bold text-gray-800">Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ÙÙˆØ±ÙŠ</h3>
                    </div>
                    <div class="space-y-3">
                        <div id="checkDeceased" class="flex items-center justify-between p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl border border-gray-200">
                            <span class="text-gray-700 font-medium">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙˆÙÙ‰</span>
                            <span class="text-red-500 text-xl">âŒ</span>
                        </div>
                        <div id="checkAgent" class="flex items-center justify-between p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl border border-gray-200">
                            <span class="text-gray-700 font-medium">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆÙƒÙŠÙ„</span>
                            <span class="text-red-500 text-xl">âŒ</span>
                        </div>
                        <div id="checkClauses" class="flex items-center justify-between p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl border border-gray-200">
                            <span class="text-gray-700 font-medium">Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</span>
                            <span class="text-red-500 text-xl">âŒ</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden">
                <div class="p-6 border-b bg-gradient-to-r from-gray-50 to-gray-100 flex flex-col md:flex-row justify-between items-center gap-4">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-blue-100 rounded-lg">
                            <span class="text-xl text-blue-600">ğŸ‘¥</span>
                        </div>
                        <h2 class="font-bold text-xl text-gray-800">Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙˆØ±Ø«Ø© ÙˆØ§Ù„ÙˆÙƒÙ„Ø§Ø¡</h2>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="filterByRole('agent')" class="px-4 py-2 bg-amber-100 hover:bg-amber-200 text-amber-800 rounded-lg font-medium transition">Ø¹Ø±Ø¶ Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡</button>
                        <button onclick="filterByRole('heir')" class="px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-lg font-medium transition">Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ±Ø«Ø©</button>
                        <button onclick="resetFilter()" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-lg font-medium transition">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-right">
                        <thead class="bg-gray-100 text-gray-700 text-sm uppercase font-bold">
                            <tr>
                                <th class="p-4">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</th>
                                <th class="p-4">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ</th>
                                <th class="p-4">Ø§Ù„ØµÙØ© Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©</th>
                                <th class="p-4">Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ø´Ø±Ø¹ÙŠØ©</th>
                                <th class="p-4 text-center">Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆÙƒÙŠÙ„</th>
                                <th class="p-4 text-center">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="resultsTable" class="divide-y divide-gray-200 text-sm font-medium"></tbody>
                    </table>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="bg-white rounded-2xl shadow-lg border-t-4 border-blue-500 overflow-hidden">
                    <div class="p-5 bg-gradient-to-r from-blue-50 to-blue-100 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-white rounded-lg shadow-sm">
                                <span class="text-2xl text-blue-600">ğŸ </span>
                            </div>
                            <div>
                                <h3 class="font-bold text-blue-900">Ø¨Ù†Ø¯ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</h3>
                                <p class="text-xs text-blue-700">Ø§Ù„Ø¨ÙŠØ¹ØŒ Ø§Ù„Ø¥ÙØ±Ø§ØºØŒ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</p>
                            </div>
                        </div>
                        <div id="estateScore" class="flex items-center gap-2">
                            <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center">
                                <span class="text-blue-800 font-bold">0%</span>
                            </div>
                        </div>
                    </div>
                    <div id="estateText" class="clause-box not-found"></div>
                </div>

                <div class="bg-white rounded-2xl shadow-lg border-t-4 border-red-500 overflow-hidden">
                    <div class="p-5 bg-gradient-to-r from-red-50 to-red-100 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-white rounded-lg shadow-sm">
                                <span class="text-2xl text-red-600">âš–ï¸</span>
                            </div>
                            <div>
                                <h3 class="font-bold text-red-900">Ø¨Ù†Ø¯ Ø§Ù„Ù…Ø­Ø§ÙƒÙ…</h3>
                                <p class="text-xs text-red-700">Ø§Ù„Ù‚Ø³Ù…Ø©ØŒ Ø§Ù„Ù…Ø±Ø§ÙØ¹Ø©ØŒ Ø§Ù„Ø¯Ø¹Ø§ÙˆÙ‰</p>
                            </div>
                        </div>
                        <div id="legalScore" class="flex items-center gap-2">
                            <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center">
                                <span class="text-red-800 font-bold">0%</span>
                            </div>
                        </div>
                    </div>
                    <div id="legalText" class="clause-box not-found"></div>
                </div>

                <div class="bg-white rounded-2xl shadow-lg border-t-4 border-emerald-500 overflow-hidden">
                    <div class="p-5 bg-gradient-to-r from-emerald-50 to-emerald-100 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-white rounded-lg shadow-sm">
                                <span class="text-2xl text-emerald-600">ğŸ’°</span>
                            </div>
                            <div>
                                <h3 class="font-bold text-emerald-900">Ø¨Ù†Ø¯ Ø§Ù„Ù…Ø·Ø§Ù„Ø¨Ø§Øª</h3>
                                <p class="text-xs text-emerald-700">Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø§ØªØŒ Ø§Ù„Ø¯ÙŠÙˆÙ†ØŒ Ø§Ù„ØªØ¹ÙˆÙŠØ¶Ø§Øª</p>
                            </div>
                        </div>
                        <div id="claimsScore" class="flex items-center gap-2">
                            <div class="w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center">
                                <span class="text-emerald-800 font-bold">0%</span>
                            </div>
                        </div>
                    </div>
                    <div id="claimsText" class="clause-box not-found"></div>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg border-t-4 border-amber-500 overflow-hidden">
                <div class="p-5 bg-gradient-to-r from-amber-50 to-amber-100 flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-white rounded-lg shadow-sm">
                            <span class="text-2xl text-amber-600">ğŸ“</span>
                        </div>
                        <div>
                            <h3 class="font-bold text-amber-900">Ù†Ø·Ø§Ù‚ Ø§Ù„ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø´Ø§Ù…Ù„</h3>
                            <p class="text-xs text-amber-700">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§ØªØŒ Ø§Ù„ØªÙÙˆÙŠØ¶ØŒ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</p>
                        </div>
                    </div>
                    <div id="scopeScore" class="flex items-center gap-2">
                        <div class="w-10 h-10 rounded-full bg-amber-100 flex items-center justify-center">
                            <span class="text-amber-800 font-bold">0%</span>
                        </div>
                    </div>
                </div>
                <div id="scopeText" class="clause-box not-found"></div>
            </div>

            <div class="text-center space-y-6 pt-6">
                <div class="flex flex-wrap justify-center gap-4">
                    <button onclick="downloadReport()" class="px-8 py-3.5 bg-gradient-to-r from-orange-500 to-amber-500 hover:from-orange-600 hover:to-amber-600 text-white font-bold rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 flex items-center gap-2">
                        <span>ğŸ“¥</span>
                        <span>ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙƒØ§Ù…Ù„</span>
                    </button>
                    <button onclick="printResults()" class="px-8 py-3.5 bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-bold rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 flex items-center gap-2">
                        <span>ğŸ–¨ï¸</span>
                        <span>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬</span>
                    </button>
                    <button onclick="showAnalysisDetails()" class="px-8 py-3.5 bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white font-bold rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 flex items-center gap-2">
                        <span>ğŸ”</span>
                        <span>ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ­Ù„ÙŠÙ„</span>
                    </button>
                </div>
                <div class="text-sm text-gray-500 max-w-2xl mx-auto p-4 bg-gray-50 rounded-xl border border-gray-200">
                    <div class="flex items-center justify-center gap-2 mb-2">
                        <span class="text-amber-500">âš ï¸</span>
                        <span class="font-semibold text-gray-700">Ù…Ù„Ø§Ø­Ø¸Ø© Ù‡Ø§Ù…Ø©</span>
                    </div>
                    <p>Ù‡Ø°Ø§ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø°Ùˆ Ø·Ø¨ÙŠØ¹Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© ÙˆÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ. ÙŠÙˆØµÙ‰ Ø¨Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø­Ø§Ù…ÙŠ Ø§Ù„Ù…Ø®ØªØµ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© ÙˆØ¯Ù‚Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù‚Ø¨Ù„ Ø£ÙŠ Ø¥Ø¬Ø±Ø§Ø¡ Ù‚Ø§Ù†ÙˆÙ†ÙŠ.</p>
                </div>
            </div>
        </div>
    </div>

    <div id="analysisModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
            <div class="p-6 border-b bg-gradient-to-r from-blue-50 to-blue-100 flex justify-between items-center">
                <h3 class="text-xl font-bold text-gray-800">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠ</h3>
                <button onclick="closeAnalysisDetails()" class="text-2xl text-gray-500 hover:text-gray-700">&times;</button>
            </div>
            <div class="p-6 overflow-y-auto max-h-[70vh]" id="analysisDetails"></div>
        </div>
    </div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        let files = { heirs: null, poa: null };
        let analysisResults = null;
        let extractedTexts = { heirs: '', poa: '' };

        setupDropZone('heirs');
        setupDropZone('poa');

        function setupDropZone(key) {
            const zone = document.getElementById(`${key}Zone`);
            const input = document.getElementById(`${key}File`);
            const msg = document.getElementById(`${key}Msg`);
            
            const activate = () => { 
                zone.classList.add('active');
                zone.style.borderColor = '#f97316';
            };
            
            const deactivate = () => { 
                zone.classList.remove('active');
                zone.style.borderColor = '#cbd5e1';
            };
            
            zone.addEventListener('dragover', (e) => { 
                e.preventDefault(); 
                activate(); 
            });
            
            zone.addEventListener('dragleave', (e) => {
                if (!zone.contains(e.relatedTarget)) {
                    deactivate();
                }
            });
            
            zone.addEventListener('drop', (e) => { 
                e.preventDefault(); 
                if (e.dataTransfer.files.length > 0) {
                    handleFile(e.dataTransfer.files[0], key, msg); 
                }
                deactivate();
            });
            
            input.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFile(e.target.files[0], key, msg);
                }
            });
            
            zone.addEventListener('click', () => {
                input.click();
            });
        }

        function handleFile(file, key, msgElement) {
            if (!file) return;
            
            const validTypes = ['application/pdf', 'image/jpeg', 'image/png', 'image/jpg'];
            if (!validTypes.includes(file.type)) {
                showNotification('Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø±ÙØ¹ Ù…Ù„Ù PDF Ø£Ùˆ ØµÙˆØ±Ø©.', 'error');
                return;
            }
            
            if (file.size > 20 * 1024 * 1024) {
                showNotification('Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 20MB)', 'error');
                return;
            }
            
            files[key] = file;
            msgElement.innerHTML = `
                <div class="space-y-1">
                    <div class="font-bold text-orange-700 truncate">${file.name}</div>
                    <div class="text-green-600 font-medium">âœ… ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­</div>
                    <div class="text-xs text-gray-500">${(file.size / 1024 / 1024).toFixed(2)} MB</div>
                </div>
            `;
            
            if (files.heirs && files.poa) {
                setTimeout(() => processAllFiles(), 800);
            }
        }

        async function processAllFiles() {
            document.getElementById('loadingSection').classList.remove('hidden');
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('exportBtn').classList.add('hidden');
            
            updateProgress(5, 'Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…...');
            
            try {
                updateProgress(15, 'Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© ØµÙƒ Ø§Ù„ÙˆØ±Ø«Ø©...');
                const hText = await extractText(files.heirs, 'heirs');
                extractedTexts.heirs = hText;
                
                updateProgress(40, 'Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© ÙˆØ«ÙŠÙ‚Ø© Ø§Ù„ÙˆÙƒØ§Ù„Ø©...');
                const pText = await extractText(files.poa, 'poa');
                extractedTexts.poa = pText;
                
                updateProgress(60, 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ±Ø«Ø©...');
                const heirsData = analyzeHeirship(hText);
                
                updateProgress(75, 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ ÙˆØ«ÙŠÙ‚Ø© Ø§Ù„ÙˆÙƒØ§Ù„Ø©...');
                const poaData = analyzePOA(pText);
                
                updateProgress(90, 'Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨Ù†ÙˆØ¯ ÙˆØªØ­Ù„ÙŠÙ„Ù‡Ø§...');
                const clausesData = extractAndAnalyzeClauses(pText);
                
                updateProgress(95, 'Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬...');
                
                analysisResults = { 
                    heirsData, 
                    poaData, 
                    clausesData,
                    timestamp: new Date().toISOString()
                };
                
                renderUI(heirsData, poaData, clausesData);
                updateProgress(100, 'Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!');
                
                setTimeout(() => {
                    document.getElementById('loadingSection').classList.add('hidden');
                    document.getElementById('resultsSection').classList.remove('hidden');
                    document.getElementById('exportBtn').classList.remove('hidden');
                    showNotification('âœ… ØªÙ… Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬.', 'success');
                }, 600);
                
            } catch (err) {
                console.error('Error in processing:', err);
                showNotification('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¶ÙˆØ­ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØµØ­ØªÙ‡Ø§.', 'error');
                document.getElementById('loadingSection').classList.add('hidden');
            }
        }

        function analyzeHeirship(text) {
            const normalizedText = normalizeArabicText(text);
            const lines = text.split('\n').filter(line => line.trim().length > 3);
            
            let decId = null;
            let decName = 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            const heirs = [];
            const heirDetails = {};
            const names = {};
            const shares = {};
            
            const idPattern = /\b(1\d{9})\b/g;
            const namePattern = /([\u0600-\u06FF\s]{3,} Ø¨Ù†(Øª)?[\s\u0600-\u06FF]{2,})|([\u0600-\u06FF]{2,}\s[\u0600-\u06FF]{2,}\s[\u0600-\u06FF]{2,})/;
            const sharePattern = /(Ø±Ø¨Ø¹|Ø«Ù„Ø«|Ù†ØµÙ|Ø³Ø¯Ø³|Ø«Ù…Ù†|ØªØ³Ø¹|Ø¹Ø´Ø±|Ø«Ù„Ø«Ø§Ù†|Ù†ØµÙØ§Ù†|Ø³Ø¯Ø³Ø§Ù†)/;
            
            let foundHeirsSection = false;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                const cleanLine = line.trim();
                
                if (cleanLine.includes('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ±Ø«Ø©') || cleanLine.includes('Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ÙˆØ±Ø«Ø©') || 
                    cleanLine.includes('Ø§Ù„ÙˆØ±Ø«Ø©') || cleanLine.includes('Ø§Ù„Ù…Ø³ØªØ­Ù‚ÙŠÙ†')) {
                    foundHeirsSection = true;
                }
                
                const ids = [...cleanLine.matchAll(idPattern)].map(m => m[1]);
                
                for (const id of ids) {
                    if (!decId && (cleanLine.includes('Ù…ØªÙˆÙÙ‰') || cleanLine.includes('ØªØ§Ø±ÙŠØ® Ø§Ù„ÙˆÙØ§Ø©') || 
                        cleanLine.includes('Ø§Ù„Ù…ØªÙˆÙÙ‰') || cleanLine.includes('Ø§Ù„Ù…ÙˆØ±Ø«'))) {
                        decId = id;
                        const nameMatch = cleanLine.match(namePattern);
                        if (nameMatch) {
                            decName = nameMatch[0].trim();
                        }
                    } else if (foundHeirsSection || !decId) {
                        if (!heirs.includes(id) && id !== decId) {
                            heirs.push(id);
                            
                            const nameMatch = cleanLine.match(namePattern);
                            if (nameMatch) {
                                names[id] = nameMatch[0].trim();
                            } else {
                                names[id] = extractNameFromContext(lines, i, id);
                            }
                            
                            const shareMatch = cleanLine.match(sharePattern);
                            shares[id] = shareMatch ? shareMatch[1] : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                            
                            heirDetails[id] = {
                                name: names[id],
                                share: shares[id],
                                isDeceased: false
                            };
                        }
                    }
                }
            }
            
            if (!decId && heirs.length > 0) {
                decId = heirs.shift();
            }
            
            return { 
                decId, 
                decName,
                heirs, 
                heirDetails,
                names, 
                shares,
                totalHeirs: heirs.length
            };
        }

        function analyzePOA(text) {
            const normalizedText = normalizeArabicText(text);
            const lines = text.split('\n').filter(line => line.trim().length > 5);
            
            let agentId = null;
            let agentName = 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            const principals = [];
            const principalDetails = [];
            
            const idPattern = /\b(1\d{9})\b/g;
            const agentKeywords = ['ÙˆÙƒÙŠÙ„', 'Ø§Ù„ÙˆÙƒÙŠÙ„', 'Ù…ÙÙˆØ¶', 'Ø§Ù„Ù…ÙÙˆØ¶', 'Ù†ÙŠØ§Ø¨Ø©', 'Ø§Ù„Ù†ÙŠØ§Ø¨Ø©'];
            const principalKeywords = ['Ù…ÙˆÙƒÙ„', 'Ø§Ù„Ù…ÙˆÙƒÙ„', 'Ø¹Ù† Ù†ÙØ³Ù‡', 'Ø§ØµÙ„ÙŠÙ‡', 'Ø£ØµÙŠÙ„Ù‡'];
            
            let inAgentSection = false;
            let inPrincipalSection = false;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                const cleanLine = line.trim();
                const normalizedLine = normalizeArabicText(cleanLine);
                
                if (agentKeywords.some(kw => normalizedLine.includes(kw))) {
                    inAgentSection = true;
                    inPrincipalSection = false;
                }
                
                if (principalKeywords.some(kw => normalizedLine.includes(kw))) {
                    inPrincipalSection = true;
                    inAgentSection = false;
                }
                
                const ids = [...cleanLine.matchAll(idPattern)].map(m => m[1]);
                
                for (const id of ids) {
                    if (inAgentSection && !agentId) {
                        agentId = id;
                        agentName = extractNameFromContext(lines, i, id) || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                    } else if (inPrincipalSection || (!agentId && ids.length > 1)) {
                        if (id !== agentId && !principals.includes(id)) {
                            principals.push(id);
                            principalDetails.push({
                                id: id,
                                name: extractNameFromContext(lines, i, id) || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'
                            });
                        }
                    }
                }
            }
            
            return { 
                agentId, 
                agentName,
                principals,
                principalDetails,
                totalPrincipals: principals.length
            };
        }

        function extractAndAnalyzeClauses(text) {
            const normalizedText = normalizeArabicText(text);
            const paragraphs = text.split(/\n\s*\n/).filter(p => p.length > 20);
            
            const estateKeywords = [
                'Ø¹Ù‚Ø§Ø±', 'Ø¹Ù‚Ø§Ø±Ø§Øª', 'Ø¨ÙŠØ¹', 'Ø´Ø±Ø§Ø¡', 'Ø¥ÙØ±Ø§Øº', 'ØªØ³Ø¬ÙŠÙ„', 'Ø±Ù‡Ù†', 'ØªØ£Ø¬ÙŠØ±',
                'Ø´ÙŠÙƒ', 'Ø«Ù…Ù†', 'Ù…Ø¨Ù„Øº', 'Ù…Ø´ØªØ±', 'Ø¨Ø§Ø¦Ø¹', 'Ø³Ø¬Ù„ Ø¹Ù‚Ø§Ø±ÙŠ', 'Ø·Ø§Ø¨Ùˆ'
            ];
            
            const legalKeywords = [
                'Ù…Ø­ÙƒÙ…Ø©', 'Ù…Ø­Ø§ÙƒÙ…', 'Ø¯Ø¹ÙˆÙ‰', 'Ø¯Ø¹Ø§ÙˆÙ‰', 'Ù‚Ø³Ù…Ø©', 'ØªØ±ÙƒØ©', 'Ù†Ø²Ø§Ø¹',
                'Ù…Ø±Ø§ÙØ¹Ø©', 'Ø­ÙƒÙ…', 'Ù‚Ø§Ø¶ÙŠ', 'Ø§Ø³ØªØ¦Ù†Ø§Ù', 'ØªÙ…ÙŠÙŠØ²', 'ØªÙ†ÙÙŠØ°'
            ];
            
            const claimsKeywords = [
                'Ù…Ø·Ø§Ù„Ø¨Ø©', 'Ù…Ø·Ø§Ù„Ø¨Ø§Øª', 'Ø¯ÙŠÙ†', 'Ø¯ÙŠÙˆÙ†', 'Ù…Ø³ØªØ­Ù‚Ø§Øª', 'Ø£Ù…ÙˆØ§Ù„',
                'ÙˆØ¯ÙŠØ¹Ø©', 'Ù…Ø¨Ù„Øº', 'ØªØ¹ÙˆÙŠØ¶', 'Ù…Ø³ØªØ­Ù‚', 'Ø­Ù‚', 'Ù…Ø³ØªØ­Ù‚Ù‡'
            ];
            
            const scopeKeywords = [
                'Ù†Ø·Ø§Ù‚', 'ØµÙ„Ø§Ø­ÙŠØ©', 'ØªÙÙˆÙŠØ¶', 'ÙˆÙƒØ§Ù„Ø©', 'Ø¥Ø¯Ø§Ø±Ø©', 'ØªØµØ±Ù',
                'ØªÙˆØ²ÙŠØ¹', 'Ø¨ÙŠØ¹', 'Ø´Ø±Ø§Ø¡', 'Ø§Ø³ØªÙ„Ø§Ù…', 'ØªØ³Ù„Ù…', 'Ø¥Ø¨Ø±Ø§Ù…'
            ];
            
            let estateText = '';
            let legalText = '';
            let claimsText = '';
            let scopeText = '';
            
            let estateScore = 0;
            let legalScore = 0;
            let claimsScore = 0;
            let scopeScore = 0;
            
            paragraphs.forEach(para => {
                const normalizedPara = normalizeArabicText(para);
                
                estateKeywords.forEach(keyword => {
                    if (normalizedPara.includes(keyword)) {
                        if (para.length > estateText.length) {
                            estateText = para;
                        }
                        estateScore += 5;
                    }
                });
                
                legalKeywords.forEach(keyword => {
                    if (normalizedPara.includes(keyword)) {
                        if (para.length > legalText.length) {
                            legalText = para;
                        }
                        legalScore += 5;
                    }
                });
                
                claimsKeywords.forEach(keyword => {
                    if (normalizedPara.includes(keyword)) {
                        if (para.length > claimsText.length) {
                            claimsText = para;
                        }
                        claimsScore += 5;
                    }
                });
                
                scopeKeywords.forEach(keyword => {
                    if (normalizedPara.includes(keyword)) {
                        if (para.length > scopeText.length) {
                            scopeText = para;
                        }
                        scopeScore += 5;
                    }
                });
            });
            
            estateScore = Math.min(estateScore, 100);
            legalScore = Math.min(legalScore, 100);
            claimsScore = Math.min(claimsScore, 100);
            scopeScore = Math.min(scopeScore, 100);
            
            return {
                estate: estateText || 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª ÙÙŠ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©.',
                legal: legalText || 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨Ù†ÙˆØ¯ Ø§Ù„Ù…Ø­Ø§ÙƒÙ… ÙÙŠ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©.',
                claims: claimsText || 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨Ù†ÙˆØ¯ Ø§Ù„Ù…Ø·Ø§Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙÙŠ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©.',
                scope: scopeText || 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†Ø·Ø§Ù‚ Ø§Ù„ÙˆÙƒØ§Ù„Ø© Ø¨Ø´ÙƒÙ„ Ù…ÙØµÙ„ ÙÙŠ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©.',
                scores: {
                    estate: estateScore,
                    legal: legalScore,
                    claims: claimsScore,
                    scope: scopeScore
                }
            };
        }

        function renderUI(hData, pData, cData) {
            renderDeceasedCard(hData);
            renderStats(hData, pData);
            renderChecks(hData, pData, cData);
            renderTable(hData, pData);
            renderClauses(cData);
            updateMatchCircle(hData, pData);
        }

        function renderDeceasedCard(hData) {
            if (hData.decId) {
                document.getElementById('deceasedCard').classList.remove('hidden');
                document.getElementById('deceasedId').innerText = hData.decId;
                document.getElementById('deceasedName').innerText = hData.decName || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            }
        }

        function renderStats(hData, pData) {
            const totalHeirs = hData.totalHeirs || 0;
            const appointedHeirs = pData.principals.filter(id => hData.heirs.includes(id)).length;
            const appointmentRate = totalHeirs > 0 ? Math.round((appointedHeirs / totalHeirs) * 100) : 0;
            
            document.getElementById('totalHeirs').innerText = totalHeirs;
            document.getElementById('appointedHeirs').innerText = appointedHeirs;
            document.getElementById('appointmentRate').innerText = `${appointmentRate}%`;
        }

        function renderChecks(hData, pData, cData) {
            const hasDeceased = !!hData.decId;
            const hasAgent = !!pData.agentId;
            const hasClauses = cData.scores.estate > 0 || cData.scores.legal > 0 || 
                              cData.scores.claims > 0 || cData.scores.scope > 0;
            
            document.getElementById('checkDeceased').innerHTML = `
                <span class="text-gray-700 font-medium">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙˆÙÙ‰</span>
                <span class="${hasDeceased ? 'text-green-500' : 'text-red-500'} text-xl">
                    ${hasDeceased ? 'âœ…' : 'âŒ'}
                </span>
            `;
            
            document.getElementById('checkAgent').innerHTML = `
                <span class="text-gray-700 font-medium">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆÙƒÙŠÙ„</span>
                <span class="${hasAgent ? 'text-green-500' : 'text-red-500'} text-xl">
                    ${hasAgent ? 'âœ…' : 'âŒ'}
                </span>
            `;
            
            document.getElementById('checkClauses').innerHTML = `
                <span class="text-gray-700 font-medium">Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</span>
                <span class="${hasClauses ? 'text-green-500' : 'text-red-500'} text-xl">
                    ${hasClauses ? 'âœ…' : 'âŒ'}
                </span>
            `;
        }

        function renderTable(hData, pData) {
            const tbody = document.getElementById('resultsTable');
            tbody.innerHTML = '';
            
            const allIds = [...new Set([
                ...hData.heirs,
                ...pData.principals,
                pData.agentId
            ].filter(Boolean))];
            
            allIds.forEach(id => {
                const isHeir = hData.heirs.includes(id);
                const isAgent = id === pData.agentId;
                const isPrincipal = pData.principals.includes(id);
                
                let name = 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                let share = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                let notes = '';
                
                if (isHeir && hData.heirDetails[id]) {
                    name = hData.heirDetails[id].name;
                    share = hData.heirDetails[id].share;
                } else if (isAgent) {
                    name = pData.agentName;
                    notes = 'Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„Ù…ÙÙˆØ¶';
                } else if (isPrincipal) {
                    const principal = pData.principalDetails.find(p => p.id === id);
                    name = principal ? principal.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                    notes = 'Ù…ÙˆÙƒÙ„';
                }
                
                let roles = [];
                let rowClass = "hover:bg-gray-50 transition";
                
                if (isHeir) roles.push("ÙˆØ§Ø±Ø«");
                if (isAgent) {
                    roles.push("ÙˆÙƒÙŠÙ„ Ø´Ø±Ø¹ÙŠ");
                    rowClass = "agent-row hover:bg-amber-50";
                } else if (isPrincipal) {
                    roles.push("Ù…ÙˆÙƒÙ„");
                }
                
                const roleDisplay = roles.map(role => {
                    if (role === "ÙˆÙƒÙŠÙ„ Ø´Ø±Ø¹ÙŠ") return `<span class="agent-badge">â­ ÙˆÙƒÙŠÙ„</span>`;
                    if (role === "ÙˆØ§Ø±Ø«") return `<span class="text-blue-600 bg-blue-50 px-3 py-1 rounded-lg text-xs font-bold">ÙˆØ§Ø±Ø«</span>`;
                    return `<span class="text-gray-600 bg-gray-100 px-3 py-1 rounded-lg text-xs">${role}</span>`;
                }).join(' ');
                
                const status = isPrincipal || isAgent 
                    ? '<span class="inline-flex items-center px-3 py-1.5 rounded-full bg-gradient-to-r from-green-100 to-emerald-100 text-green-800 font-bold">âœ… ØªÙ… Ø§Ù„ØªÙˆÙƒÙŠÙ„</span>'
                    : isHeir 
                    ? '<span class="inline-flex items-center px-3 py-1.5 rounded-full bg-gradient-to-r from-red-100 to-rose-100 text-red-800 font-bold">âŒ Ù„Ù… ÙŠÙˆÙƒÙ„</span>'
                    : '<span class="text-gray-400">-</span>';
                
                tbody.innerHTML += `
                    <tr class="${rowClass} border-b last:border-0">
                        <td class="p-4 font-mono text-gray-800 font-bold text-lg">${id}</td>
                        <td class="p-4 font-medium">${name}</td>
                        <td class="p-4">${roleDisplay}</td>
                        <td class="p-4 font-semibold ${share !== 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' ? 'text-blue-600' : 'text-gray-500'}">${share}</td>
                        <td class="p-4 text-center">${status}</td>
                        <td class="p-4 text-center text-gray-600 text-sm">${notes}</td>
                    </tr>
                `;
            });
        }

        function renderClauses(cData) {
            const estateBox = document.getElementById('estateText');
            const legalBox = document.getElementById('legalText');
            const claimsBox = document.getElementById('claimsText');
            const scopeBox = document.getElementById('scopeText');
            
            estateBox.innerText = cData.estate;
            legalBox.innerText = cData.legal;
            claimsBox.innerText = cData.claims;
            scopeBox.innerText = cData.scope;
            
            updateClauseBoxStyle(estateBox, cData.scores.estate);
            updateClauseBoxStyle(legalBox, cData.scores.legal);
            updateClauseBoxStyle(claimsBox, cData.scores.claims);
            updateClauseBoxStyle(scopeBox, cData.scores.scope);
            
            document.getElementById('estateScore').innerHTML = `
                <div class="w-12 h-12 rounded-full ${getScoreColor(cData.scores.estate)} flex items-center justify-center">
                    <span class="font-bold">${cData.scores.estate}%</span>
                </div>
            `;
            
            document.getElementById('legalScore').innerHTML = `
                <div class="w-12 h-12 rounded-full ${getScoreColor(cData.scores.legal)} flex items-center justify-center">
                    <span class="font-bold">${cData.scores.legal}%</span>
                </div>
            `;
            
            document.getElementById('claimsScore').innerHTML = `
                <div class="w-12 h-12 rounded-full ${getScoreColor(cData.scores.claims)} flex items-center justify-center">
                    <span class="font-bold">${cData.scores.claims}%</span>
                </div>
            `;
            
            document.getElementById('scopeScore').innerHTML = `
                <div class="w-12 h-12 rounded-full ${getScoreColor(cData.scores.scope)} flex items-center justify-center">
                    <span class="font-bold">${cData.scores.scope}%</span>
                </div>
            `;
        }

        function updateClauseBoxStyle(box, score) {
            box.className = box.className.replace(' not-found', '').replace(' found', '');
            if (score > 0) {
                box.classList.add('found');
            } else {
                box.classList.add('not-found');
            }
        }

        function getScoreColor(score) {
            if (score >= 80) return 'bg-emerald-100 text-emerald-800';
            if (score >= 50) return 'bg-amber-100 text-amber-800';
            if (score >= 20) return 'bg-orange-100 text-orange-800';
            return 'bg-red-100 text-red-800';
        }

        function updateMatchCircle(hData, pData) {
            const totalHeirs = hData.totalHeirs || 0;
            const appointedHeirs = pData.principals.filter(id => hData.heirs.includes(id)).length;
            const appointmentRate = totalHeirs > 0 ? Math.round((appointedHeirs / totalHeirs) * 100) : 0;
            
            const circle = document.getElementById('matchCircle');
            const percentageText = document.getElementById('matchPercentage');
            
            const circumference = 2 * Math.PI * 45;
            const offset = circumference - (appointmentRate / 100) * circumference;
            
            circle.style.strokeDashoffset = offset;
            percentageText.innerText = `${appointmentRate}%`;
            
            let color = '#ef4444';
            if (appointmentRate >= 80) color = '#10b981';
            else if (appointmentRate >= 50) color = '#f59e0b';
            
            circle.style.stroke = color;
        }

        function extractNameFromContext(lines, currentIndex, targetId) {
            const contextLines = [];
            const start = Math.max(0, currentIndex - 2);
            const end = Math.min(lines.length - 1, currentIndex + 2);
            
            for (let i = start; i <= end; i++) {
                contextLines.push(lines[i]);
            }
            
            const context = contextLines.join(' ');
            const namePattern = /([\u0600-\u06FF]{2,}\s[\u0600-\u06FF]{2,}(\s[\u0600-\u06FF]{2,})?)/;
            const nameMatch = context.match(namePattern);
            
            if (nameMatch) {
                const name = nameMatch[1].trim();
                if (!name.includes(targetId) && name.length > 4) {
                    return name;
                }
            }
            
            return null;
        }

        function normalizeArabicText(text) {
            return text
                .replace(/[Ù -Ù©]/g, d => 'Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©'.indexOf(d))
                .replace(/(Ø£|Ø¥|Ø¢|Ù±)/g, 'Ø§')
                .replace(/Ø©/g, 'Ù‡')
                .replace(/Ù‰/g, 'ÙŠ')
                .replace(/Ø¤/g, 'Ùˆ')
                .replace(/Ø¦/g, 'ÙŠ')
                .replace(/\s+/g, ' ')
                .replace(/[^\u0600-\u06FF0-9\s]/g, '')
                .trim();
        }

        async function extractText(file, type) {
            updateProgress(type === 'heirs' ? 20 : 35, `Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© ${type === 'heirs' ? 'ØµÙƒ Ø§Ù„ÙˆØ±Ø«Ø©' : 'ÙˆØ«ÙŠÙ‚Ø© Ø§Ù„ÙˆÙƒØ§Ù„Ø©'}...`);
            
            if (file.type === 'application/pdf') {
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const doc = await pdfjsLib.getDocument(arrayBuffer).promise;
                    let fullText = "";
                    
                    for (let i = 1; i <= doc.numPages; i++) {
                        updateProgress(
                            type === 'heirs' ? 25 + (i * 5) : 40 + (i * 5),
                            `Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙØ­Ø© ${i} Ù…Ù† ${doc.numPages}...`
                        );
                        
                        const page = await doc.getPage(i);
                        const textContent = await page.getTextContent();
                        const pageText = textContent.items
                            .map(item => item.str)
                            .join(' ')
                            .replace(/\s+/g, ' ')
                            .trim();
                        
                        fullText += pageText + '\n\n';
                    }
                    
                    return fullText;
                } catch (err) {
                    console.warn('PDF extraction failed, falling back to OCR:', err);
                    return await runOCR(file);
                }
            } else {
                return await runOCR(file);
            }
        }

        async function runOCR(file) {
            updateProgress(50, 'Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… OCR Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ...');
            
            try {
                const worker = await Tesseract.createWorker();
                await worker.loadLanguage('ara');
                await worker.initialize('ara');
                
                await worker.setParameters({
                    tessedit_pageseg_mode: Tesseract.PSM.SINGLE_BLOCK,
                    preserve_interword_spaces: '1',
                });
                
                const result = await worker.recognize(file);
                await worker.terminate();
                
                return result.data.text;
            } catch (err) {
                console.error('OCR failed:', err);
                throw new Error('ÙØ´Ù„ ÙÙŠ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©');
            }
        }

        function updateProgress(percent, message) {
            const progressBar = document.getElementById('progressBar');
            const progressPercent = document.getElementById('progressPercent');
            const loadingMessage = document.getElementById('loadingMessage');
            
            progressBar.style.width = `${percent}%`;
            progressPercent.innerText = `${percent}%`;
            loadingMessage.innerText = message;
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type === 'error' ? 'bg-gradient-to-r from-red-500 to-rose-500' : 'bg-gradient-to-r from-emerald-500 to-green-500'}`;
            notification.innerText = message;
            notification.style.color = 'white';
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55) reverse';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 400);
            }, 3000);
        }

        function filterByRole(role) {
            const rows = document.querySelectorAll('#resultsTable tr');
            rows.forEach(row => {
                const roleCell = row.querySelector('td:nth-child(3)');
                if (roleCell) {
                    const hasRole = roleCell.textContent.includes(role === 'agent' ? 'ÙˆÙƒÙŠÙ„' : 'ÙˆØ§Ø±Ø«');
                    row.style.display = hasRole ? '' : 'none';
                }
            });
        }

        function resetFilter() {
            const rows = document.querySelectorAll('#resultsTable tr');
            rows.forEach(row => {
                row.style.display = '';
            });
        }

        function exportToExcel() {
            if (!analysisResults) {
                showNotification('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±', 'error');
                return;
            }
            
            const { heirsData, poaData } = analysisResults;
            let csv = 'Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©,Ø§Ù„Ø§Ø³Ù…,Ø§Ù„ØµÙØ©,Ø§Ù„Ù†Ø³Ø¨Ø©,Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆÙƒÙŠÙ„,Ù…Ù„Ø§Ø­Ø¸Ø§Øª\n';
            
            const allIds = [...new Set([
                ...heirsData.heirs,
                ...poaData.principals,
                poaData.agentId
            ].filter(Boolean))];
            
            allIds.forEach(id => {
                const isHeir = heirsData.heirs.includes(id);
                const isAgent = id === poaData.agentId;
                const isPrincipal = poaData.principals.includes(id);
                
                let name = 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                let share = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                let role = 'Ø·Ø±Ù Ø®Ø§Ø±Ø¬ÙŠ';
                let status = 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                let notes = '';
                
                if (isHeir && heirsData.heirDetails[id]) {
                    name = heirsData.heirDetails[id].name;
                    share = heirsData.heirDetails[id].share;
                    role = 'ÙˆØ§Ø±Ø«';
                }
                
                if (isAgent) {
                    name = poaData.agentName;
                    role = 'ÙˆÙƒÙŠÙ„';
                    notes = 'Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„Ù…ÙÙˆØ¶';
                } else if (isPrincipal) {
                    const principal = poaData.principalDetails.find(p => p.id === id);
                    name = principal ? principal.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                    role = 'Ù…ÙˆÙƒÙ„';
                }
                
                status = isPrincipal || isAgent ? 'Ù…ÙƒÙ„Ù' : isHeir ? 'ØºÙŠØ± Ù…ÙƒÙ„Ù' : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                
                csv += `"${id}","${name}","${role}","${share}","${status}","${notes}"\n`;
            });
            
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `ØªÙ‚Ø±ÙŠØ±_Ø§Ù„ÙˆÙƒØ§Ù„Ø©_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            showNotification('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Excel', 'success');
        }

        function downloadReport() {
            if (!analysisResults) {
                showNotification('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªÙ‚Ø±ÙŠØ±', 'error');
                return;
            }
            
            const { heirsData, poaData } = analysisResults;
            const report = `
                ===========================================
                ØªÙ‚Ø±ÙŠØ± ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø´Ø±Ø¹ÙŠØ© - Ø§Ù„Ù…Ø­Ù„Ù„ Ø§Ù„Ø¨Ù„Ø§ØªÙŠÙ†ÙŠ
                ===========================================
                Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleDateString('ar-SA')}
                Ø§Ù„ÙˆÙ‚Øª: ${new Date().toLocaleTimeString('ar-SA')}
                
                ====================
                Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙˆÙÙ‰:
                ====================
                Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©: ${heirsData.decId || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                Ø§Ù„Ø§Ø³Ù…: ${heirsData.decName || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ±Ø«Ø©: ${heirsData.totalHeirs}
                
                ====================
                Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆÙƒÙŠÙ„:
                ====================
                Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©: ${poaData.agentId || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                Ø§Ù„Ø§Ø³Ù…: ${poaData.agentName || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆÙƒÙÙ„ÙŠÙ†: ${poaData.totalPrincipals}
                
                ====================
                Ø§Ù„ÙˆØ±Ø«Ø© ÙˆØ§Ù„ÙˆÙƒÙ„Ø§Ø¡:
                ====================
                ${document.querySelector('#resultsTable').innerText.replace(/\t/g, '  ')}
                
                ====================
                Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©:
                ====================
                1. Ø¨Ù†Ø¯ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª:
                ${document.querySelector('#estateText').innerText}
                
                2. Ø¨Ù†Ø¯ Ø§Ù„Ù…Ø­Ø§ÙƒÙ…:
                ${document.querySelector('#legalText').innerText}
                
                3. Ø¨Ù†Ø¯ Ø§Ù„Ù…Ø·Ø§Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©:
                ${document.querySelector('#claimsText').innerText}
                
                4. Ù†Ø·Ø§Ù‚ Ø§Ù„ÙˆÙƒØ§Ù„Ø©:
                ${document.querySelector('#scopeText').innerText}
                
                ====================
                Ù…Ù„Ø§Ø­Ø¸Ø§Øª:
                ====================
                * ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù…Ø­Ù„Ù„ Ø§Ù„Ø¹Ø¯Ù„ÙŠ Ø§Ù„Ø¨Ù„Ø§ØªÙŠÙ†ÙŠ
                * Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚
                * ÙŠÙˆØµÙ‰ Ø¨Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø­Ø§Ù…ÙŠ Ø§Ù„Ù…Ø®ØªØµ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
                * Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø°Ùˆ Ø·Ø¨ÙŠØ¹Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© ÙˆÙ„Ø§ ÙŠØºÙ†ÙŠ Ø¹Ù† Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©
                
                ===========================================
                ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙÙŠ: ${new Date().toLocaleString('ar-SA')}
                ===========================================
            `;
            
            const blob = new Blob(['\uFEFF' + report], { type: 'text/plain;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `ØªÙ‚Ø±ÙŠØ±_Ø§Ù„ÙˆÙƒØ§Ù„Ø©_${new Date().getTime()}.txt`;
            link.click();
            showNotification('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        function printResults() {
            window.print();
        }

        function showAnalysisDetails() {
            if (!analysisResults) {
                showNotification('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØ­Ù„ÙŠÙ„', 'error');
                return;
            }
            
            const modal = document.getElementById('analysisModal');
            const detailsDiv = document.getElementById('analysisDetails');
            
            const { heirsData, poaData, clausesData } = analysisResults;
            
            const details = `
                <div class="space-y-6">
                    <div class="bg-gray-50 p-4 rounded-xl">
                        <h4 class="font-bold text-lg text-gray-800 mb-2">ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <span class="text-gray-600">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ù„ÙŠÙ„:</span>
                                <span class="font-medium">${new Date(analysisResults.timestamp).toLocaleString('ar-SA')}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ù„ÙŠÙ„:</span>
                                <span class="font-medium">Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ø¨Ù„Ø§ØªÙŠÙ†ÙŠ</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 p-4 rounded-xl">
                        <h4 class="font-bold text-lg text-blue-800 mb-2">ğŸ‘¥ Ù†ØªØ§Ø¦Ø¬ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ÙˆØ±Ø«Ø©</h4>
                        <div class="space-y-2">
                            <div><span class="text-blue-600">Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ±Ø«Ø©:</span> <span class="font-bold">${heirsData.totalHeirs}</span></div>
                            <div><span class="text-blue-600">Ø§Ù„Ù…ØªÙˆÙÙ‰:</span> <span class="font-bold">${heirsData.decId || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</span></div>
                            <div><span class="text-blue-600">Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©:</span> <span class="font-bold">${Object.keys(heirsData.names).length}</span></div>
                        </div>
                    </div>
                    
                    <div class="bg-amber-50 p-4 rounded-xl">
                        <h4 class="font-bold text-lg text-amber-800 mb-2">âš–ï¸ Ù†ØªØ§Ø¦Ø¬ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙˆÙƒØ§Ù„Ø©</h4>
                        <div class="space-y-2">
                            <div><span class="text-amber-600">Ø§Ù„ÙˆÙƒÙŠÙ„:</span> <span class="font-bold">${poaData.agentId || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</span></div>
                            <div><span class="text-amber-600">Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆÙƒÙÙ„ÙŠÙ†:</span> <span class="font-bold">${poaData.totalPrincipals}</span></div>
                            <div><span class="text-amber-600">Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©:</span> <span class="font-bold">${calculateMatchRate(heirsData, poaData)}%</span></div>
                        </div>
                    </div>
                    
                    <div class="bg-green-50 p-4 rounded-xl">
                        <h4 class="font-bold text-lg text-green-800 mb-2">ğŸ“ Ø¬ÙˆØ¯Ø© Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨Ù†ÙˆØ¯</h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="text-center p-3 bg-white rounded-lg">
                                <div class="text-2xl font-bold ${clausesData.scores.estate >= 50 ? 'text-green-600' : 'text-red-600'}">${clausesData.scores.estate}%</div>
                                <div class="text-sm text-gray-600">Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</div>
                            </div>
                            <div class="text-center p-3 bg-white rounded-lg">
                                <div class="text-2xl font-bold ${clausesData.scores.legal >= 50 ? 'text-green-600' : 'text-red-600'}">${clausesData.scores.legal}%</div>
                                <div class="text-sm text-gray-600">Ø§Ù„Ù…Ø­Ø§ÙƒÙ…</div>
                            </div>
                            <div class="text-center p-3 bg-white rounded-lg">
                                <div class="text-2xl font-bold ${clausesData.scores.claims >= 50 ? 'text-green-600' : 'text-red-600'}">${clausesData.scores.claims}%</div>
                                <div class="text-sm text-gray-600">Ø§Ù„Ù…Ø·Ø§Ù„Ø¨Ø§Øª</div>
                            </div>
                            <div class="text-center p-3 bg-white rounded-lg">
                                <div class="text-2xl font-bold ${clausesData.scores.scope >= 50 ? 'text-green-600' : 'text-red-600'}">${clausesData.scores.scope}%</div>
                                <div class="text-sm text-gray-600">Ø§Ù„Ù†Ø·Ø§Ù‚</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-purple-50 p-4 rounded-xl">
                        <h4 class="font-bold text-lg text-purple-800 mb-2">ğŸ” Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØªÙ‚Ù†ÙŠØ©</h4>
                        <ul class="space-y-2 text-gray-700">
                            <li class="flex items-start gap-2">
                                <span class="text-purple-500">â€¢</span>
                                <span>ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="text-purple-500">â€¢</span>
                                <span>ØªÙ… ØªØ·Ø¨ÙŠÙ‚ ØªØµØ­ÙŠØ­ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø¥Ù…Ù„Ø§Ø¦ÙŠØ© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="text-purple-500">â€¢</span>
                                <span>ØªÙ… ØªØ­Ø³ÙŠÙ† Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="text-purple-500">â€¢</span>
                                <span>ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ù‚</span>
                            </li>
                        </ul>
                    </div>
                </div>
            `;
            
            detailsDiv.innerHTML = details;
            modal.classList.remove('hidden');
        }

        function closeAnalysisDetails() {
            document.getElementById('analysisModal').classList.add('hidden');
        }

        function calculateMatchRate(heirsData, poaData) {
            const totalHeirs = heirsData.totalHeirs || 0;
            const matchedHeirs = poaData.principals.filter(id => heirsData.heirs.includes(id)).length;
            return totalHeirs > 0 ? Math.round((matchedHeirs / totalHeirs) * 100) : 0;
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeAnalysisDetails();
            }
        });

        window.addEventListener('load', () => {
            showNotification('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ù…Ø­Ù„Ù„ Ø§Ù„Ø¹Ø¯Ù„ÙŠ Ø§Ù„Ø¨Ù„Ø§ØªÙŠÙ†ÙŠ! Ù‚Ù… Ø¨Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„.', 'success');
        });
    </script>
</body>
</html>
