<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„ØªØ±ÙƒØ§Øª Ø§Ù„Ø°ÙƒÙŠØ©</title>
    <!-- Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: 'Noto Sans Arabic', sans-serif; 
            background-color: #f8fafc; 
            margin: 0;
            padding: 0;
            direction: rtl;
        }
        .spinner { 
            border: 3px solid rgba(255, 255, 255, 0.3); 
            border-radius: 50%; 
            border-top: 3px solid #fff; 
            width: 20px; 
            height: 20px; 
            animation: spin 1s linear infinite; 
        }
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        .fade-in { 
            animation: fadeIn 0.5s ease-in-out; 
        }
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        #root {
            min-height: 100vh;
        }
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ */
        @media (max-width: 768px) {
            .mobile-padding {
                padding: 1rem !important;
            }
            .mobile-text {
                font-size: 0.875rem !important;
            }
            .table-responsive {
                font-size: 12px;
            }
        }
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¬Ø¯ÙˆÙ„ */
        .table-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 11px;
        }
        .inheritance-badge {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        .poa-badge {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // Ø§Ù„Ù…ÙØªØ§Ø­ ÙˆØ§Ù„Ù…ÙˆØ¯ÙŠÙ„ - ØªÙ… ØªØµØ­ÙŠØ­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        const API_KEY = "AIzaSyB051BQjnc-35XdnawKEIWDyNxOBYNL9WE";
        const MODEL = "gemini-2.0-flash"; // ØªÙ… Ø§Ù„ØªØµØ­ÙŠØ­ Ù‡Ù†Ø§
        
        console.log("Using model:", MODEL);

        // Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª SVG
        const Icons = {
            Shield: () => (
                <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                </svg>
            ),
            Upload: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 16v1a2 2 0 002 2h12a2 2 0 002-2v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                </svg>
            ),
            Play: () => (
                <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M8 5v14l11-7z"></path>
                </svg>
            ),
            Check: () => (
                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7"></path>
                </svg>
            ),
            Alert: () => (
                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            ),
            Trash: () => (
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v2m3 4h.01"></path>
                </svg>
            ),
            Info: () => (
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            ),
            Download: () => (
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
            ),
            Search: () => (
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
            )
        };

        const App = () => {
            const [docs, setDocs] = useState([]);
            const [queue, setQueue] = useState([]);
            const [results, setResults] = useState([]);
            const [loading, setLoading] = useState(false);
            const [status, setStatus] = useState({ current: 0, total: 0, message: '' });
            const [errorMsg, setErrorMsg] = useState("");
            const [successMsg, setSuccessMsg] = useState("");
            const [searchTerm, setSearchTerm] = useState("");
            const fileInput = useRef(null);

            // ØªØ£Ø«ÙŠØ± Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¨Ø¹Ø¯ ÙØªØ±Ø©
            useEffect(() => {
                if (errorMsg || successMsg) {
                    const timer = setTimeout(() => {
                        setErrorMsg("");
                        setSuccessMsg("");
                    }, 5000);
                    return () => clearTimeout(timer);
                }
            }, [errorMsg, successMsg]);

            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚
            useEffect(() => {
                console.log("Processing docs:", docs);
                if (docs.length === 0) {
                    setResults([]);
                    return;
                }
                
                const cleanName = (name) => {
                    if (!name) return '';
                    return name.replace(/\s+/g, ' ').trim().toLowerCase();
                };

                // ÙØ±Ø² Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®
                const sortedDocs = [...docs].sort((a, b) => {
                    const dateA = a.issueDate ? new Date(a.issueDate) : new Date(0);
                    const dateB = b.issueDate ? new Date(b.issueDate) : new Date(0);
                    return dateA - dateB;
                });
                
                // ØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª
                const inheritanceDocs = sortedDocs.filter(d => d.docType === 'HOSR');
                const poaDocs = sortedDocs.filter(d => d.docType === 'POA');
                
                console.log("Inheritance docs:", inheritanceDocs);
                console.log("POA docs:", poaDocs);
                
                if (inheritanceDocs.length === 0) {
                    setResults([]);
                    return;
                }

                // Ø§Ù„Ù…ØªÙˆÙÙ‰ Ø§Ù„Ø£ÙˆÙ„ (Ø§Ù„Ø£Ù‚Ø¯Ù…)
                const firstDeceased = cleanName(inheritanceDocs[0].deceasedName);
                const summary = [];

                inheritanceDocs.forEach((doc, docIndex) => {
                    const currentDeceased = cleanName(doc.deceasedName);
                    const isMain = currentDeceased === firstDeceased;
                    
                    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ heirs
                    const heirs = doc.heirs || [];
                    
                    heirs.forEach(heir => {
                        const heirName = heir.name ? heir.name.trim() : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                        const cleanHeirName = cleanName(heirName);
                        const heirId = heir.idNo || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                        
                        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ÙˆÙƒØ§Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„ÙˆØ§Ø±Ø«
                        let foundPoa = null;
                        let isAgent = false;
                        
                        poaDocs.forEach(poa => {
                            // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ principals (Ø§Ù„Ù…ÙˆÙƒÙ„ÙˆÙ†)
                            const principals = poa.principals || [];
                            const principalMatch = principals.some(principal => {
                                if (!principal) return false;
                                const cleanPrincipal = cleanName(principal);
                                return cleanPrincipal === cleanHeirName || 
                                       cleanPrincipal.includes(cleanHeirName) || 
                                       cleanHeirName.includes(cleanPrincipal);
                            });
                            
                            if (principalMatch) {
                                foundPoa = poa;
                            }
                            
                            // Ø§Ù„Ø¨Ø­Ø« Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙˆØ§Ø±Ø« Ù‡Ùˆ Ø§Ù„ÙˆÙƒÙŠÙ„ Ù†ÙØ³Ù‡
                            const agentName = poa.agentName ? cleanName(poa.agentName) : '';
                            if (agentName === cleanHeirName) {
                                isAgent = true;
                            }
                        });
                        
                        // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©
                        let legalNote = '';
                        if (isMain) {
                            legalNote = `Ø§Ù„ÙˆÙƒØ§Ù„Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø¥Ø±Ø« Ù…Ù† Ø§Ù„Ù…ÙˆØ±Ø« Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (${doc.deceasedName || firstDeceased})`;
                        } else {
                            legalNote = `Ø§Ù„ÙˆÙƒØ§Ù„Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø¥Ø±Ø« Ù…Ù† (${doc.deceasedName}) ÙˆØ§Ù„Ø¹Ø§Ø¦Ø¯ Ù„Ù‡ Ù…Ù† (${firstDeceased})`;
                        }
                        
                        summary.push({
                            id: `${docIndex}-${heirName}-${Math.random()}`,
                            name: heirName,
                            idNo: heirId,
                            deceased: doc.deceasedName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                            isMain,
                            isAuth: !!foundPoa,
                            isAgent,
                            agent: isAgent ? "Ù†ÙØ³Ù‡ (ÙˆÙƒÙŠÙ„)" : (foundPoa ? (foundPoa.agentName || '-') : '-'),
                            note: legalNote,
                            docId: doc.id
                        });
                    });
                });
                
                console.log("Summary results:", summary);
                setResults(summary);
            }, [docs]);

            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ù‰ Base64
            const toBase64 = useCallback((file) => {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = () => {
                        const base64String = reader.result.split(',')[1];
                        resolve(base64String);
                    };
                    reader.onerror = (error) => {
                        console.error("File reading error:", error);
                        reject(new Error("ÙØ´Ù„ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù"));
                    };
                });
            }, []);

            // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Gemini AI API - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…ØµØ­Ø­
            const callAI = useCallback(async (base64, mimeType, fileName) => {
                console.log(`Calling AI for: ${fileName}, mime: ${mimeType}`);
                
                const prompt = `Ø£Ù†Øª Ù…Ø­Ø§Ù…Ù Ø³Ø¹ÙˆØ¯ÙŠ Ù…ØªØ®ØµØµ ÙÙŠ Ø§Ù„ØµÙƒÙˆÙƒ Ø§Ù„Ø´Ø±Ø¹ÙŠØ©. Ù‚Ù… Ø¨Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© Ø§Ù„Ù…Ø±ÙÙ‚Ø© ÙˆØ§Ø±Ø¬Ø¹ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨ØªÙ†Ø³ÙŠÙ‚ JSON ØµØ§Ø±Ù….

                Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚:
                1. ØµÙƒ Ø­ØµØ± Ø¥Ø±Ø« (HOSR): ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙˆÙÙ‰ ÙˆØ§Ù„ÙˆØ±Ø«Ø©
                2. ØµÙƒ ÙˆÙƒØ§Ù„Ø© (POA): ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆÙƒÙŠÙ„ ÙˆØ§Ù„Ù…ÙˆÙƒÙ„ÙŠÙ†

                Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯:
                - Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© ØµÙƒ Ø­ØµØ± Ø¥Ø±Ø«ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚:
                {
                    "docType": "HOSR",
                    "issueDate": "YYYY-MM-DD",
                    "deceasedName": "Ø§Ø³Ù… Ø§Ù„Ù…ØªÙˆÙÙ‰ Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
                    "heirs": [
                        {"name": "Ø§Ø³Ù… Ø§Ù„ÙˆØ§Ø±Ø« ÙƒØ§Ù…Ù„Ø§Ù‹", "idNo": "Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© Ø£Ùˆ Ø§Ù„Ø¬ÙˆØ§Ø²"}
                    ]
                }

                - Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© ØµÙƒ ÙˆÙƒØ§Ù„Ø©ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚:
                {
                    "docType": "POA",
                    "issueDate": "YYYY-MM-DD",
                    "agentName": "Ø§Ø³Ù… Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
                    "principals": ["Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙƒÙ„ Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"]
                }

                Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ù‡Ø§Ù…Ø©:
                1. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ØªÙ…Ø§Ù…Ù‹Ø§ ÙƒÙ…Ø§ ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©
                2. ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø± ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ØµÙŠØºØ© YYYY-MM-DD
                3. Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø£ÙƒØ«Ø± Ù…Ù† ÙˆØ§Ø±Ø« Ø£Ùˆ Ù…ÙˆÙƒÙ„ØŒ Ø£Ø¯Ø±Ø¬Ù‡Ù… Ø¬Ù…ÙŠØ¹Ù‹Ø§ ÙÙŠ Ø§Ù„Ù…ØµÙÙˆÙØ©
                4. ÙƒÙ† Ø¯Ù‚ÙŠÙ‚Ù‹Ø§ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙƒÙ…Ø§ Ù‡ÙŠ
                5. Ø§Ø±Ø¬Ø¹ JSON ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ù†Øµ Ø¥Ø¶Ø§ÙÙŠ`;

                try {
                    const url = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`;
                    
                    const requestBody = {
                        contents: [
                            {
                                parts: [
                                    { text: prompt },
                                    {
                                        inlineData: {
                                            mimeType: mimeType,
                                            data: base64
                                        }
                                    }
                                ]
                            }
                        ],
                        generationConfig: {
                            temperature: 0.1,
                            maxOutputTokens: 2000,
                            responseMimeType: "application/json"
                        }
                    };

                    console.log("Sending request to Gemini API...");
                    
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(requestBody)
                    });

                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error("API Error:", errorText);
                        throw new Error(`Ø®Ø·Ø£ ÙÙŠ API: ${response.status} - ${response.statusText}`);
                    }

                    const data = await response.json();
                    console.log("API Response:", data);
                    
                    if (!data.candidates || data.candidates.length === 0) {
                        throw new Error("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬");
                    }
                    
                    const text = data.candidates[0].content.parts[0].text;
                    console.log("Raw AI response:", text);
                    
                    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ JSON
                    let jsonText = text.trim();
                    
                    // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ù†Øµ Ø®Ø§Ø±Ø¬ Ø§Ù„Ø£Ù‚ÙˆØ§Ø³ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§
                    const jsonMatch = jsonText.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        jsonText = jsonMatch[0];
                    }
                    
                    // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù„ÙŠÙ„ JSON
                    try {
                        const parsed = JSON.parse(jsonText);
                        console.log("Parsed JSON:", parsed);
                        return parsed;
                    } catch (parseError) {
                        console.error("JSON Parse Error:", parseError);
                        console.error("Problematic text:", jsonText);
                        
                        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥ØµÙ„Ø§Ø­ JSON ÙŠØ¯ÙˆÙŠÙ‹Ø§
                        const fixedJson = jsonText
                            .replace(/(\w+):/g, '"$1":')  // Ø¥Ø¶Ø§ÙØ© quotes Ù„Ù„Ù…ÙØ§ØªÙŠØ­
                            .replace(/'/g, '"')  // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª Ø§Ù„Ù…ÙØ±Ø¯Ø©
                            .replace(/ØŒ/g, ','); // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„ÙÙˆØ§ØµÙ„ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
                        
                        try {
                            const parsed = JSON.parse(fixedJson);
                            return parsed;
                        } catch (secondError) {
                            throw new Error(`ÙØ´Ù„ ÙÙŠ ØªØ­Ù„ÙŠÙ„ JSON: ${secondError.message}`);
                        }
                    }
                    
                } catch (error) {
                    console.error("AI API Error:", error);
                    throw new Error(`ÙØ´Ù„ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© ${fileName}: ${error.message}`);
                }
            }, []);

            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
            const handleProcess = async () => {
                if (queue.length === 0) {
                    setErrorMsg("Ù„Ù… ØªÙ‚Ù… Ø¨Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ù„ÙØ§Øª Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©");
                    return;
                }

                setLoading(true);
                setErrorMsg("");
                setSuccessMsg("");
                setStatus({ current: 0, total: queue.length, message: 'Ø¬Ø§Ø±ÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...' });

                const newDocs = [];
                const errors = [];

                for (let i = 0; i < queue.length; i++) {
                    const file = queue[i];
                    try {
                        setStatus({ 
                            current: i + 1, 
                            total: queue.length, 
                            message: `Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø©: ${file.name}` 
                        });
                        
                        console.log(`Processing file ${i + 1}/${queue.length}: ${file.name}`);
                        const base64 = await toBase64(file.file);
                        const result = await callAI(base64, file.type || 'image/jpeg', file.name);
                        
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
                        if (!result.docType) {
                            throw new Error("Ù†ÙˆØ¹ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ ÙÙŠ Ø§Ù„Ù†ØªÙŠØ¬Ø©");
                        }
                        
                        if (result.docType === 'HOSR') {
                            if (!result.deceasedName) {
                                console.warn("No deceasedName found, using default");
                                result.deceasedName = "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
                            }
                            if (!result.heirs || !Array.isArray(result.heirs)) {
                                result.heirs = [{ name: "ØºÙŠØ± Ù…Ø­Ø¯Ø¯", idNo: "ØºÙŠØ± Ù…Ø­Ø¯Ø¯" }];
                            }
                        } else if (result.docType === 'POA') {
                            if (!result.agentName) {
                                result.agentName = "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
                            }
                            if (!result.principals || !Array.isArray(result.principals)) {
                                result.principals = ["ØºÙŠØ± Ù…Ø­Ø¯Ø¯"];
                            }
                        }
                        
                        newDocs.push({
                            ...result,
                            fileName: file.name,
                            id: Date.now() + Math.random(),
                            uploadDate: new Date().toISOString().split('T')[0]
                        });
                        
                        console.log(`Successfully processed: ${file.name}`);
                        
                    } catch (error) {
                        console.error(`Error processing ${file.name}:`, error);
                        errors.push(`${file.name}: ${error.message}`);
                    }
                    
                    // ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ø¨ÙŠÙ† Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù„ØªØ¬Ù†Ø¨ rate limiting
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }

                if (errors.length > 0) {
                    const errorSummary = errors.length === queue.length 
                        ? "ÙØ´Ù„ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª. ØªØ£ÙƒØ¯ Ù…Ù† ØµÙŠØºØ© Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ£Ù†Ù‡Ø§ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù†ØµÙˆØµ Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ø¶Ø­Ø©."
                        : `ØªÙ…Øª Ù…Ø¹Ø§Ù„Ø¬Ø© ${newDocs.length} Ù…Ù„ÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­ØŒ Ù…Ø¹ Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ ${errors.length} Ù…Ù„ÙØ§Øª`;
                    
                    setErrorMsg(errorSummary);
                    
                    if (errors.length < 3) {
                        errors.forEach(err => {
                            console.error("Detailed error:", err);
                        });
                    }
                }

                if (newDocs.length > 0) {
                    setDocs(prev => [...prev, ...newDocs]);
                    setSuccessMsg(`âœ… ØªÙ…Øª Ù…Ø¹Ø§Ù„Ø¬Ø© ${newDocs.length} Ù…Ù„ÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­`);
                }

                setQueue([]);
                setLoading(false);
                setStatus({ current: 0, total: 0, message: '' });
            };

            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª
            const handleFileSelect = (e) => {
                const files = Array.from(e.target.files);
                if (files.length === 0) return;

                const validFiles = files.filter(file => {
                    const validTypes = [
                        'image/jpeg',
                        'image/png',
                        'image/jpg',
                        'application/pdf',
                        'image/webp'
                    ];
                    const isValidType = validTypes.includes(file.type);
                    const isValidSize = file.size <= 10 * 1024 * 1024; // 10MB ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰
                    
                    if (!isValidType) {
                        console.warn(`File type not supported: ${file.type}`);
                    }
                    if (!isValidSize) {
                        console.warn(`File too large: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)}MB)`);
                    }
                    
                    return isValidType && isValidSize;
                });

                if (validFiles.length === 0) {
                    setErrorMsg("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„ÙØ§Øª Ø¨ØµÙŠØº Ù…Ø¯Ø¹ÙˆÙ…Ø© (PDF, JPG, PNG, WebP) Ø¨Ø­Ø¬Ù… Ø£Ù‚Ù„ Ù…Ù† 10MB");
                    return;
                }

                const newQueue = validFiles.map(file => ({
                    file: file,
                    name: file.name,
                    type: file.type,
                    size: file.size,
                    id: Date.now() + Math.random()
                }));

                setQueue(prev => [...prev, ...newQueue]);
                setSuccessMsg(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${validFiles.length} Ù…Ù„ÙØ§Øª Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±`);
                e.target.value = '';
            };

            // Ø¥Ø²Ø§Ù„Ø© Ù…Ù„Ù Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
            const removeFromQueue = (id) => {
                setQueue(prev => prev.filter(item => item.id !== id));
            };

            // Ø¥Ø²Ø§Ù„Ø© ÙˆØ«ÙŠÙ‚Ø© Ù…Ø¹Ø§Ù„Ø¬Ø©
            const removeDoc = (id) => {
                setDocs(prev => prev.filter(doc => doc.id !== id));
                setSuccessMsg("ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©");
            };

            // Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const clearAll = () => {
                if (window.confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")) {
                    setDocs([]);
                    setQueue([]);
                    setResults([]);
                    setErrorMsg("");
                    setSuccessMsg("ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­");
                }
            };

            // ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            const exportResults = () => {
                if (results.length === 0) {
                    setErrorMsg("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±");
                    return;
                }
                
                const csvContent = [
                    ['Ø§Ù„Ù…ØªÙˆÙÙ‰', 'Ø§Ù„ÙˆØ§Ø±Ø«', 'Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©', 'Ø§Ù„ØªÙˆÙƒÙŠÙ„', 'Ø§Ù„ÙˆÙƒÙŠÙ„', 'Ø§Ù„Ø­Ø§Ù„Ø©', 'Ø§Ù„Ù…ØªØ·Ù„Ø¨ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ'],
                    ...results.map(r => [
                        r.deceased,
                        r.name,
                        r.idNo,
                        r.isAuth ? 'ØªÙ…' : 'Ù„Ù… ÙŠØªÙ…',
                        r.agent,
                        r.isMain ? 'Ø±Ø¦ÙŠØ³ÙŠ' : 'ÙØ±Ø¹ÙŠ',
                        r.note
                    ])
                ].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
                
                const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `Ù†ØªØ§Ø¦Ø¬_ØªØ¯Ù‚ÙŠÙ‚_Ø§Ù„ØªØ±ÙƒØ§Øª_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
                
                setSuccessMsg("ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¨Ù†Ø¬Ø§Ø­");
            };

            // ØªØµÙÙŠØ© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø­Ø«
            const filteredResults = searchTerm 
                ? results.filter(r => 
                    r.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    r.idNo.includes(searchTerm) ||
                    r.deceased.toLowerCase().includes(searchTerm.toLowerCase())
                  )
                : results;

            return (
                <div className="max-w-7xl mx-auto p-4 md:p-6 mobile-padding">
                    {/* Header */}
                    <header className="bg-gradient-to-r from-emerald-600 to-teal-500 p-6 rounded-[2rem] shadow-lg text-white flex flex-col md:flex-row items-center justify-between gap-6 mb-8 mt-4 fade-in">
                        <div className="flex items-center gap-4">
                            <div className="bg-white/20 p-4 rounded-2xl backdrop-blur-sm">
                                <Icons.Shield />
                            </div>
                            <div>
                                <h1 className="text-2xl md:text-3xl font-black">Ù…Ù†Ø¸ÙˆÙ…Ø© ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„ØªØ±ÙƒØ§Øª Ø§Ù„Ø°ÙƒÙŠØ©</h1>
                                <p className="text-emerald-100 text-sm md:text-base">Ù†Ø¸Ø§Ù… Ø°ÙƒÙŠ Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙƒÙˆÙƒ Ø§Ù„Ø´Ø±Ø¹ÙŠØ© ÙˆÙ…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„ÙˆÙƒØ§Ù„Ø§Øª</p>
                            </div>
                        </div>
                        
                        <div className="flex flex-wrap gap-4 w-full md:w-auto justify-center">
                            <button 
                                onClick={() => fileInput.current.click()} 
                                className="flex-1 md:flex-none bg-white/20 hover:bg-white/30 text-white px-6 md:px-8 py-4 rounded-2xl font-bold flex items-center justify-center gap-2 transition-all backdrop-blur-sm border border-white/30"
                            >
                                <Icons.Upload /> Ø¥Ø±ÙØ§Ù‚ Ù…Ù„ÙØ§Øª
                            </button>
                            
                            {queue.length > 0 && (
                                <button 
                                    onClick={handleProcess} 
                                    disabled={loading}
                                    className="flex-1 md:flex-none bg-white text-emerald-700 hover:bg-emerald-50 px-6 md:px-10 py-4 rounded-2xl font-black flex items-center justify-center gap-3 shadow-xl transition-all disabled:opacity-50"
                                >
                                    {loading ? (
                                        <>
                                            <div className="spinner" style={{ borderTopColor: '#059669' }}></div>
                                            <span className="mobile-text">
                                                {status.message || `Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© (${status.current}/${status.total})`}
                                            </span>
                                        </>
                                    ) : (
                                        <>
                                            <Icons.Play />
                                            <span className="mobile-text">Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ ({queue.length})</span>
                                        </>
                                    )}
                                </button>
                            )}
                            
                            <input 
                                type="file" 
                                ref={fileInput} 
                                onChange={handleFileSelect} 
                                className="hidden" 
                                multiple 
                                accept=".pdf,.jpg,.jpeg,.png,.webp"
                            />
                        </div>
                    </header>

                    {/* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ */}
                    <div className="space-y-4 mb-6">
                        {errorMsg && (
                            <div className="bg-red-50 border-l-4 border-red-500 text-red-700 p-4 rounded-r-2xl flex items-center gap-3 fade-in shadow-sm">
                                <Icons.Alert />
                                <div className="flex-1">
                                    <span className="text-sm font-bold">{errorMsg}</span>
                                </div>
                            </div>
                        )}
                        
                        {successMsg && (
                            <div className="bg-green-50 border-l-4 border-green-500 text-green-700 p-4 rounded-r-2xl flex items-center gap-3 fade-in shadow-sm">
                                <Icons.Check />
                                <div className="flex-1">
                                    <span className="text-sm font-bold">{successMsg}</span>
                                </div>
                            </div>
                        )}
                        
                        {loading && status.message && (
                            <div className="bg-blue-50 border-l-4 border-blue-500 text-blue-700 p-4 rounded-r-2xl fade-in shadow-sm">
                                <div className="flex items-center gap-3">
                                    <div className="spinner" style={{ borderTopColor: '#3b82f6' }}></div>
                                    <span className="text-sm font-bold">{status.message}</span>
                                </div>
                                <div className="w-full bg-blue-200 rounded-full h-2 mt-2">
                                    <div 
                                        className="bg-blue-600 h-2 rounded-full transition-all duration-300"
                                        style={{ width: `${(status.current / status.total) * 100}%` }}
                                    ></div>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± */}
                    {queue.length > 0 && (
                        <div className="mb-6 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-100 p-6 rounded-2xl fade-in shadow-sm">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="font-bold text-blue-800 text-lg">Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø© ({queue.length})</h3>
                                <button
                                    onClick={() => setQueue([])}
                                    className="text-sm text-red-600 hover:text-red-800 font-bold"
                                >
                                    Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙƒÙ„
                                </button>
                            </div>
                            <div className="space-y-3">
                                {queue.map(item => (
                                    <div key={item.id} className="flex items-center justify-between bg-white p-4 rounded-xl shadow-sm border border-blue-100">
                                        <div className="flex items-center gap-3">
                                            <div className="bg-blue-100 p-2 rounded-lg">
                                                <Icons.Info className="text-blue-600" />
                                            </div>
                                            <div>
                                                <p className="font-medium text-sm text-gray-800">{item.name}</p>
                                                <p className="text-xs text-gray-500">
                                                    {(item.size / 1024).toFixed(1)} ÙƒÙŠÙ„ÙˆØ¨Ø§ÙŠØª â€¢ {item.type.split('/')[1]}
                                                </p>
                                            </div>
                                        </div>
                                        <button
                                            onClick={() => removeFromQueue(item.id)}
                                            className="text-red-500 hover:text-red-700 p-2 hover:bg-red-50 rounded-lg transition-colors"
                                            title="Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ù„Ù"
                                        >
                                            <Icons.Trash />
                                        </button>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                        {/* Sidebar - ØªØ³Ù„Ø³Ù„ Ø§Ù„ØµÙƒÙˆÙƒ */}
                        <div className="lg:col-span-3 space-y-6">
                            <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 fade-in h-full">
                                <div className="flex justify-between items-center mb-6 border-b pb-4">
                                    <h2 className="text-lg font-bold text-slate-700">ØªØ³Ù„Ø³Ù„ Ø§Ù„ØµÙƒÙˆÙƒ</h2>
                                    <span className="bg-emerald-100 text-emerald-800 text-xs font-bold px-3 py-1 rounded-full">
                                        {docs.length} ÙˆØ«ÙŠÙ‚Ø©
                                    </span>
                                </div>
                                
                                {docs.length === 0 ? (
                                    <div className="text-center py-10">
                                        <div className="text-slate-300 text-5xl mb-4">ğŸ“‚</div>
                                        <p className="text-slate-400 italic text-sm">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙƒÙˆÙƒ Ù…Ø¹Ø§Ù„Ø¬Ø©</p>
                                        <p className="text-slate-300 text-xs mt-2">Ø§Ø±ÙØ¹ Ø§Ù„ØµÙƒÙˆÙƒ Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„</p>
                                    </div>
                                ) : (
                                    <div className="space-y-4 max-h-[600px] overflow-y-auto pr-2">
                                        {docs.sort((a, b) => new Date(a.issueDate || '2000-01-01') - new Date(b.issueDate || '2000-01-01')).map(doc => (
                                            <div key={doc.id} className="group relative">
                                                <div className="bg-slate-50 hover:bg-slate-100 p-4 rounded-2xl border border-slate-200 relative transition-all hover:shadow-md">
                                                    <button 
                                                        onClick={() => removeDoc(doc.id)} 
                                                        className="absolute left-2 top-2 text-slate-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all p-1 hover:bg-red-50 rounded-lg"
                                                        title="Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©"
                                                    >
                                                        <Icons.Trash />
                                                    </button>
                                                    <div className="flex justify-between items-start mb-2">
                                                        <span className={`status-badge ${doc.docType === 'HOSR' ? 'inheritance-badge' : 'poa-badge'}`}>
                                                            {doc.docType === 'HOSR' ? 'Ø­ØµØ± Ø¥Ø±Ø«' : 'ÙˆÙƒØ§Ù„Ø©'}
                                                        </span>
                                                        <span className="text-xs text-slate-500 bg-slate-100 px-2 py-1 rounded">
                                                            {doc.issueDate || 'ØªØ§Ø±ÙŠØ® ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                                                        </span>
                                                    </div>
                                                    <h4 className="font-bold text-slate-800 text-sm mb-2 truncate" title={doc.fileName}>
                                                        ğŸ“„ {doc.fileName}
                                                    </h4>
                                                    {doc.deceasedName && (
                                                        <div className="text-xs text-slate-600 mb-2">
                                                            <span className="font-semibold">Ø§Ù„Ù…ØªÙˆÙÙ‰:</span> {doc.deceasedName}
                                                        </div>
                                                    )}
                                                    {doc.agentName && (
                                                        <div className="text-xs text-slate-600">
                                                            <span className="font-semibold">Ø§Ù„ÙˆÙƒÙŠÙ„:</span> {doc.agentName}
                                                        </div>
                                                    )}
                                                    <div className="mt-3 pt-3 border-t border-slate-200 text-xs text-slate-500">
                                                        <span className="font-semibold">
                                                            {doc.docType === 'HOSR' 
                                                                ? `Ø§Ù„ÙˆØ±Ø«Ø©: ${doc.heirs?.length || 0}` 
                                                                : `Ø§Ù„Ù…ÙˆÙƒÙ„ÙˆÙ†: ${doc.principals?.length || 0}`
                                                            }
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                
                                {docs.length > 0 && (
                                    <div className="mt-6 space-y-3">
                                        <button 
                                            onClick={exportResults}
                                            className="w-full py-3 text-sm font-bold text-emerald-700 border border-emerald-200 rounded-xl hover:bg-emerald-50 transition-all flex items-center justify-center gap-2"
                                        >
                                            <Icons.Download /> ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                                        </button>
                                        <button 
                                            onClick={clearAll}
                                            className="w-full py-3 text-sm text-red-600 font-bold border border-red-100 rounded-xl hover:bg-red-50 transition-all"
                                        >
                                            Ù…Ø³Ø­ ÙƒØ§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Main Table - Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„ */}
                        <div className="lg:col-span-9 bg-white rounded-[2.5rem] shadow-sm border border-slate-100 overflow-hidden fade-in h-full">
                            <div className="p-6 md:p-8 border-b border-slate-50 flex flex-col md:flex-row justify-between items-center gap-4 bg-gradient-to-r from-slate-50 to-slate-100/50">
                                <div>
                                    <h2 className="text-xl md:text-2xl font-bold text-slate-800 mb-2">Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙˆØ±Ø«Ø©</h2>
                                    <p className="text-slate-600 text-sm">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„ÙˆØ±Ø«Ø© ÙˆØ§Ù„ÙˆÙƒÙ„Ø§Ø¡</p>
                                </div>
                                <div className="flex flex-col md:flex-row items-center gap-4">
                                    <div className="relative">
                                        <div className="absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400">
                                            <Icons.Search />
                                        </div>
                                        <input
                                            type="text"
                                            placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ÙˆØ§Ø±Ø« Ø£Ùˆ Ø±Ù‚Ù… Ù‡ÙˆÙŠØ©..."
                                            value={searchTerm}
                                            onChange={(e) => setSearchTerm(e.target.value)}
                                            className="pr-10 pl-4 py-2 border border-slate-300 rounded-xl text-sm w-full md:w-64 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent"
                                        />
                                    </div>
                                    <div className="flex gap-3">
                                        <div className="flex items-center gap-2 bg-green-50 px-3 py-1.5 rounded-full border border-green-200">
                                            <div className="w-2 h-2 rounded-full bg-green-500"></div>
                                            <span className="text-xs font-bold text-green-700">Ù…ÙˆÙƒÙ„</span>
                                            <span className="text-xs bg-green-200 text-green-800 px-2 py-0.5 rounded-full">
                                                {results.filter(r => r.isAuth).length}
                                            </span>
                                        </div>
                                        <div className="flex items-center gap-2 bg-red-50 px-3 py-1.5 rounded-full border border-red-200">
                                            <div className="w-2 h-2 rounded-full bg-red-500"></div>
                                            <span className="text-xs font-bold text-red-700">Ù…ØªØ¨Ù‚ÙŠ</span>
                                            <span className="text-xs bg-red-200 text-red-800 px-2 py-0.5 rounded-full">
                                                {results.filter(r => !r.isAuth).length}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div className="overflow-x-auto table-responsive">
                                {filteredResults.length > 0 ? (
                                    <table className="w-full text-right min-w-[800px]">
                                        <thead className="bg-gradient-to-r from-slate-600 to-slate-700 text-white text-xs md:text-sm font-black uppercase">
                                            <tr>
                                                <th className="p-5 text-center">#</th>
                                                <th className="p-5">Ø§Ù„Ù…ØªÙˆÙÙ‰</th>
                                                <th className="p-5">Ø§Ù„ÙˆØ§Ø±Ø«</th>
                                                <th className="p-5 text-center">Ø§Ù„ØªÙˆÙƒÙŠÙ„</th>
                                                <th className="p-5">Ø§Ù„ÙˆÙƒÙŠÙ„</th>
                                                <th className="p-5">Ø§Ù„Ù…ØªØ·Ù„Ø¨ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-100">
                                            {filteredResults.map((h, i) => (
                                                <tr key={h.id} className="hover:bg-slate-50/80 transition-colors group">
                                                    <td className="p-5 text-center">
                                                        <div className="w-8 h-8 flex items-center justify-center bg-slate-100 rounded-lg text-slate-600 font-bold">
                                                            {i + 1}
                                                        </div>
                                                    </td>
                                                    <td className="p-5">
                                                        <div className="flex items-center gap-3">
                                                            <div className={`w-3 h-3 rounded-full ${h.isMain ? 'bg-amber-500' : 'bg-indigo-500'}`}></div>
                                                            <div>
                                                                <span className={`text-sm font-bold ${h.isMain ? 'text-amber-700' : 'text-indigo-700'}`}>
                                                                    {h.deceased}
                                                                </span>
                                                                {h.isMain && (
                                                                    <div className="text-xs text-amber-600 bg-amber-50 px-2 py-0.5 rounded-full mt-1">
                                                                        Ù…ÙˆØ±Ø« Ø±Ø¦ÙŠØ³ÙŠ
                                                                    </div>
                                                                )}
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td className="p-5">
                                                        <div className="font-bold text-slate-800 text-sm mb-1">{h.name}</div>
                                                        <div className="text-xs text-slate-500 font-mono bg-slate-100 px-2 py-1 rounded inline-block">
                                                            {h.idNo}
                                                        </div>
                                                    </td>
                                                    <td className="p-5 text-center">
                                                        <div className="flex flex-col items-center">
                                                            <div className={`w-12 h-12 rounded-2xl mx-auto flex items-center justify-center shadow-sm transition-transform group-hover:scale-110 ${h.isAuth 
                                                                ? 'bg-gradient-to-br from-green-100 to-emerald-100 text-green-600 border border-green-200' 
                                                                : 'bg-gradient-to-br from-red-100 to-pink-100 text-red-500 border border-red-200'}`}>
                                                                {h.isAuth ? <Icons.Check /> : <Icons.Alert />}
                                                            </div>
                                                            <div className={`text-xs mt-2 font-bold ${h.isAuth ? 'text-green-600' : 'text-red-600'}`}>
                                                                {h.isAuth ? 'ØªÙ… Ø§Ù„ØªÙˆÙƒÙŠÙ„' : 'ÙŠØ­ØªØ§Ø¬ ØªÙˆÙƒÙŠÙ„'}
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td className="p-5">
                                                        <div className="font-bold text-slate-700 text-sm mb-2">{h.agent}</div>
                                                        {h.isAgent && (
                                                            <div className="inline-flex items-center gap-1 text-xs font-black text-orange-700 bg-orange-50 px-3 py-1.5 rounded-lg border border-orange-200 animate-pulse">
                                                                <Icons.Info /> Ø§Ù„Ù…ÙØªØ±Ø¶ ÙŠØ­Ø¶Ø± Ø´Ø®ØµÙŠÙ‹Ø§
                                                            </div>
                                                        )}
                                                    </td>
                                                    <td className="p-5">
                                                        <div className="text-xs text-slate-600 leading-relaxed max-w-[250px] bg-slate-50 p-3 rounded-lg border border-slate-200">
                                                            {h.note}
                                                        </div>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                ) : (
                                    <div className="py-40 text-center">
                                        <div className="text-7xl mb-6 opacity-20">ğŸ“Š</div>
                                        <h3 className="text-xl font-bold text-slate-300 mb-4">
                                            {searchTerm ? "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬" : "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶"}
                                        </h3>
                                        <p className="text-slate-400 mb-6 max-w-md mx-auto">
                                            {searchTerm 
                                                ? "Ø¬Ø±Ø¨ Ù…ØµØ·Ù„Ø­Ø§Øª Ø¨Ø­Ø« Ø£Ø®Ø±Ù‰ Ø£Ùˆ Ø§Ù…Ø³Ø­ Ø§Ù„Ø¨Ø­Ø« Ù„Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬"
                                                : "Ø§Ø±ÙØ¹ ØµÙƒÙˆÙƒ Ø§Ù„Ø­ØµØ± ÙˆØ§Ù„ÙˆÙƒØ§Ù„Ø§Øª Ù„Ù„Ø¨Ø¯Ø¡ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ"
                                            }
                                        </p>
                                        {!searchTerm && (
                                            <button 
                                                onClick={() => fileInput.current.click()}
                                                className="bg-gradient-to-r from-emerald-600 to-teal-500 text-white px-8 py-3 rounded-xl font-bold flex items-center gap-2 mx-auto hover:shadow-lg transition-shadow"
                                            >
                                                <Icons.Upload /> Ø±ÙØ¹ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ø£ÙˆÙ„Ù‰
                                            </button>
                                        )}
                                    </div>
                                )}
                            </div>
                            
                            {filteredResults.length > 0 && (
                                <div className="p-6 border-t border-slate-100 bg-gradient-to-r from-slate-50 to-slate-100/30">
                                    <div className="flex flex-wrap gap-4 justify-between items-center">
                                        <div className="space-y-2">
                                            <div className="text-sm text-slate-600">
                                                <span className="font-bold">Ø¹Ø±Ø¶ </span>
                                                <span className="font-bold text-emerald-600">{filteredResults.length}</span>
                                                <span className="font-bold"> Ù…Ù† Ø£ØµÙ„ </span>
                                                <span className="font-bold">{results.length}</span>
                                                <span className="font-bold"> ÙˆØ§Ø±Ø«</span>
                                            </div>
                                            <div className="flex flex-wrap gap-4 text-xs">
                                                <div className="flex items-center gap-2">
                                                    <div className="w-3 h-3 rounded-full bg-green-500"></div>
                                                    <span>ØªÙ… Ø§Ù„ØªÙˆÙƒÙŠÙ„: {results.filter(r => r.isAuth).length}</span>
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    <div className="w-3 h-3 rounded-full bg-red-500"></div>
                                                    <span>ÙŠØ­ØªØ§Ø¬ ØªÙˆÙƒÙŠÙ„: {results.filter(r => !r.isAuth).length}</span>
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    <div className="w-3 h-3 rounded-full bg-amber-500"></div>
                                                    <span>Ù…ÙˆØ±Ø« Ø±Ø¦ÙŠØ³ÙŠ: {results.filter(r => r.isMain).length}</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="flex gap-3">
                                            <button 
                                                onClick={exportResults}
                                                className="bg-slate-800 text-white px-6 py-2.5 rounded-xl text-sm font-bold hover:bg-slate-900 transition-colors flex items-center gap-2"
                                            >
                                                <Icons.Download /> ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                                            </button>
                                            <button 
                                                onClick={() => window.print()}
                                                className="bg-white border border-slate-300 text-slate-700 px-6 py-2.5 rounded-xl text-sm font-bold hover:bg-slate-50 transition-colors"
                                            >
                                                Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                    
                    {/* ØªØ°ÙŠÙŠÙ„ Ø§Ù„ØµÙØ­Ø© */}
                    <footer className="mt-12 pt-8 border-t border-slate-200">
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                            <div>
                                <h4 className="font-bold text-slate-800 mb-4">Ø¹Ù† Ø§Ù„Ù…Ù†Ø¸ÙˆÙ…Ø©</h4>
                                <p className="text-slate-600 text-sm">
                                    Ù†Ø¸Ø§Ù… Ø°ÙƒÙŠ Ù„ØªØ­Ù„ÙŠÙ„ ØµÙƒÙˆÙƒ Ø§Ù„ØªØ±ÙƒØ§Øª ÙˆØ§Ù„ÙˆÙƒØ§Ù„Ø§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¯Ù‚Ø© Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©.
                                </p>
                            </div>
                            <div>
                                <h4 className="font-bold text-slate-800 mb-4">Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª</h4>
                                <ul className="text-slate-600 text-sm space-y-2">
                                    <li>â€¢ ØªØ­Ù„ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ØµÙƒÙˆÙƒ Ø§Ù„Ø´Ø±Ø¹ÙŠØ©</li>
                                    <li>â€¢ Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„ÙˆÙƒØ§Ù„Ø§Øª Ù…Ø¹ Ø§Ù„ÙˆØ±Ø«Ø©</li>
                                    <li>â€¢ ÙƒØ´Ù Ø§Ù„ØªÙ†Ø§Ù‚Ø¶Ø§Øª Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©</li>
                                    <li>â€¢ ØªÙ‚Ø§Ø±ÙŠØ± ØªÙØµÙŠÙ„ÙŠØ© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©</li>
                                </ul>
                            </div>
                            <div>
                                <h4 className="font-bold text-slate-800 mb-4">Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</h4>
                                <p className="text-slate-600 text-sm">
                                    Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø£Ùˆ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù…:
                                    <br />
                                    <a href="mailto:support@inheritance.com" className="text-emerald-600 hover:text-emerald-800">
                                        support@inheritance.com
                                    </a>
                                </p>
                            </div>
                        </div>
                        <div className="mt-8 pt-6 border-t border-slate-200 text-center text-slate-500 text-sm">
                            <p>Ù…Ù†Ø¸ÙˆÙ…Ø© ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„ØªØ±ÙƒØ§Øª Ø§Ù„Ø°ÙƒÙŠØ© Â© 2024 - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
                            <p className="text-xs mt-2">ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ù†Ù…ÙˆØ°Ø¬ Gemini 2.0 Flash</p>
                        </div>
                    </footer>
                </div>
            );
        };

        // Ø¬Ø°Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        console.log("Starting App...");
        const rootElement = document.getElementById('root');
        
        if (!rootElement) {
            console.error("Root element not found!");
        } else {
            console.log("Root element found, rendering...");
            try {
                const root = ReactDOM.createRoot(rootElement);
                root.render(<App />);
                console.log("App rendered successfully!");
            } catch (error) {
                console.error("Error rendering app:", error);
            }
        }
    </script>
</body>
</html>
