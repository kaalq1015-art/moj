<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„ØªØ±ÙƒØ§Øª Ø§Ù„Ø°ÙƒÙŠØ©</title>
    <!-- Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¥ØµØ¯Ø§Ø± Ù…Ø­Ù„ÙŠ Ù…Ù† Tailwind Ù„ØªØ¬Ù†Ø¨ ØªØ­Ø°ÙŠØ± CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: 'Noto Sans Arabic', sans-serif; 
            background-color: #f8fafc; 
            margin: 0;
            padding: 0;
            direction: rtl;
        }
        .spinner { 
            border: 3px solid rgba(255, 255, 255, 0.3); 
            border-radius: 50%; 
            border-top: 3px solid #fff; 
            width: 20px; 
            height: 20px; 
            animation: spin 1s linear infinite; 
        }
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        .fade-in { 
            animation: fadeIn 0.5s ease-in-out; 
        }
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        #root {
            min-height: 100vh;
        }
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ */
        @media (max-width: 768px) {
            .mobile-padding {
                padding: 1rem !important;
            }
            .mobile-text {
                font-size: 0.875rem !important;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // Ø§Ù„Ù…ÙØªØ§Ø­ ÙˆØ§Ù„Ù…ÙˆØ¯ÙŠÙ„ - Ù…ÙØªØ§Ø­ API Ø§Ù„Ù…ØµØ­Ø­
        const API_KEY = "AIzaSyB051BQjnc-35XdnawKEIWDyNxOBYNL9WE"; // ØªÙ… ØªØµØ­ÙŠØ­ AIza Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Alza
        const MODEL = "gemini-2.0-flash";
        
        console.log("API Key:", API_KEY.substring(0, 10) + "...");
        console.log("Model:", MODEL);

        // Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª SVG
        const Icons = {
            Shield: () => (
                <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                </svg>
            ),
            Upload: () => (
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 16v1a2 2 0 002 2h12a2 2 0 002-2v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                </svg>
            ),
            Play: () => (
                <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M8 5v14l11-7z"></path>
                </svg>
            ),
            Check: () => (
                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7"></path>
                </svg>
            ),
            Alert: () => (
                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            ),
            Trash: () => (
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v2m3 4h.01"></path>
                </svg>
            ),
            Info: () => (
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            )
        };

        const App = () => {
            const [docs, setDocs] = useState([]);
            const [queue, setQueue] = useState([]);
            const [results, setResults] = useState([]);
            const [loading, setLoading] = useState(false);
            const [status, setStatus] = useState({ current: 0, total: 0, message: '' });
            const [errorMsg, setErrorMsg] = useState("");
            const [successMsg, setSuccessMsg] = useState("");
            const fileInput = useRef(null);

            // ØªØ£Ø«ÙŠØ± Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
            useEffect(() => {
                if (errorMsg || successMsg) {
                    const timer = setTimeout(() => {
                        setErrorMsg("");
                        setSuccessMsg("");
                    }, 5000);
                    return () => clearTimeout(timer);
                }
            }, [errorMsg, successMsg]);

            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ
            useEffect(() => {
                console.log("Processing docs:", docs);
                if (docs.length === 0) {
                    setResults([]);
                    return;
                }
                
                const cleanName = (name) => {
                    if (!name) return '';
                    return name.replace(/\s+/g, ' ').trim().toLowerCase();
                };

                const sortedDocs = [...docs].sort((a, b) => {
                    const dateA = a.issueDate ? new Date(a.issueDate) : new Date(0);
                    const dateB = b.issueDate ? new Date(b.issueDate) : new Date(0);
                    return dateA - dateB;
                });
                
                const inheritanceDocs = sortedDocs.filter(d => d.docType === 'HOSR');
                const poaDocs = sortedDocs.filter(d => d.docType === 'POA');
                
                if (inheritanceDocs.length === 0) {
                    setResults([]);
                    return;
                }

                const firstDeceased = cleanName(inheritanceDocs[0].deceasedName);
                const summary = [];

                inheritanceDocs.forEach((doc, docIndex) => {
                    const currentDeceased = cleanName(doc.deceasedName);
                    const isMain = currentDeceased === firstDeceased;
                    
                    const heirs = doc.heirs || [];
                    
                    heirs.forEach(heir => {
                        const heirName = heir.name ? heir.name.trim() : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                        const cleanHeirName = cleanName(heirName);
                        const heirId = heir.idNo || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                        
                        let foundPoa = null;
                        let isAgent = false;
                        
                        poaDocs.forEach(poa => {
                            const principals = poa.principals || [];
                            const principalMatch = principals.some(principal => {
                                if (!principal) return false;
                                const cleanPrincipal = cleanName(principal);
                                return cleanPrincipal === cleanHeirName || 
                                       cleanPrincipal.includes(cleanHeirName) || 
                                       cleanHeirName.includes(cleanPrincipal);
                            });
                            
                            if (principalMatch) foundPoa = poa;
                            
                            const agentName = poa.agentName ? cleanName(poa.agentName) : '';
                            if (agentName === cleanHeirName) isAgent = true;
                        });
                        
                        let legalNote = '';
                        if (isMain) {
                            legalNote = `Ø§Ù„ÙˆÙƒØ§Ù„Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø¥Ø±Ø« Ù…Ù† Ø§Ù„Ù…ÙˆØ±Ø« Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (${doc.deceasedName || firstDeceased})`;
                        } else {
                            legalNote = `Ø§Ù„ÙˆÙƒØ§Ù„Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø¥Ø±Ø« Ù…Ù† (${doc.deceasedName}) ÙˆØ§Ù„Ø¹Ø§Ø¦Ø¯ Ù„Ù‡ Ù…Ù† (${firstDeceased})`;
                        }
                        
                        summary.push({
                            id: `${docIndex}-${heirName}-${Math.random()}`,
                            name: heirName,
                            idNo: heirId,
                            deceased: doc.deceasedName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                            isMain,
                            isAuth: !!foundPoa,
                            isAgent,
                            agent: isAgent ? "Ù†ÙØ³Ù‡ (ÙˆÙƒÙŠÙ„)" : (foundPoa ? (foundPoa.agentName || '-') : '-'),
                            note: legalNote,
                            docId: doc.id
                        });
                    });
                });
                
                console.log("Summary results:", summary);
                setResults(summary);
            }, [docs]);

            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ù‰ Base64
            const toBase64 = useCallback((file) => {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = () => {
                        const base64String = reader.result.split(',')[1];
                        resolve(base64String);
                    };
                    reader.onerror = reject;
                });
            }, []);

            // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Gemini AI API - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ØµØ­Ø­Ø©
            const callAI = useCallback(async (base64, mimeType, fileName) => {
                console.log(`Calling AI for: ${fileName}, mime: ${mimeType}`);
                
                const prompt = `Ø£Ù†Øª Ù…Ø­Ø§Ù…Ù Ø³Ø¹ÙˆØ¯ÙŠ Ù…ØªØ®ØµØµ ÙÙŠ Ø§Ù„ØµÙƒÙˆÙƒ Ø§Ù„Ø´Ø±Ø¹ÙŠØ©. Ø§Ø³ØªØ®Ø±Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© Ø§Ù„Ù…Ø±ÙÙ‚Ø© ÙˆØ£Ø±Ø¬Ø¹Ù‡Ø§ Ø¨ØªÙ†Ø³ÙŠÙ‚ JSON.
                
                Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚:
                1. ØµÙƒ Ø­ØµØ± Ø¥Ø±Ø« (HOSR)
                2. ØµÙƒ ÙˆÙƒØ§Ù„Ø© (POA)
                
                Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯:
                - Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¯Ù‚ÙŠÙ‚ Ø§Ù„ØªØ§Ù„ÙŠ:
                
                Ù„ØµÙƒÙˆÙƒ Ø§Ù„Ø­ØµØ±:
                {
                    "docType": "HOSR",
                    "issueDate": "YYYY-MM-DD",
                    "deceasedName": "Ø§Ø³Ù… Ø§Ù„Ù…ØªÙˆÙÙ‰ Ø§Ù„ÙƒØ§Ù…Ù„",
                    "heirs": [
                        {"name": "Ø§Ø³Ù… Ø§Ù„ÙˆØ§Ø±Ø«", "idNo": "Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©"}
                    ]
                }
                
                Ù„ØµÙƒÙˆÙƒ Ø§Ù„ÙˆÙƒØ§Ù„Ø©:
                {
                    "docType": "POA",
                    "issueDate": "YYYY-MM-DD",
                    "agentName": "Ø§Ø³Ù… Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„",
                    "principals": ["Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙƒÙ„"]
                }
                
                Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª:
                1. ÙƒÙ† Ø¯Ù‚ÙŠÙ‚Ù‹Ø§ ÙÙŠ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙˆØ§Ù„ØªÙˆØ§Ø±ÙŠØ®
                2. Ø¥Ø°Ø§ Ù„Ù… ØªØ¬Ø¯ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªØŒ Ø§Ø³ØªØ®Ø¯Ù… "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"
                3. Ø§Ø±Ø¬Ø¹ JSON ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ù†Øµ Ø¥Ø¶Ø§ÙÙŠ`;

                try {
                    const url = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`;
                    
                    // JSON Ø§Ù„ØµØ­ÙŠØ­ Ù„Ù„Ø·Ù„Ø¨
                    const requestBody = {
                        contents: [
                            {
                                parts: [
                                    { text: prompt },
                                    {
                                        inlineData: {
                                            mimeType: mimeType || "application/pdf",
                                            data: base64
                                        }
                                    }
                                ]
                            }
                        ],
                        generationConfig: {
                            temperature: 0.1,
                            maxOutputTokens: 2000,
                            responseMimeType: "application/json"
                        }
                    };

                    console.log("Sending request to Gemini API...", requestBody);
                    
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(requestBody)
                    });

                    console.log("Response status:", response.status);
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error("API Error Response:", errorText);
                        throw new Error(`Ø®Ø·Ø£ ÙÙŠ API: ${response.status}`);
                    }

                    const data = await response.json();
                    console.log("API Response data:", data);
                    
                    if (!data.candidates || data.candidates.length === 0) {
                        throw new Error("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬");
                    }
                    
                    const text = data.candidates[0].content.parts[0].text;
                    console.log("Raw AI response:", text);
                    
                    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ JSON
                    let jsonText = text.trim();
                    
                    // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ù†Øµ Ø®Ø§Ø±Ø¬ JSON
                    const jsonMatch = jsonText.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        jsonText = jsonMatch[0];
                    }
                    
                    // ØªØ­Ù„ÙŠÙ„ JSON
                    try {
                        const parsed = JSON.parse(jsonText);
                        console.log("Parsed JSON:", parsed);
                        return parsed;
                    } catch (parseError) {
                        console.error("JSON Parse Error:", parseError);
                        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥ØµÙ„Ø§Ø­ JSON
                        const fixedJson = jsonText
                            .replace(/(\w+):/g, '"$1":')
                            .replace(/'/g, '"')
                            .replace(/ØŒ/g, ',');
                        
                        return JSON.parse(fixedJson);
                    }
                    
                } catch (error) {
                    console.error("AI API Error:", error);
                    throw new Error(`ÙØ´Ù„ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©: ${error.message}`);
                }
            }, []);

            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
            const handleProcess = async () => {
                if (queue.length === 0) {
                    setErrorMsg("Ù„Ù… ØªÙ‚Ù… Ø¨Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ù„ÙØ§Øª Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©");
                    return;
                }

                setLoading(true);
                setErrorMsg("");
                setSuccessMsg("");
                setStatus({ current: 0, total: queue.length, message: 'Ø¬Ø§Ø±ÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...' });

                const newDocs = [];
                const errors = [];

                for (let i = 0; i < queue.length; i++) {
                    const file = queue[i];
                    try {
                        setStatus({ 
                            current: i + 1, 
                            total: queue.length, 
                            message: `Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø©: ${file.name}` 
                        });
                        
                        console.log(`Processing file ${i + 1}/${queue.length}: ${file.name}`);
                        const base64 = await toBase64(file.file);
                        const result = await callAI(base64, file.type || 'application/pdf', file.name);
                        
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
                        if (!result.docType) {
                            throw new Error("Ù†ÙˆØ¹ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ");
                        }
                        
                        // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                        if (result.docType === 'HOSR') {
                            result.deceasedName = result.deceasedName || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
                            result.heirs = result.heirs || [{ name: "ØºÙŠØ± Ù…Ø­Ø¯Ø¯", idNo: "ØºÙŠØ± Ù…Ø­Ø¯Ø¯" }];
                        } else if (result.docType === 'POA') {
                            result.agentName = result.agentName || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
                            result.principals = result.principals || ["ØºÙŠØ± Ù…Ø­Ø¯Ø¯"];
                        }
                        
                        newDocs.push({
                            ...result,
                            fileName: file.name,
                            id: Date.now() + Math.random(),
                            uploadDate: new Date().toISOString().split('T')[0]
                        });
                        
                        console.log(`Successfully processed: ${file.name}`);
                        
                    } catch (error) {
                        console.error(`Error processing ${file.name}:`, error);
                        errors.push(`${file.name}: ${error.message}`);
                    }
                    
                    // ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ø¨ÙŠÙ† Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }

                if (errors.length > 0) {
                    setErrorMsg(`Ø­Ø¯Ø«Øª Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ ${errors.length} Ù…Ù„ÙØ§Øª`);
                }

                if (newDocs.length > 0) {
                    setDocs(prev => [...prev, ...newDocs]);
                    setSuccessMsg(`âœ… ØªÙ…Øª Ù…Ø¹Ø§Ù„Ø¬Ø© ${newDocs.length} Ù…Ù„ÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­`);
                }

                setQueue([]);
                setLoading(false);
                setStatus({ current: 0, total: 0, message: '' });
            };

            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª
            const handleFileSelect = (e) => {
                const files = Array.from(e.target.files);
                if (files.length === 0) return;

                const validFiles = files.filter(file => {
                    const validTypes = ['image/jpeg', 'image/png', 'image/jpg', 'application/pdf', 'image/webp'];
                    const isValidType = validTypes.includes(file.type);
                    const isValidSize = file.size <= 10 * 1024 * 1024;
                    
                    return isValidType && isValidSize;
                });

                if (validFiles.length === 0) {
                    setErrorMsg("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„ÙØ§Øª Ø¨ØµÙŠØº Ù…Ø¯Ø¹ÙˆÙ…Ø© (PDF, JPG, PNG, WebP) Ø¨Ø­Ø¬Ù… Ø£Ù‚Ù„ Ù…Ù† 10MB");
                    return;
                }

                const newQueue = validFiles.map(file => ({
                    file: file,
                    name: file.name,
                    type: file.type,
                    size: file.size,
                    id: Date.now() + Math.random()
                }));

                setQueue(prev => [...prev, ...newQueue]);
                setSuccessMsg(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${validFiles.length} Ù…Ù„ÙØ§Øª Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±`);
                e.target.value = '';
            };

            const removeFromQueue = (id) => {
                setQueue(prev => prev.filter(item => item.id !== id));
            };

            const removeDoc = (id) => {
                setDocs(prev => prev.filter(doc => doc.id !== id));
                setSuccessMsg("ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©");
            };

            const clearAll = () => {
                if (window.confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")) {
                    setDocs([]);
                    setQueue([]);
                    setResults([]);
                    setErrorMsg("");
                    setSuccessMsg("ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­");
                }
            };

            // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
            const loadSampleData = () => {
                const sampleDocs = [
                    {
                        docType: "HOSR",
                        issueDate: "2024-01-10",
                        deceasedName: "Ø«Ø§Ù…Ø± ØµØ§Ù„Ø­ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¨Ù† Ø¹Ø«ÙŠÙ…ÙŠÙ†",
                        heirs: [
                            { name: "Ø³Ø§Ù„Ù… Ø¨Ù† Ø«Ø§Ù…Ø± Ø¨Ù† Ø¹Ø«ÙŠÙ…ÙŠÙ†", idNo: "1012345678" },
                            { name: "Ù†Ø§ØµØ± Ø¨Ù† Ø«Ø§Ù…Ø± Ø¨Ù† Ø¹Ø«ÙŠÙ…ÙŠÙ†", idNo: "1022345678" },
                            { name: "Ù…Ù†ÙŠØ±Ø© Ø¨Ù†Øª Ø«Ø§Ù…Ø± Ø¨Ù† Ø¹Ø«ÙŠÙ…ÙŠÙ†", idNo: "1032345678" }
                        ],
                        fileName: "ØµÙƒ Ø­ØµØ± Ø¥Ø±Ø« - Ø«Ø§Ù…Ø± ØµØ§Ù„Ø­ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¨Ù† Ø¹Ø«ÙŠÙ…ÙŠÙ†.pdf",
                        id: Date.now() + 1,
                        uploadDate: new Date().toISOString().split('T')[0]
                    },
                    {
                        docType: "POA",
                        issueDate: "2024-01-15",
                        agentName: "Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø£Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ",
                        principals: ["Ø³Ø§Ù„Ù… Ø¨Ù† Ø«Ø§Ù…Ø± Ø¨Ù† Ø¹Ø«ÙŠÙ…ÙŠÙ†", "Ù†Ø§ØµØ± Ø¨Ù† Ø«Ø§Ù…Ø± Ø¨Ù† Ø¹Ø«ÙŠÙ…ÙŠÙ†"],
                        fileName: "ØµÙƒ ÙˆÙƒØ§Ù„Ø© - Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ.pdf",
                        id: Date.now() + 2,
                        uploadDate: new Date().toISOString().split('T')[0]
                    }
                ];
                
                setDocs(sampleDocs);
                setSuccessMsg("ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­");
            };

            return (
                <div className="max-w-7xl mx-auto p-4 md:p-6">
                    {/* Header */}
                    <header className="bg-gradient-to-r from-emerald-600 to-teal-500 p-6 rounded-[2rem] shadow-lg text-white mb-8 fade-in">
                        <div className="flex flex-col md:flex-row items-center justify-between gap-6">
                            <div className="flex items-center gap-4">
                                <div className="bg-white/20 p-4 rounded-2xl">
                                    <Icons.Shield />
                                </div>
                                <div>
                                    <h1 className="text-2xl md:text-3xl font-black">Ù…Ù†Ø¸ÙˆÙ…Ø© ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„ØªØ±ÙƒØ§Øª Ø§Ù„Ø°ÙƒÙŠØ©</h1>
                                    <p className="text-emerald-100">Ù†Ø¸Ø§Ù… Ø°ÙƒÙŠ Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙƒÙˆÙƒ Ø§Ù„Ø´Ø±Ø¹ÙŠØ© ÙˆÙ…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„ÙˆÙƒØ§Ù„Ø§Øª</p>
                                </div>
                            </div>
                            
                            <div className="flex flex-wrap gap-4 w-full md:w-auto justify-center">
                                <button 
                                    onClick={() => fileInput.current.click()} 
                                    className="bg-white/20 hover:bg-white/30 text-white px-6 py-3 rounded-2xl font-bold flex items-center gap-2 transition-all border border-white/30"
                                >
                                    <Icons.Upload /> Ø¥Ø±ÙØ§Ù‚ Ù…Ù„ÙØ§Øª
                                </button>
                                
                                <button 
                                    onClick={loadSampleData}
                                    className="bg-white/10 hover:bg-white/20 text-white px-6 py-3 rounded-2xl font-bold border border-white/20"
                                >
                                    Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
                                </button>
                                
                                {queue.length > 0 && (
                                    <button 
                                        onClick={handleProcess} 
                                        disabled={loading}
                                        className="bg-white text-emerald-700 hover:bg-emerald-50 px-6 py-3 rounded-2xl font-black flex items-center gap-3 shadow-xl transition-all disabled:opacity-50"
                                    >
                                        {loading ? (
                                            <>
                                                <div className="spinner" style={{ borderTopColor: '#059669' }}></div>
                                                <span>
                                                    {status.message || `Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© (${status.current}/${status.total})`}
                                                </span>
                                            </>
                                        ) : (
                                            <>
                                                <Icons.Play />
                                                <span>Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ ({queue.length})</span>
                                            </>
                                        )}
                                    </button>
                                )}
                                
                                <input 
                                    type="file" 
                                    ref={fileInput} 
                                    onChange={handleFileSelect} 
                                    className="hidden" 
                                    multiple 
                                    accept=".pdf,.jpg,.jpeg,.png,.webp"
                                />
                            </div>
                        </div>
                    </header>

                    {/* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ */}
                    <div className="space-y-4 mb-6">
                        {errorMsg && (
                            <div className="bg-red-50 border-l-4 border-red-500 text-red-700 p-4 rounded-r-2xl flex items-center gap-3 fade-in">
                                <Icons.Alert />
                                <span className="font-bold">{errorMsg}</span>
                            </div>
                        )}
                        
                        {successMsg && (
                            <div className="bg-green-50 border-l-4 border-green-500 text-green-700 p-4 rounded-r-2xl flex items-center gap-3 fade-in">
                                <Icons.Check />
                                <span className="font-bold">{successMsg}</span>
                            </div>
                        )}
                    </div>

                    {/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± */}
                    {queue.length > 0 && (
                        <div className="mb-6 p-4 rounded-xl bg-blue-50 border border-blue-100 fade-in">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="font-bold text-blue-800">Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø© ({queue.length})</h3>
                                <button
                                    onClick={() => setQueue([])}
                                    className="text-sm text-red-600 hover:text-red-800 font-bold"
                                >
                                    Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙƒÙ„
                                </button>
                            </div>
                            <div className="space-y-3">
                                {queue.map(item => (
                                    <div key={item.id} className="flex items-center justify-between bg-white p-3 rounded-lg">
                                        <div className="flex items-center gap-3">
                                            <Icons.Info className="text-blue-600" />
                                            <div>
                                                <p className="font-medium">{item.name}</p>
                                                <p className="text-sm text-gray-500">
                                                    {(item.size / 1024).toFixed(1)} ÙƒÙŠÙ„ÙˆØ¨Ø§ÙŠØª
                                                </p>
                                            </div>
                                        </div>
                                        <button
                                            onClick={() => removeFromQueue(item.id)}
                                            className="text-red-500 hover:text-red-700"
                                            title="Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ù„Ù"
                                        >
                                            <Icons.Trash />
                                        </button>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    <div className="flex flex-col lg:flex-row gap-8">
                        {/* Sidebar - ØªØ³Ù„Ø³Ù„ Ø§Ù„ØµÙƒÙˆÙƒ */}
                        <div className="lg:w-1/3">
                            <div className="bg-white p-6 rounded-xl shadow-sm border h-full">
                                <h2 className="text-lg font-bold mb-6 border-b pb-4 text-slate-700">ØªØ³Ù„Ø³Ù„ Ø§Ù„ØµÙƒÙˆÙƒ ({docs.length})</h2>
                                
                                {docs.length === 0 ? (
                                    <div className="text-center py-10">
                                        <p className="text-gray-400 italic">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙƒÙˆÙƒ Ù…Ø¹Ø§Ù„Ø¬Ø©</p>
                                    </div>
                                ) : (
                                    <div className="space-y-4 max-h-[500px] overflow-y-auto">
                                        {docs.sort((a, b) => new Date(a.issueDate || '2000-01-01') - new Date(b.issueDate || '2000-01-01')).map(doc => (
                                            <div key={doc.id} className="group relative">
                                                <div className="bg-gray-50 hover:bg-gray-100 p-4 rounded-xl border relative transition-all">
                                                    <button 
                                                        onClick={() => removeDoc(doc.id)} 
                                                        className="absolute left-2 top-2 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all"
                                                        title="Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©"
                                                    >
                                                        <Icons.Trash />
                                                    </button>
                                                    <div className="flex justify-between items-start mb-2">
                                                        <span className={`px-3 py-1 rounded-full text-xs font-bold ${
                                                            doc.docType === 'HOSR' 
                                                                ? 'bg-purple-100 text-purple-700' 
                                                                : 'bg-blue-100 text-blue-700'
                                                        }`}>
                                                            {doc.docType === 'HOSR' ? 'Ø­ØµØ± Ø¥Ø±Ø«' : 'ÙˆÙƒØ§Ù„Ø©'}
                                                        </span>
                                                        <span className="text-xs text-gray-500">
                                                            {doc.issueDate || 'ØªØ§Ø±ÙŠØ® ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                                                        </span>
                                                    </div>
                                                    <h4 className="font-bold text-slate-800 text-sm mb-2">
                                                        ğŸ“„ {doc.fileName}
                                                    </h4>
                                                    {doc.deceasedName && (
                                                        <div className="text-xs text-gray-600 mb-2">
                                                            <span className="font-semibold">Ø§Ù„Ù…ØªÙˆÙÙ‰:</span> {doc.deceasedName}
                                                        </div>
                                                    )}
                                                    {doc.agentName && (
                                                        <div className="text-xs text-gray-600">
                                                            <span className="font-semibold">Ø§Ù„ÙˆÙƒÙŠÙ„:</span> {doc.agentName}
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                
                                {docs.length > 0 && (
                                    <button 
                                        onClick={clearAll}
                                        className="w-full mt-6 py-3 text-red-600 font-bold border border-red-100 rounded-xl hover:bg-red-50 transition-all"
                                    >
                                        Ù…Ø³Ø­ ÙƒØ§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                                    </button>
                                )}
                            </div>
                        </div>

                        {/* Main Table - Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„ */}
                        <div className="lg:w-2/3">
                            <div className="bg-white rounded-xl shadow-sm border overflow-hidden h-full">
                                <div className="p-6 border-b bg-gray-50">
                                    <h2 className="text-xl font-bold text-slate-800 mb-2">Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙˆØ±Ø«Ø©</h2>
                                    <p className="text-gray-600">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„ÙˆØ±Ø«Ø© ÙˆØ§Ù„ÙˆÙƒÙ„Ø§Ø¡</p>
                                </div>
                                
                                <div className="overflow-x-auto">
                                    {results.length > 0 ? (
                                        <table className="w-full">
                                            <thead className="bg-gray-100">
                                                <tr>
                                                    <th className="p-3">#</th>
                                                    <th className="p-3">Ø§Ù„Ù…ØªÙˆÙÙ‰</th>
                                                    <th className="p-3">Ø§Ù„ÙˆØ§Ø±Ø«</th>
                                                    <th className="p-3 text-center">Ø§Ù„ØªÙˆÙƒÙŠÙ„</th>
                                                    <th className="p-3">Ø§Ù„ÙˆÙƒÙŠÙ„</th>
                                                    <th className="p-3">Ø§Ù„Ù…ØªØ·Ù„Ø¨ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {results.map((h, i) => (
                                                    <tr key={h.id} className="border-b hover:bg-gray-50">
                                                        <td className="p-3 text-center">{i + 1}</td>
                                                        <td className="p-3">
                                                            <span className={`px-2 py-1 rounded text-xs font-bold ${h.isMain ? 'bg-yellow-100 text-yellow-700' : 'bg-indigo-100 text-indigo-700'}`}>
                                                                {h.deceased}
                                                            </span>
                                                        </td>
                                                        <td className="p-3">
                                                            <div className="font-bold">{h.name}</div>
                                                            <div className="text-sm text-gray-500">{h.idNo}</div>
                                                        </td>
                                                        <td className="p-3 text-center">
                                                            <div className={`inline-flex items-center justify-center w-10 h-10 rounded-full ${h.isAuth ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-500'}`}>
                                                                {h.isAuth ? <Icons.Check /> : <Icons.Alert />}
                                                            </div>
                                                            <div className="text-xs mt-1">{h.isAuth ? 'ØªÙ…' : 'Ù„Ù… ÙŠØªÙ…'}</div>
                                                        </td>
                                                        <td className="p-3">
                                                            <div>{h.agent}</div>
                                                            {h.isAgent && (
                                                                <div className="text-xs text-orange-600 bg-orange-50 px-2 py-1 rounded mt-1">
                                                                    Ø§Ù„Ù…ÙØªØ±Ø¶ ÙŠØ­Ø¶Ø±
                                                                </div>
                                                            )}
                                                        </td>
                                                        <td className="p-3 text-sm text-gray-600">
                                                            {h.note}
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    ) : (
                                        <div className="py-20 text-center">
                                            <div className="text-4xl mb-4 text-gray-300">ğŸ“Š</div>
                                            <h3 className="text-xl font-bold text-gray-400 mb-4">
                                                Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶
                                            </h3>
                                            <p className="text-gray-400 mb-6">
                                                Ø§Ø±ÙØ¹ ØµÙƒÙˆÙƒ Ø§Ù„Ø­ØµØ± ÙˆØ§Ù„ÙˆÙƒØ§Ù„Ø§Øª Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
                                            </p>
                                        </div>
                                    )}
                                </div>
                                
                                {results.length > 0 && (
                                    <div className="p-6 border-t bg-gray-50">
                                        <div className="flex justify-between items-center">
                                            <div className="text-sm text-gray-600">
                                                <span className="font-bold">Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ±Ø«Ø©: {results.length}</span> | 
                                                <span className="text-green-600 mx-2"> ØªÙ… Ø§Ù„ØªÙˆÙƒÙŠÙ„: {results.filter(r => r.isAuth).length}</span> | 
                                                <span className="text-red-600 mx-2"> ÙŠØ­ØªØ§Ø¬ ØªÙˆÙƒÙŠÙ„: {results.filter(r => !r.isAuth).length}</span>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                    
                    {/* ØªØ°ÙŠÙŠÙ„ Ø§Ù„ØµÙØ­Ø© */}
                    <footer className="mt-12 pt-8 border-t border-gray-200 text-center text-gray-500 text-sm">
                        <p>Ù…Ù†Ø¸ÙˆÙ…Ø© ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„ØªØ±ÙƒØ§Øª Ø§Ù„Ø°ÙƒÙŠØ© - ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ù†Ù…ÙˆØ°Ø¬ Gemini 2.0 Flash</p>
                        <p className="text-xs mt-2">ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø®Ø§Ø¯Ù… ÙˆÙŠØ¨ Ù…Ø­Ù„ÙŠ Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ CORS</p>
                    </footer>
                </div>
            );
        };

        // Ø¬Ø°Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        const rootElement = document.getElementById('root');
        if (rootElement) {
            const root = ReactDOM.createRoot(rootElement);
            root.render(<App />);
        }
    </script>
</body>
</html>
