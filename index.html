<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙƒÙŠÙ„ Ø§Ù„ÙˆØ±Ø«Ø©</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        /* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
            min-height: 100vh;
            padding: 20px;
            color: #2d3748;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
            overflow: hidden;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            padding: 35px 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: float 20s linear infinite;
        }

        @keyframes float {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(-50px, -50px) rotate(360deg); }
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 12px;
            position: relative;
            z-index: 1;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        header p {
            opacity: 0.95;
            font-size: 1.15rem;
            position: relative;
            z-index: 1;
            max-width: 800px;
            margin: 0 auto;
        }

        header .subtitle {
            font-size: 0.95rem;
            opacity: 0.8;
            margin-top: 10px;
            background: rgba(255,255,255,0.1);
            display: inline-block;
            padding: 8px 16px;
            border-radius: 50px;
            backdrop-filter: blur(10px);
        }

        /* Ù‚Ø³Ù… Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª */
        .upload-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 35px;
            padding: 40px;
            background: linear-gradient(to bottom, #f8fafc, #f1f5f9);
            border-bottom: 1px solid #e2e8f0;
        }

        @media (max-width: 900px) {
            .upload-section {
                grid-template-columns: 1fr;
                gap: 25px;
            }
        }

        .upload-box {
            background: white;
            border: 3px dashed #3b82f6;
            border-radius: 18px;
            padding: 30px;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .upload-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            transform: scaleX(0);
            transition: transform 0.4s ease;
        }

        .upload-box:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(59, 130, 246, 0.15);
            border-color: #8b5cf6;
        }

        .upload-box:hover::before {
            transform: scaleX(1);
        }

        .upload-box h3 {
            color: #1e3a8a;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-weight: 600;
        }

        .upload-box input[type="file"] {
            width: 100%;
            padding: 18px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8fafc;
            font-size: 1rem;
        }

        .upload-box input[type="file"]:hover {
            border-color: #3b82f6;
            background: #f0f9ff;
        }

        .upload-box input[type="file"]::file-selector-button {
            background: linear-gradient(135deg, #3b82f6, #6366f1);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 10px;
            font-weight: 500;
        }

        .upload-box input[type="file"]::file-selector-button:hover {
            background: linear-gradient(135deg, #2563eb, #4f46e5);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .file-info {
            padding: 16px;
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border-radius: 12px;
            font-size: 0.95rem;
            color: #0369a1;
            min-height: 60px;
            border: 1px solid #bae6fd;
            text-align: right;
        }

        .file-info .file-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: #075985;
        }

        .file-info .file-size {
            font-size: 0.85rem;
            color: #0ea5e9;
            opacity: 0.9;
        }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… */
        .controls {
            padding: 30px;
            text-align: center;
            background: #f8fafc;
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            border-bottom: 1px solid #e2e8f0;
        }

        button {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 50px;
            font-size: 1.15rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-weight: 600;
            min-width: 200px;
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.25);
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.7s ease;
        }

        button:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.35);
        }

        button:hover::before {
            left: 100%;
        }

        button:active {
            transform: translateY(-2px);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1) !important;
        }

        #processBtn:disabled {
            background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
        }

        #resetBtn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.25);
        }

        #resetBtn:hover {
            box-shadow: 0 12px 30px rgba(239, 68, 68, 0.35);
        }

        #downloadBtn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.25);
        }

        #downloadBtn:hover {
            box-shadow: 0 12px 30px rgba(16, 185, 129, 0.35);
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… */
        .progress-container {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
            display: none;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
            width: 0%;
            border-radius: 4px;
            transition: width 0.3s ease;
            background-size: 200% 100%;
            animation: gradient 2s ease infinite;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Ù‚Ø³Ù… Ø§Ù„Ù†ØªØ§Ø¦Ø¬ */
        .results-section {
            padding: 40px;
        }

        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 35px;
            border-radius: 18px;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.25);
        }

        .summary-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 30px 30px;
            opacity: 0.3;
        }

        .summary-card h3 {
            margin-bottom: 20px;
            font-size: 1.8rem;
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .summary-content {
            font-size: 1.15rem;
            line-height: 1.8;
            position: relative;
            z-index: 1;
            white-space: pre-line;
        }

        .summary-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .summary-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .summary-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .result-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 18px;
            padding: 25px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.05);
        }

        .result-card:hover {
            border-color: #3b82f6;
            box-shadow: 0 12px 35px rgba(59, 130, 246, 0.15);
            transform: translateY(-5px);
        }

        .result-card h4 {
            color: #1e3a8a;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f5f9;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
        }

        .detailed-results {
            background: white;
            border-radius: 18px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
        }

        .detailed-results h3 {
            color: #1e3a8a;
            margin-bottom: 25px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 20px;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        th {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            padding: 18px 20px;
            text-align: right;
            font-weight: 600;
            font-size: 1.05rem;
            position: relative;
        }

        th:not(:last-child)::after {
            content: '';
            position: absolute;
            left: 0;
            top: 20%;
            height: 60%;
            width: 1px;
            background: rgba(255,255,255,0.2);
        }

        td {
            padding: 16px 20px;
            border-bottom: 1px solid #f1f5f9;
            text-align: right;
            transition: all 0.2s ease;
        }

        tr:hover {
            background: linear-gradient(90deg, #f0f9ff, #f8fafc);
        }

        tr:last-child td {
            border-bottom: none;
        }

        /* Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± */
        .status-complete {
            color: #059669;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            background: #d1fae5;
            padding: 8px 15px;
            border-radius: 8px;
            border: 1px solid #a7f3d0;
        }

        .status-incomplete {
            color: #dc2626;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            background: #fee2e2;
            padding: 8px 15px;
            border-radius: 8px;
            border: 1px solid #fecaca;
        }

        .status-warning {
            color: #d97706;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            background: #fef3c7;
            padding: 8px 15px;
            border-radius: 8px;
            border: 1px solid #fde68a;
        }

        /* Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§Ù… */
        .raw-data {
            background: white;
            border-radius: 18px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
        }

        .raw-data h3 {
            color: #1e3a8a;
            margin-bottom: 25px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .raw-data-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-top: 20px;
        }

        @media (max-width: 900px) {
            .raw-data-grid {
                grid-template-columns: 1fr;
            }
        }

        .data-box {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            transition: all 0.3s ease;
        }

        .data-box:hover {
            border-color: #3b82f6;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.1);
        }

        .data-box h4 {
            color: #1e3a8a;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e2e8f0;
            font-size: 1.2rem;
            position: sticky;
            top: 0;
            background: #f8fafc;
            padding-top: 10px;
            margin-top: -10px;
        }

        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 0.9rem;
            color: #475569;
            line-height: 1.6;
            font-family: 'Courier New', monospace;
        }

        /* Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª */
        .alert {
            padding: 16px 20px;
            border-radius: 12px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid;
            background: white;
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .alert-success {
            background: linear-gradient(135deg, #d1fae5, #ecfdf5);
            color: #065f46;
            border-color: #a7f3d0;
        }

        .alert-warning {
            background: linear-gradient(135deg, #fef3c7, #fffbeb);
            color: #92400e;
            border-color: #fde68a;
        }

        .alert-danger {
            background: linear-gradient(135deg, #fee2e2, #fef2f2);
            color: #991b1b;
            border-color: #fecaca;
        }

        .alert-info {
            background: linear-gradient(135deg, #dbeafe, #eff6ff);
            color: #1e40af;
            border-color: #bfdbfe;
        }

        /* Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .loading {
            display: inline-block;
            width: 22px;
            height: 22px;
            border: 3px solid rgba(59, 130, 246, 0.1);
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-color: #3b82f6;
        }

        .stat-number {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: #64748b;
            font-size: 0.95rem;
            font-weight: 500;
        }

        /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
        .hidden {
            display: none !important;
        }

        .visible {
            display: block !important;
        }

        /* Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #94a3b8, #64748b);
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        }

        /* Ø§Ù„ØªØ¬Ø§ÙˆØ¨ */
        @media (max-width: 768px) {
            header h1 {
                font-size: 2rem;
            }
            
            header p {
                font-size: 1rem;
            }
            
            .upload-section {
                padding: 25px;
            }
            
            .results-section, .controls {
                padding: 25px;
            }
            
            button {
                padding: 15px 30px;
                min-width: 160px;
                font-size: 1rem;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-card {
                padding: 20px 15px;
            }
            
            .stat-number {
                font-size: 1.8rem;
            }
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
        @media print {
            .controls, .upload-section {
                display: none;
            }
            
            .container {
                box-shadow: none;
                border-radius: 0;
            }
            
            .result-card, .detailed-results, .raw-data {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }

        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translateX(-1px); }
            20%, 80% { transform: translateX(2px); }
            30%, 50%, 70% { transform: translateX(-4px); }
            40%, 60% { transform: translateX(4px); }
        }

        /* ØªÙ„Ù…ÙŠØ­Ø§Øª */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background: #1e3a8a;
            color: white;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ”„ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙƒÙŠÙ„ Ø§Ù„ÙˆØ±Ø«Ø©</h1>
            <p>Ù†Ø¸Ø§Ù… Ù…Ø·Ø§Ø¨Ù‚Ø© Ù…Ù†Ø·Ù‚ÙŠ Ù…Ø­Ù„ÙŠ Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ÙƒØªÙ…Ø§Ù„ ØªÙˆÙƒÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ±Ø«Ø© ÙÙŠ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ</p>
            <div class="subtitle">
                ÙŠØ¹Ù…Ù„ ÙƒÙ„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ â€¢ Ù„Ø§ ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø£ÙŠ Ø®Ø§Ø¯Ù… Ø®Ø§Ø±Ø¬ÙŠ â€¢ Ø®ØµÙˆØµÙŠØ© ØªØ§Ù…Ø©
            </div>
        </header>

        <div class="upload-section">
            <div class="upload-box">
                <h3>ğŸ“„ ØµÙƒ Ø­ØµØ± Ø§Ù„ÙˆØ±Ø«Ø©</h3>
                <input type="file" id="heirsFile" accept=".pdf" onchange="handleFileUpload(this, 'heirsInfo', 'heirsProgress')">
                <div class="progress-container" id="heirsProgress">
                    <div class="progress-bar"></div>
                </div>
                <div class="file-info" id="heirsInfo">
                    <div class="file-name">Ù„Ù… ÙŠØªÙ… Ø±ÙØ¹ Ù…Ù„Ù Ø¨Ø¹Ø¯</div>
                    <div class="file-size">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: 10 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª</div>
                </div>
            </div>
            
            <div class="upload-box">
                <h3>ğŸ“‹ ØµÙƒ Ø§Ù„ÙˆÙƒØ§Ù„Ø©</h3>
                <input type="file" id="poaFile" accept=".pdf" onchange="handleFileUpload(this, 'poaInfo', 'poaProgress')">
                <div class="progress-container" id="poaProgress">
                    <div class="progress-bar"></div>
                </div>
                <div class="file-info" id="poaInfo">
                    <div class="file-name">Ù„Ù… ÙŠØªÙ… Ø±ÙØ¹ Ù…Ù„Ù Ø¨Ø¹Ø¯</div>
                    <div class="file-size">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: 10 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª</div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button id="processBtn" onclick="processDocuments()" disabled>
                <span id="processText">ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚</span>
                <span id="processLoading" class="loading hidden"></span>
            </button>
            <button id="downloadBtn" onclick="downloadReport()" class="hidden">
                ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            </button>
            <button id="resetBtn" onclick="resetAll()">
                ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
            </button>
        </div>

        <div class="results-section" id="resultsSection">
            <div class="summary-card" id="summary">
                <h3>ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h3>
                <div class="summary-content">Ù‚Ù… Ø¨Ø±ÙØ¹ Ù…Ù„ÙÙŠ PDF (ØµÙƒ Ø­ØµØ± Ø§Ù„ÙˆØ±Ø«Ø© ÙˆØµÙƒ Ø§Ù„ÙˆÙƒØ§Ù„Ø©) Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</div>
            </div>

            <div class="stats-grid hidden" id="statsGrid">
                <div class="stat-card">
                    <div class="stat-number" id="statTotal">0</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØ±Ø«Ø©</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statAuthorized">0</div>
                    <div class="stat-label">ØªÙ… ØªÙˆÙƒÙŠÙ„Ù‡Ù…</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statMissing">0</div>
                    <div class="stat-label">Ù„Ù… ÙŠØªÙ… ØªÙˆÙƒÙŠÙ„Ù‡Ù…</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statPercentage">0%</div>
                    <div class="stat-label">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„</div>
                </div>
            </div>

            <div class="results-grid">
                <div class="result-card">
                    <h4>ğŸ‘¥ Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„ÙˆØ±Ø«Ø©</h4>
                    <div id="heirsMatchResult">Ø§Ù†ØªØ¸Ø± Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª...</div>
                </div>
                
                <div class="result-card">
                    <h4>ğŸ”— ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù†Ø·Ø§Ù‚</h4>
                    <div id="scopeValidationResult">Ø§Ù†ØªØ¸Ø± Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª...</div>
                </div>
                
                <div class="result-card">
                    <h4>ğŸ‘¤ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆÙƒÙŠÙ„</h4>
                    <div id="agentValidationResult">Ø§Ù†ØªØ¸Ø± Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª...</div>
                </div>
            </div>

            <div class="detailed-results">
                <h3>ğŸ“‹ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</h3>
                <table id="detailsTable">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</th>
                            <th>ØµÙ„Ø© Ø§Ù„Ù‚Ø±Ø§Ø¨Ø© / Ø§Ù„Ø¯ÙˆØ±</th>
                            <th>Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆÙƒÙŠÙ„</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <tr>
                            <td colspan="4" style="text-align: center; padding: 40px; color: #94a3b8;">
                                â³ Ù„Ù… ÙŠØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ø¹Ø¯
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="raw-data">
                <h3>ğŸ“„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©</h3>
                <div class="raw-data-grid">
                    <div class="data-box">
                        <h4>Ø¨ÙŠØ§Ù†Ø§Øª ØµÙƒ Ø§Ù„Ø­ØµØ±</h4>
                        <pre id="heirsRawData">Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ù…Ø­ØªÙˆÙ‰ ØµÙƒ Ø­ØµØ± Ø§Ù„ÙˆØ±Ø«Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø±ÙØ¹...</pre>
                    </div>
                    <div class="data-box">
                        <h4>Ø¨ÙŠØ§Ù†Ø§Øª ØµÙƒ Ø§Ù„ÙˆÙƒØ§Ù„Ø©</h4>
                        <pre id="poaRawData">Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ù…Ø­ØªÙˆÙ‰ ØµÙƒ Ø§Ù„ÙˆÙƒØ§Ù„Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø±ÙØ¹...</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙƒÙ„Ø§Ø³Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ====================
        
        class PDFParser {
            constructor() {
                this.textContent = '';
                this.currentProgress = 0;
            }

            async extractTextFromPDF(file, progressCallback) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    
                    reader.onload = async (e) => {
                        try {
                            const typedarray = new Uint8Array(e.target.result);
                            
                            // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª PDF.js
                            const loadingTask = pdfjsLib.getDocument({
                                data: typedarray,
                                cMapUrl: 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/cmaps/',
                                cMapPacked: true,
                                standardFontDataUrl: 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/standard_fonts/',
                            });
                            
                            const pdf = await loadingTask.promise;
                            let fullText = '';
                            const totalPages = pdf.numPages;
                            
                            for (let i = 1; i <= totalPages; i++) {
                                if (progressCallback) {
                                    const progress = Math.round((i / totalPages) * 100);
                                    progressCallback(progress);
                                }
                                
                                const page = await pdf.getPage(i);
                                const textContent = await page.getTextContent();
                                
                                // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù†Øµ Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ØªØ±ØªÙŠØ¨
                                let pageText = '';
                                let lastY = null;
                                
                                for (const item of textContent.items) {
                                    if (lastY !== null && Math.abs(lastY - item.transform[5]) > 5) {
                                        pageText += '\n';
                                    }
                                    pageText += item.str + ' ';
                                    lastY = item.transform[5];
                                }
                                
                                fullText += pageText + '\n\n';
                            }
                            
                            this.textContent = fullText;
                            resolve(fullText);
                        } catch (error) {
                            reject(new Error('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù PDF: ' + error.message));
                        }
                    };
                    
                    reader.onerror = () => {
                        reject(new Error('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù'));
                    };
                    
                    reader.readAsArrayBuffer(file);
                });
            }

            extractIDNumbers(text) {
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ø±Ù‚Ø§Ù… Ù‡ÙˆÙŠØ© Ø³Ø¹ÙˆØ¯ÙŠØ© (10 Ø£Ø±Ù‚Ø§Ù…)
                const idPattern = /\b(1\d{9})\b/g;
                const matches = text.match(idPattern) || [];
                return [...new Set(matches)];
            }

            extractArabicNames(text) {
                // Ù†Ù…Ø· Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (2-4 ÙƒÙ„Ù…Ø§Øª Ø¹Ø±Ø¨ÙŠØ©)
                const namePattern = /[\u0600-\u06FF]{2,}(?:\s+[\u0600-\u06FF]{2,}){1,3}/g;
                const matches = text.match(namePattern) || [];
                return matches.map(name => name.trim()).filter(name => {
                    // Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© Ø§Ù„ØªÙŠ Ù„ÙŠØ³Øª Ø£Ø³Ù…Ø§Ø¡
                    const commonWords = ['Ø§Ù„Ù…Ù…Ù„ÙƒØ©', 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©', 'Ø§Ù„Ù…ÙˆÙƒÙ„', 'Ø§Ù„ÙˆÙƒÙŠÙ„', 'Ø§Ù„ÙˆØ§Ø±Ø«', 'Ø§Ù„Ù…ØªÙˆÙÙ‰'];
                    return !commonWords.some(word => name.includes(word));
                });
            }

            extractDocumentNumbers(text) {
                const patterns = [
                    /ØµÙƒ\s*Ø±Ù‚Ù…\s*[:Ø›]\s*(\d+\s*[/-]?\s*\d+)/i,
                    /Ø±Ù‚Ù…\s*Ø§Ù„ØµÙƒ\s*[:Ø›]\s*(\d+\s*[/-]?\s*\d+)/i,
                    /Ø±Ù‚Ù…\s*Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©\s*[:Ø›]\s*(\d+\s*[/-]?\s*\d+)/i,
                    /ØµÙƒ\s*Ø­ØµØ±\s*ÙˆØ±Ø«Ø©\s*Ø±Ù‚Ù…\s*(\d+\s*[/-]?\s*\d+)/i,
                    /(\d{4,}\s*[/-]\s*\d{2,}\s*[/-]\s*\d+)/, // Ù†Ù…Ø· 2024/123/456
                    /\b\d{5,15}\b/g
                ];
                
                const results = [];
                patterns.forEach(pattern => {
                    const matches = text.match(pattern);
                    if (matches) {
                        if (Array.isArray(matches)) {
                            if (pattern.source.includes('(\\d+')) {
                                results.push(matches[1].replace(/\s+/g, ''));
                            } else {
                                matches.forEach(m => {
                                    const num = m.replace(/\s+/g, '');
                                    if (num.length >= 5) results.push(num);
                                });
                            }
                        }
                    }
                });
                
                return [...new Set(results)].slice(0, 5); // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 5 Ø£Ø±Ù‚Ø§Ù…
            }

            parseHeirsCertificate(text) {
                console.log("ğŸ” Ø¨Ø¯Ø¡ ØªØ­Ù„ÙŠÙ„ ØµÙƒ Ø­ØµØ± Ø§Ù„ÙˆØ±Ø«Ø©");
                const data = {
                    deceased: { name: null, id: null },
                    heirs: [],
                    documentNumber: null,
                    rawText: text.substring(0, 5000) // Ø­ÙØ¸ Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ù†Øµ Ù„Ù„Ø¹Ø±Ø¶
                };

                try {
                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ù‚Ù… Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©
                    const docNumbers = this.extractDocumentNumbers(text);
                    if (docNumbers.length > 0) {
                        data.documentNumber = docNumbers[0];
                        console.log("ğŸ“„ Ø±Ù‚Ù… Ø§Ù„ØµÙƒ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬:", data.documentNumber);
                    }

                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡ÙˆÙŠØ©
                    const ids = this.extractIDNumbers(text);
                    console.log("ğŸ†” Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©:", ids.length);
                    
                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡
                    const names = this.extractArabicNames(text);
                    console.log("ğŸ‘¤ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©:", names.length);

                    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ØªÙˆÙÙ‰
                    const deceasedPatterns = [
                        /Ø§Ù„Ù…ØªÙˆÙ[ÙŠÙ‰]\s*[:Ø›]\s*([^\n\r]+)/i,
                        /Ø§Ø³Ù…\s*Ø§Ù„Ù…ØªÙˆÙ[ÙŠÙ‰]\s*[:Ø›]\s*([^\n\r]+)/i,
                        /Ø§Ù„Ù…Ø±Ø­ÙˆÙ…\s+([^\n\r:Ø›]+)/i,
                        /Ø§Ù„Ù…ØªÙˆÙ[ÙŠÙ‰]\s+([^\n\r:Ø›]+?)(?=\s*Ø±Ù‚Ù…)/i
                    ];
                    
                    for (const pattern of deceasedPatterns) {
                        const match = text.match(pattern);
                        if (match && match[1]) {
                            const deceasedName = match[1].trim();
                            data.deceased.name = deceasedName;
                            console.log("âš°ï¸ Ø§Ø³Ù… Ø§Ù„Ù…ØªÙˆÙÙ‰ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬:", deceasedName);
                            
                            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù‡ÙˆÙŠØ© Ø§Ù„Ù…ØªÙˆÙÙ‰
                            const searchStart = Math.max(0, text.indexOf(match[0]) - 200);
                            const searchEnd = Math.min(text.length, text.indexOf(match[0]) + 300);
                            const searchArea = text.substring(searchStart, searchEnd);
                            const idMatch = searchArea.match(/\b1\d{9}\b/);
                            if (idMatch) {
                                data.deceased.id = idMatch[0];
                                console.log("ğŸ†” Ù‡ÙˆÙŠØ© Ø§Ù„Ù…ØªÙˆÙÙ‰:", data.deceased.id);
                            }
                            break;
                        }
                    }

                    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙˆØ±Ø«Ø©
                    const heirsKeywords = ['Ø§Ù„ÙˆØ±Ø«Ø©', 'Ø§Ù„Ø£Ø³Ù…Ø§Ø¡', 'Ø¨Ù†Ø§Øª', 'Ø£Ø¨Ù†Ø§Ø¡', 'Ø§Ù„Ø°ÙƒÙˆØ±', 'Ø§Ù„Ø¥Ù†Ø§Ø«'];
                    let heirsSection = '';
                    
                    for (const keyword of heirsKeywords) {
                        const index = text.indexOf(keyword);
                        if (index !== -1) {
                            const start = index;
                            const end = Math.min(text.length, start + 2000);
                            heirsSection = text.substring(start, end);
                            break;
                        }
                    }

                    // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ù‚Ø³Ù… Ø§Ù„ÙˆØ±Ø«Ø©ØŒ Ù†Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù†Øµ ÙƒÙ„Ù‡
                    if (!heirsSection || heirsSection.length < 100) {
                        heirsSection = text;
                    }

                    // Ù…Ø¹Ø§Ù„Ø¬Ø© ÙƒÙ„ Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© ÙƒÙ…ÙˆØ±Ø« Ù…Ø­ØªÙ…Ù„
                    ids.forEach(id => {
                        // ØªØ®Ø·ÙŠ Ù‡ÙˆÙŠØ© Ø§Ù„Ù…ØªÙˆÙÙ‰
                        if (data.deceased.id && id === data.deceased.id) return;
                        
                        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø­ÙˆÙ„ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©
                        const idIndex = heirsSection.indexOf(id);
                        if (idIndex === -1) return;
                        
                        const start = Math.max(0, idIndex - 150);
                        const end = Math.min(heirsSection.length, idIndex + 150);
                        const context = heirsSection.substring(start, end);
                        
                        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø§Ø³Ù…
                        let name = 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                        const nameMatches = context.match(/[\u0600-\u06FF]{2,}(?:\s+[\u0600-\u06FF]{2,}){1,3}/g);
                        if (nameMatches && nameMatches.length > 0) {
                            // Ù†Ø£Ø®Ø° Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø°ÙŠ ÙŠØ¸Ù‡Ø± Ù‚Ø¨Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©
                            const nameBeforeId = nameMatches.filter(n => 
                                context.indexOf(n) < context.indexOf(id)
                            );
                            name = nameBeforeId.length > 0 ? nameBeforeId[nameBeforeId.length - 1] : nameMatches[0];
                            name = name.trim();
                        }
                        
                        // ØªØ­Ø¯ÙŠØ¯ Ø¹Ù„Ø§Ù‚Ø© Ø§Ù„Ù‚Ø±Ø§Ø¨Ø©
                        let relation = 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                        const relationPatterns = [
                            { pattern: /Ø§Ø¨Ù†|ÙˆÙ„Ø¯|Ø§Ù„Ø§Ø¨Ù†/i, relation: 'Ø§Ø¨Ù†' },
                            { pattern: /Ø§Ø¨Ù†Ø©|Ø¨Ù†Øª|Ø§Ù„Ø§Ø¨Ù†Ø©/i, relation: 'Ø§Ø¨Ù†Ø©' },
                            { pattern: /Ø²ÙˆØ¬/i, relation: 'Ø²ÙˆØ¬' },
                            { pattern: /Ø²ÙˆØ¬Ø©/i, relation: 'Ø²ÙˆØ¬Ø©' },
                            { pattern: /Ø£Ø¨|ÙˆØ§Ù„Ø¯/i, relation: 'Ø£Ø¨' },
                            { pattern: /Ø£Ù…|ÙˆØ§Ù„Ø¯Ø©/i, relation: 'Ø£Ù…' },
                            { pattern: /Ø£Ø®/i, relation: 'Ø£Ø®' },
                            { pattern: /Ø£Ø®Øª/i, relation: 'Ø£Ø®Øª' },
                            { pattern: /Ø¹Ù…|Ø¹Ù…Ø©/i, relation: 'Ø¹Ù…/Ø¹Ù…Ø©' },
                            { pattern: /Ø®Ø§Ù„|Ø®Ø§Ù„Ø©/i, relation: 'Ø®Ø§Ù„/Ø®Ø§Ù„Ø©' }
                        ];
                        
                        for (const rel of relationPatterns) {
                            if (rel.pattern.test(context)) {
                                relation = rel.relation;
                                break;
                            }
                        }
                        
                        // ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø±
                        if (!data.heirs.some(heir => heir.id === id)) {
                            data.heirs.push({
                                name: name,
                                id: id,
                                relation: relation,
                                context: context.substring(0, 100) + '...'
                            });
                        }
                    });

                    console.log("ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ±Ø«Ø© Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬ÙŠÙ†:", data.heirs.length);
                    return data;
                } catch (error) {
                    console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ ØµÙƒ Ø­ØµØ± Ø§Ù„ÙˆØ±Ø«Ø©:", error);
                    return data;
                }
            }

            parsePowerOfAttorney(text) {
                console.log("ğŸ” Ø¨Ø¯Ø¡ ØªØ­Ù„ÙŠÙ„ ØµÙƒ Ø§Ù„ÙˆÙƒØ§Ù„Ø©");
                const data = {
                    principals: [],
                    agent: { name: null, id: null },
                    documentNumber: null,
                    deceasedName: null,
                    heirsCertificateNumber: null,
                    rawText: text.substring(0, 5000),
                    authorities: {
                        sale: false,
                        receiveMoney: false,
                        signContracts: false,
                        disposal: false
                    }
                };

                try {
                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚
                    const docNumbers = this.extractDocumentNumbers(text);
                    if (docNumbers.length > 0) {
                        data.documentNumber = docNumbers[0];
                        console.log("ğŸ“„ Ø±Ù‚Ù… ØµÙƒ Ø§Ù„ÙˆÙƒØ§Ù„Ø©:", data.documentNumber);
                    }

                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡ÙˆÙŠØ©
                    const ids = this.extractIDNumbers(text);
                    console.log("ğŸ†” Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡ÙˆÙŠØ© ÙÙŠ Ø§Ù„ÙˆÙƒØ§Ù„Ø©:", ids.length);
                    
                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡
                    const names = this.extractArabicNames(text);

                    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ÙˆÙƒÙ„ÙŠÙ†
                    const principalPatterns = [
                        /Ø§Ù„Ù…ÙˆÙƒÙ„[ÙˆÙ†]?\s*[:Ø›]\s*([^\n\r]+)/gi,
                        /Ù†Ø­Ù†\s*([^:Ø›\n]+?)(?=\s*ÙˆÙƒÙ„Ù†Ø§)/gi,
                        /Ø£Ù†Ø§\s*Ø§Ù„Ù…ÙˆÙƒÙ„\s*([^:Ø›\n]+)/gi
                    ];
                    
                    let foundPrincipals = false;
                    
                    for (const pattern of principalPatterns) {
                        const matches = [...text.matchAll(pattern)];
                        if (matches.length > 0) {
                            matches.forEach(match => {
                                const principalText = match[0];
                                const principalIds = this.extractIDNumbers(principalText);
                                const principalNames = this.extractArabicNames(principalText);
                                
                                principalIds.forEach((id, index) => {
                                    const name = principalNames[index] || match[1] || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                                    if (!data.principals.some(p => p.id === id)) {
                                        data.principals.push({
                                            name: name.trim(),
                                            id: id,
                                            type: 'Ù…ÙˆÙƒÙ„'
                                        });
                                    }
                                });
                            });
                            foundPrincipals = true;
                            break;
                        }
                    }

                    // Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø¯ÙŠÙ„Ø©: Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ±Ø¨Ø·Ù‡Ø§ Ø¨Ø£Ù‚Ø±Ø¨ Ø§Ø³Ù…
                    if (!foundPrincipals || data.principals.length === 0) {
                        console.log("ğŸ” Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø¯ÙŠÙ„Ø© Ù„Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙƒÙ„ÙŠÙ†");
                        ids.forEach(id => {
                            const idIndex = text.indexOf(id);
                            if (idIndex === -1) return;
                            
                            const start = Math.max(0, idIndex - 200);
                            const end = Math.min(text.length, idIndex + 100);
                            const context = text.substring(start, end);
                            
                            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø§Ø³Ù…
                            let name = 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                            const nameMatches = this.extractArabicNames(context);
                            if (nameMatches.length > 0) {
                                // Ù†Ø£Ø®Ø° Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø°ÙŠ ÙŠØ¸Ù‡Ø± Ù‚Ø¨Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©
                                const namesBeforeId = nameMatches.filter(n => 
                                    context.indexOf(n) < context.indexOf(id)
                                );
                                name = namesBeforeId.length > 0 ? namesBeforeId[namesBeforeId.length - 1] : nameMatches[0];
                            }
                            
                            // ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø±
                            if (!data.principals.some(p => p.id === id)) {
                                data.principals.push({
                                    name: name,
                                    id: id,
                                    type: 'Ù…ÙˆÙƒÙ„'
                                });
                            }
                        });
                    }

                    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙˆÙƒÙŠÙ„
                    const agentPatterns = [
                        /Ø§Ù„ÙˆÙƒÙŠÙ„\s*[:Ø›]\s*([^\n\r]+)/i,
                        /ÙˆÙƒÙ„[Ù†Ø§]\s+([^:Ø›\n]+?)(?=\s*Ø¨Ø¹Ù†ÙˆØ§Ù†)/i,
                        /ÙŠÙ…Ø«Ù„Ù†Ø§\s+([^:Ø›\n]+)/i
                    ];
                    
                    for (const pattern of agentPatterns) {
                        const match = text.match(pattern);
                        if (match && match[1]) {
                            const agentName = match[1].trim();
                            data.agent.name = agentName;
                            console.log("ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„ÙˆÙƒÙŠÙ„:", agentName);
                            
                            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù‡ÙˆÙŠØ© Ø§Ù„ÙˆÙƒÙŠÙ„
                            const searchStart = Math.max(0, text.indexOf(match[0]) - 150);
                            const searchEnd = Math.min(text.length, text.indexOf(match[0]) + 150);
                            const searchArea = text.substring(searchStart, searchEnd);
                            const idMatch = searchArea.match(/\b1\d{9}\b/);
                            if (idMatch) {
                                data.agent.id = idMatch[0];
                                console.log("ğŸ†” Ù‡ÙˆÙŠØ© Ø§Ù„ÙˆÙƒÙŠÙ„:", data.agent.id);
                            }
                            break;
                        }
                    }

                    // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ø§Ù„ÙˆÙƒÙŠÙ„ØŒ Ù†Ø£Ø®Ø° Ø£ÙˆÙ„ Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© Ù„ÙŠØ³ Ù…Ù† Ø§Ù„Ù…ÙˆÙƒÙ„ÙŠÙ†
                    if (!data.agent.id && ids.length > 0) {
                        for (const id of ids) {
                            if (!data.principals.some(p => p.id === id)) {
                                data.agent.id = id;
                                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù… Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…
                                const idIndex = text.indexOf(id);
                                if (idIndex !== -1) {
                                    const start = Math.max(0, idIndex - 100);
                                    const end = Math.min(text.length, idIndex);
                                    const context = text.substring(start, end);
                                    const nameMatches = this.extractArabicNames(context);
                                    if (nameMatches.length > 0) {
                                        data.agent.name = nameMatches[nameMatches.length - 1];
                                    }
                                }
                                break;
                            }
                        }
                    }

                    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù… Ø§Ù„Ù…ØªÙˆÙÙ‰ ÙÙŠ Ø§Ù„ÙˆÙƒØ§Ù„Ø©
                    const deceasedInPOAPatterns = [
                        /Ø§Ù„ØªØ±ÙƒØ©\s*Ø§Ù„Ø¹Ø§Ø¦Ø¯Ø©\s*Ù…Ù†\s*([^\n\r:Ø›]+)/i,
                        /Ø¥Ø±Ø«\s*Ø§Ù„Ù…Ø±Ø­ÙˆÙ…\s*([^\n\r:Ø›]+)/i,
                        /Ø§Ù„Ù…ØªÙˆÙ[ÙŠÙ‰]\s*([^\n\r:Ø›]+)/i,
                        /ØªØ±ÙƒØ©\s*([^\n\r:Ø›]+)/i
                    ];
                    
                    for (const pattern of deceasedInPOAPatterns) {
                        const match = text.match(pattern);
                        if (match && match[1]) {
                            data.deceasedName = match[1].trim();
                            console.log("âš°ï¸ Ø§Ø³Ù… Ø§Ù„Ù…ØªÙˆÙÙ‰ ÙÙŠ Ø§Ù„ÙˆÙƒØ§Ù„Ø©:", data.deceasedName);
                            break;
                        }
                    }

                    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø±Ù‚Ù… ØµÙƒ Ø­ØµØ± Ø§Ù„ÙˆØ±Ø«Ø©
                    const heirsCertPatterns = [
                        /ØµÙƒ\s*Ø­ØµØ±\s*ÙˆØ±Ø«Ø©\s*Ø±Ù‚Ù…\s*([^\s\n\r]+)/i,
                        /Ø­ØµØ±\s*ÙˆØ±Ø«Ø©\s*Ø±Ù‚Ù…\s*([^\s\n\r]+)/i,
                        /Ø±Ù‚Ù…\s*ØµÙƒ\s*Ø§Ù„Ø­ØµØ±\s*([^\s\n\r]+)/i
                    ];
                    
                    for (const pattern of heirsCertPatterns) {
                        const match = text.match(pattern);
                        if (match && match[1]) {
                            data.heirsCertificateNumber = match[1].trim();
                            console.log("ğŸ”— Ø±Ù‚Ù… ØµÙƒ Ø§Ù„Ø­ØµØ± ÙÙŠ Ø§Ù„ÙˆÙƒØ§Ù„Ø©:", data.heirsCertificateNumber);
                            break;
                        }
                    }

                    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
                    const authorities = {
                        sale: /Ø¨ÙŠØ¹|Ø¥ÙØ±Ø§Øº|Ø§Ù„ØªØµØ±Ù|Ù†Ù‚Ù„ Ù…Ù„ÙƒÙŠØ©/i.test(text),
                        receiveMoney: /Ø§Ø³ØªÙ„Ø§Ù…|Ù…Ø¨Ù„Øº|Ø«Ù…Ù†|Ù‚Ø¨Ø¶|ØªØ­ØµÙŠÙ„/i.test(text),
                        signContracts: /ØªÙˆÙ‚ÙŠØ¹|Ø¹Ù‚Ø¯|Ø§ØªÙØ§Ù‚ÙŠØ©|Ø¹Ù‚ÙˆØ¯/i.test(text),
                        disposal: /ØªÙ†Ø§Ø²Ù„|Ø¥Ø¨Ø±Ø§Ø¡|Ø¥Ø®Ù„Ø§Ø¡ Ø·Ø±Ù/i.test(text)
                    };
                    
                    data.authorities = authorities;
                    console.log("âš–ï¸ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©:", authorities);

                    console.log("ğŸ‘¥ Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆÙƒÙ„ÙŠÙ† Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬ÙŠÙ†:", data.principals.length);
                    return data;
                } catch (error) {
                    console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ ØµÙƒ Ø§Ù„ÙˆÙƒØ§Ù„Ø©:", error);
                    return data;
                }
            }
        }

        class DataMatcher {
            constructor() {
                this.results = {
                    heirsMatch: {
                        complete: false,
                        missingHeirs: [],
                        matchedHeirs: [],
                        totalHeirs: 0,
                        percentage: 0
                    },
                    scopeValidation: {
                        certificateMatch: false,
                        deceasedNameMatch: false,
                        details: []
                    },
                    agentValidation: {
                        isHeir: false,
                        hasFinancialAuthority: false,
                        authorities: {},
                        details: []
                    },
                    summary: '',
                    timestamp: null
                };
            }

            matchHeirs(heirsData, poaData) {
                console.log("ğŸ”„ Ø¨Ø¯Ø¡ Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„ÙˆØ±Ø«Ø©");
                
                if (!heirsData || !poaData) {
                    console.error("âŒ Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ÙƒØ§ÙÙŠØ© Ù„Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©");
                    return this.results.heirsMatch;
                }
                
                const heirsIds = heirsData.heirs.map(heir => heir.id);
                const principalIds = poaData.principals.map(principal => principal.id).filter(id => id);
                
                console.log("ğŸ“Š Ø£Ø±Ù‚Ø§Ù… Ù‡ÙˆÙŠØ© Ø§Ù„ÙˆØ±Ø«Ø©:", heirsIds.length);
                console.log("ğŸ“Š Ø£Ø±Ù‚Ø§Ù… Ù‡ÙˆÙŠØ© Ø§Ù„Ù…ÙˆÙƒÙ„ÙŠÙ†:", principalIds.length);
                
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙˆØ±Ø«Ø© Ø§Ù„Ù…ÙÙ‚ÙˆØ¯ÙŠÙ†
                this.results.heirsMatch.missingHeirs = heirsData.heirs.filter(heir => 
                    !principalIds.includes(heir.id)
                );
                
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙˆØ±Ø«Ø© Ø§Ù„Ù…ØªØ·Ø§Ø¨Ù‚ÙŠÙ†
                this.results.heirsMatch.matchedHeirs = heirsData.heirs.filter(heir => 
                    principalIds.includes(heir.id)
                );
                
                this.results.heirsMatch.totalHeirs = heirsData.heirs.length;
                this.results.heirsMatch.complete = this.results.heirsMatch.missingHeirs.length === 0;
                this.results.heirsMatch.percentage = heirsData.heirs.length > 0 
                    ? Math.round((this.results.heirsMatch.matchedHeirs.length / heirsData.heirs.length) * 100)
                    : 0;
                
                console.log("âœ… Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ±Ø«Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚ÙŠÙ†:", this.results.heirsMatch.matchedHeirs.length);
                console.log("âŒ Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ±Ø«Ø© Ø§Ù„Ù…ÙÙ‚ÙˆØ¯ÙŠÙ†:", this.results.heirsMatch.missingHeirs.length);
                console.log("ğŸ“ˆ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„:", this.results.heirsMatch.percentage + "%");
                
                return this.results.heirsMatch;
            }

            validateScope(heirsData, poaData) {
                console.log("ğŸ” Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù†Ø·Ø§Ù‚");
                const details = [];
                
                // Ù…Ø·Ø§Ø¨Ù‚Ø© Ø±Ù‚Ù… ØµÙƒ Ø­ØµØ± Ø§Ù„ÙˆØ±Ø«Ø©
                if (heirsData.documentNumber && poaData.heirsCertificateNumber) {
                    const normalizedHeirsNumber = heirsData.documentNumber.replace(/\s+/g, '');
                    const normalizedPOANumber = poaData.heirsCertificateNumber.replace(/\s+/g, '');
                    const certMatch = normalizedHeirsNumber === normalizedPOANumber;
                    this.results.scopeValidation.certificateMatch = certMatch;
                    
                    details.push({
                        type: 'certificate',
                        label: 'Ù…Ø·Ø§Ø¨Ù‚Ø© Ø±Ù‚Ù… ØµÙƒ Ø§Ù„Ø­ØµØ±',
                        status: certMatch ? 'success' : 'error',
                        message: certMatch 
                            ? `âœ… Ø§Ù„Ø±Ù‚Ù… ${heirsData.documentNumber} Ù…ØªØ·Ø§Ø¨Ù‚`
                            : `âŒ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø© (ØµÙƒ Ø§Ù„Ø­ØµØ±: ${heirsData.documentNumber} â‰  Ø§Ù„ÙˆÙƒØ§Ù„Ø©: ${poaData.heirsCertificateNumber})`
                    });
                } else {
                    const status = heirsData.documentNumber ? 'warning' : 'error';
                    details.push({
                        type: 'certificate',
                        label: 'Ù…Ø·Ø§Ø¨Ù‚Ø© Ø±Ù‚Ù… ØµÙƒ Ø§Ù„Ø­ØµØ±',
                        status: status,
                        message: heirsData.documentNumber 
                            ? `âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ù‚Ù… ØµÙƒ Ø§Ù„Ø­ØµØ± ÙÙŠ Ø§Ù„ÙˆÙƒØ§Ù„Ø© (Ø±Ù‚Ù… Ø§Ù„ØµÙƒ: ${heirsData.documentNumber})`
                            : 'âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ù‚Ù… ØµÙƒ Ø§Ù„Ø­ØµØ±'
                    });
                }
                
                // Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ø³Ù… Ø§Ù„Ù…ØªÙˆÙÙ‰
                if (heirsData.deceased.name && poaData.deceasedName) {
                    const normalizedHeirsName = this.normalizeName(heirsData.deceased.name);
                    const normalizedPOAName = this.normalizeName(poaData.deceasedName);
                    const nameMatch = normalizedHeirsName === normalizedPOAName;
                    this.results.scopeValidation.deceasedNameMatch = nameMatch;
                    
                    details.push({
                        type: 'deceased',
                        label: 'Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ø³Ù… Ø§Ù„Ù…ØªÙˆÙÙ‰',
                        status: nameMatch ? 'success' : 'error',
                        message: nameMatch 
                            ? `âœ… Ø§Ù„Ø§Ø³Ù… "${heirsData.deceased.name}" Ù…ØªØ·Ø§Ø¨Ù‚`
                            : `âŒ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø© (ØµÙƒ Ø§Ù„Ø­ØµØ±: "${heirsData.deceased.name}" â‰  Ø§Ù„ÙˆÙƒØ§Ù„Ø©: "${poaData.deceasedName}")`
                    });
                } else {
                    const status = heirsData.deceased.name ? 'warning' : 'error';
                    details.push({
                        type: 'deceased',
                        label: 'Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ø³Ù… Ø§Ù„Ù…ØªÙˆÙÙ‰',
                        status: status,
                        message: heirsData.deceased.name 
                            ? `âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù…ØªÙˆÙÙ‰ ÙÙŠ Ø§Ù„ÙˆÙƒØ§Ù„Ø© (Ø§Ù„Ø§Ø³Ù…: ${heirsData.deceased.name})`
                            : 'âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù…ØªÙˆÙÙ‰ ÙÙŠ ØµÙƒ Ø§Ù„Ø­ØµØ±'
                    });
                }
                
                this.results.scopeValidation.details = details;
                return this.results.scopeValidation;
            }

            validateAgent(heirsData, poaData) {
                console.log("ğŸ” Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆÙƒÙŠÙ„");
                const details = [];
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙˆÙƒÙŠÙ„ Ù…Ù† Ø§Ù„ÙˆØ±Ø«Ø©
                if (poaData.agent.id) {
                    const isHeir = heirsData.heirs.some(heir => heir.id === poaData.agent.id);
                    this.results.agentValidation.isHeir = isHeir;
                    
                    details.push({
                        type: 'agent_identity',
                        label: 'Ù‡ÙˆÙŠØ© Ø§Ù„ÙˆÙƒÙŠÙ„',
                        status: isHeir ? 'success' : 'info',
                        message: isHeir 
                            ? `âœ… Ø§Ù„ÙˆÙƒÙŠÙ„ ${poaData.agent.name || ''} Ù‡Ùˆ Ø£Ø­Ø¯ Ø§Ù„ÙˆØ±Ø«Ø©`
                            : `â„¹ï¸ Ø§Ù„ÙˆÙƒÙŠÙ„ ${poaData.agent.name || ''} Ù„ÙŠØ³ Ù…Ù† Ø§Ù„ÙˆØ±Ø«Ø©`
                    });
                } else {
                    details.push({
                        type: 'agent_identity',
                        label: 'Ù‡ÙˆÙŠØ© Ø§Ù„ÙˆÙƒÙŠÙ„',
                        status: 'warning',
                        message: poaData.agent.name 
                            ? `âš ï¸ Ø§Ù„ÙˆÙƒÙŠÙ„ ${poaData.agent.name} - Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ù‡ÙˆÙŠØªÙ‡`
                            : 'âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆÙƒÙŠÙ„'
                    });
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©
                this.results.agentValidation.authorities = poaData.authorities;
                this.results.agentValidation.hasFinancialAuthority = 
                    poaData.authorities.sale && poaData.authorities.receiveMoney;
                
                const authoritiesList = [
                    { key: 'sale', label: 'ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹ ÙˆØ§Ù„Ø¥ÙØ±Ø§Øº', emoji: 'ğŸ’°' },
                    { key: 'receiveMoney', label: 'ØµÙ„Ø§Ø­ÙŠØ© Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø¨Ø§Ù„Øº', emoji: 'ğŸ’µ' },
                    { key: 'signContracts', label: 'ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù‚ÙˆØ¯', emoji: 'ğŸ“' },
                    { key: 'disposal', label: 'ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ØªÙ†Ø§Ø²Ù„ ÙˆØ§Ù„Ø¥Ø¨Ø±Ø§Ø¡', emoji: 'ğŸ”„' }
                ];
                
                authoritiesList.forEach(auth => {
                    const hasAuth = poaData.authorities[auth.key];
                    details.push({
                        type: 'authority',
                        label: auth.label,
                        status: hasAuth ? 'success' : 'warning',
                        message: hasAuth 
                            ? `${auth.emoji} âœ… ${auth.label}`
                            : `${auth.emoji} âš ï¸ ${auth.label} ØºÙŠØ± Ù…Ø°ÙƒÙˆØ±Ø© Ø¨ÙˆØ¶ÙˆØ­`
                    });
                });
                
                this.results.agentValidation.details = details;
                return this.results.agentValidation;
            }

            generateSummary(heirsData, poaData) {
                const missingCount = this.results.heirsMatch.missingHeirs.length;
                const totalHeirs = this.results.heirsMatch.totalHeirs;
                const matchedCount = totalHeirs - missingCount;
                
                let summary = '';
                let summaryClass = '';
                
                if (totalHeirs === 0) {
                    summary = 'âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙˆØ±Ø«Ø© ÙÙŠ ØµÙƒ Ø§Ù„Ø­ØµØ±';
                    summaryClass = 'summary-warning';
                } else if (this.results.heirsMatch.complete) {
                    summary = `âœ… ØªÙ… ØªÙˆÙƒÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ±Ø«Ø© (${totalHeirs} ÙˆØ§Ø±Ø«)`;
                    summaryClass = 'summary-success';
                } else {
                    summary = `âš ï¸ ÙŠÙˆØ¬Ø¯ ${missingCount} ÙˆØ±Ø«Ø© Ù„Ù… ÙŠÙˆÙ‚Ø¹ÙˆØ§ Ø§Ù„ÙˆÙƒØ§Ù„Ø©`;
                    summaryClass = 'summary-danger';
                }
                
                if (totalHeirs > 0) {
                    summary += `\nğŸ“Š ${matchedCount}/${totalHeirs} ÙˆØ§Ø±Ø« ØªÙ… ØªÙˆÙƒÙŠÙ„Ù‡Ù…`;
                    summary += `\nğŸ“ˆ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„: ${this.results.heirsMatch.percentage}%`;
                }
                
                if (this.results.scopeValidation.certificateMatch && heirsData.deceased.name) {
                    summary += `\nğŸ”— ØµÙƒ Ø§Ù„ÙˆÙƒØ§Ù„Ø© Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ù„Ù…ØªÙˆÙÙ‰ ${heirsData.deceased.name}`;
                    summary += `\nğŸ“„ Ù…Ø±ØªØ¨Ø· Ø¨ØµÙƒ Ø§Ù„Ø­ØµØ± Ø±Ù‚Ù… ${heirsData.documentNumber || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"}`;
                } else {
                    summary += `\nâš ï¸ ØªÙ†Ø¨ÙŠÙ‡: Ù‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø±Ø¨Ø· Ø§Ù„ØµÙƒÙˆÙƒ`;
                }
                
                if (this.results.agentValidation.hasFinancialAuthority) {
                    summary += `\nâš–ï¸ Ø§Ù„ÙˆÙƒØ§Ù„Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ø§Ù„ÙŠØ© ÙƒØ§Ù…Ù„Ø©`;
                } else {
                    summary += `\nâš ï¸ ØªØ­Ø°ÙŠØ±: Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ù‚Ø¯ ØªÙƒÙˆÙ† Ù†Ø§Ù‚ØµØ©`;
                }
                
                this.results.summary = summary;
                this.results.summaryClass = summaryClass;
                this.results.timestamp = new Date().toLocaleString('ar-SA');
                
                return { summary, summaryClass };
            }

            normalizeName(name) {
                if (!name) return '';
                return name
                    .replace(/[Ø¥Ø£Ø¢Ø§]/g, 'Ø§')
                    .replace(/Ø©/g, 'Ù‡')
                    .replace(/Ù‰/g, 'ÙŠ')
                    .replace(/Ø¦/g, 'ÙŠ')
                    .replace(/Ø¤/g, 'Ùˆ')
                    .replace(/[^Ø§-ÙŠ\s]/g, '')
                    .replace(/\s+/g, ' ')
                    .trim()
                    .toLowerCase();
            }

            getAllResults() {
                return this.results;
            }

            generateReport() {
                const results = this.results;
                const report = `
                    ====================================
                    ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙƒÙŠÙ„ Ø§Ù„ÙˆØ±Ø«Ø©
                    ====================================
                    ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${results.timestamp}
                    
                    ${results.summary}
                    
                    ====== Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ======
                    Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØ±Ø«Ø©: ${results.heirsMatch.totalHeirs}
                    ØªÙ… ØªÙˆÙƒÙŠÙ„Ù‡Ù…: ${results.heirsMatch.matchedHeirs.length}
                    Ù„Ù… ÙŠØªÙ… ØªÙˆÙƒÙŠÙ„Ù‡Ù…: ${results.heirsMatch.missingHeirs.length}
                    Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„: ${results.heirsMatch.percentage}%
                    
                    ====== Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„ÙˆØ±Ø«Ø© ======
                    ${results.heirsMatch.complete ? 'âœ… ØªÙ… ØªÙˆÙƒÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ±Ø«Ø©' : 'âŒ Ù‡Ù†Ø§Ùƒ ÙˆØ±Ø«Ø© Ù„Ù… ÙŠØªÙ… ØªÙˆÙƒÙŠÙ„Ù‡Ù…'}
                    
                    ${results.heirsMatch.missingHeirs.length > 0 ? `
                    Ø§Ù„ÙˆØ±Ø«Ø© Ø§Ù„Ù…ÙÙ‚ÙˆØ¯ÙˆÙ†:
                    ${results.heirsMatch.missingHeirs.map((heir, i) => `${i+1}. ${heir.name} (${heir.id}) - ${heir.relation}`).join('\n')}
                    ` : ''}
                    
                    ====== ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù†Ø·Ø§Ù‚ ======
                    ${results.scopeValidation.details.map(d => d.message).join('\n')}
                    
                    ====== ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆÙƒÙŠÙ„ ======
                    ${results.agentValidation.details.map(d => d.message).join('\n')}
                    
                    ====================================
                    Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                    ====================================
                `;
                
                return report;
            }
        }

        // ==================== Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© ====================
        
        let pdfParser = new PDFParser();
        let dataMatcher = new DataMatcher();
        let heirsData = null;
        let poaData = null;
        let isProcessing = false;

        // ==================== Ø¯ÙˆØ§Ù„ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„ÙØ§Øª ====================

        async function handleFileUpload(inputElement, infoDivId, progressBarId) {
            const file = inputElement.files[0];
            const infoDiv = document.getElementById(infoDivId);
            const progressBar = document.getElementById(progressBarId);
            const progressFill = progressBar.querySelector('.progress-bar');
            
            if (!file) {
                showAlert(infoDiv, 'âŒ Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù', 'warning');
                updateProcessButton();
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù
            if (!file.type.includes('pdf') && !file.name.toLowerCase().endsWith('.pdf')) {
                showAlert(infoDiv, 'âŒ Ø§Ù„Ù…Ù„Ù ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù…Ù† Ù†ÙˆØ¹ PDF', 'danger');
                inputElement.value = '';
                updateProcessButton();
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù (10 MB ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰)
            if (file.size > 10 * 1024 * 1024) {
                showAlert(infoDiv, 'âŒ Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 10 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª)', 'danger');
                inputElement.value = '';
                updateProcessButton();
                return;
            }
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
            progressBar.classList.remove('hidden');
            progressFill.style.width = '0%';
            
            showAlert(infoDiv, 
                `<span class="loading"></span> Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù: ${file.name} (${formatFileSize(file.size)})`,
                'info'
            );
            
            try {
                const text = await pdfParser.extractTextFromPDF(file, (progress) => {
                    progressFill.style.width = `${progress}%`;
                });
                
                // Ø¥Ø®ÙØ§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
                setTimeout(() => {
                    progressBar.classList.add('hidden');
                }, 500);
                
                if (infoDivId === 'heirsInfo') {
                    heirsData = pdfParser.parseHeirsCertificate(text);
                    displayRawData('heirsRawData', heirsData, 'heirs');
                    showAlert(infoDiv, 
                        `âœ… ØªÙ… ØªØ­Ù„ÙŠÙ„ ØµÙƒ Ø­ØµØ± Ø§Ù„ÙˆØ±Ø«Ø© Ø¨Ù†Ø¬Ø§Ø­
                        <br><small>ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${heirsData.heirs.length} ÙˆØ§Ø±Ø«</small>`,
                        'success'
                    );
                } else if (infoDivId === 'poaInfo') {
                    poaData = pdfParser.parsePowerOfAttorney(text);
                    displayRawData('poaRawData', poaData, 'poa');
                    showAlert(infoDiv, 
                        `âœ… ØªÙ… ØªØ­Ù„ÙŠÙ„ ØµÙƒ Ø§Ù„ÙˆÙƒØ§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­
                        <br><small>ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${poaData.principals.length} Ù…ÙˆÙƒÙ„</small>`,
                        'success'
                    );
                }
                
                updateProcessButton();
                
                // ØªØ­ÙÙŠØ² Ø²Ø± Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
                if (heirsData && poaData) {
                    document.getElementById('processBtn').classList.add('pulse');
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù:', error);
                progressBar.classList.add('hidden');
                showAlert(infoDiv, 
                    `âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù PDF
                    <br><small>${error.message || 'ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø­Ù…ÙŠ Ø¨ÙƒÙ„Ù…Ø© Ø³Ø± ÙˆØµØ§Ù„Ø­ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©'}</small>`,
                    'danger'
                );
                inputElement.value = '';
                updateProcessButton();
            }
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Ø¨Ø§ÙŠØª';
            const k = 1024;
            const sizes = ['Ø¨Ø§ÙŠØª', 'Ùƒ.Ø¨', 'Ù….Ø¨', 'Ø¬.Ø¨'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        function showAlert(element, message, type) {
            const alertClass = `alert-${type}`;
            element.innerHTML = `<div class="alert ${alertClass}">${message}</div>`;
        }

        function displayRawData(elementId, data, type) {
            const element = document.getElementById(elementId);
            if (element && data) {
                let formattedData = '';
                
                if (type === 'heirs') {
                    formattedData = `ğŸ“‹ ØµÙƒ Ø­ØµØ± Ø§Ù„ÙˆØ±Ø«Ø©\n`;
                    formattedData += `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n`;
                    formattedData += `ğŸ‘¤ Ø§Ù„Ù…ØªÙˆÙÙ‰: ${data.deceased.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}\n`;
                    formattedData += `ğŸ†” Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© Ø§Ù„Ù…ØªÙˆÙÙ‰: ${data.deceased.id || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}\n`;
                    formattedData += `ğŸ“„ Ø±Ù‚Ù… Ø§Ù„ØµÙƒ: ${data.documentNumber || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}\n\n`;
                    formattedData += `ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙˆØ±Ø«Ø© (${data.heirs.length}):\n`;
                    formattedData += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n`;
                    data.heirs.forEach((heir, index) => {
                        formattedData += `${index + 1}. ${heir.name} (${heir.id}) - ${heir.relation}\n`;
                    });
                } else if (type === 'poa') {
                    formattedData = `ğŸ“‹ ØµÙƒ Ø§Ù„ÙˆÙƒØ§Ù„Ø©\n`;
                    formattedData += `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n`;
                    formattedData += `ğŸ“„ Ø±Ù‚Ù… Ø§Ù„ØµÙƒ: ${data.documentNumber || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}\n`;
                    formattedData += `ğŸ‘¤ Ø§Ù„ÙˆÙƒÙŠÙ„: ${data.agent.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'} (${data.agent.id || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'})\n`;
                    formattedData += `âš°ï¸ Ø§Ø³Ù… Ø§Ù„Ù…ØªÙˆÙÙ‰ ÙÙŠ Ø§Ù„ÙˆÙƒØ§Ù„Ø©: ${data.deceasedName || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}\n`;
                    formattedData += `ğŸ”— Ø±Ù‚Ù… ØµÙƒ Ø§Ù„Ø­ØµØ± ÙÙŠ Ø§Ù„ÙˆÙƒØ§Ù„Ø©: ${data.heirsCertificateNumber || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}\n\n`;
                    formattedData += `ğŸ‘¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆÙƒÙ„ÙŠÙ† (${data.principals.length}):\n`;
                    formattedData += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n`;
                    data.principals.forEach((principal, index) => {
                        formattedData += `${index + 1}. ${principal.name} (${principal.id || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'})\n`;
                    });
                    formattedData += `\nâš–ï¸ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª:\n`;
                    formattedData += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n`;
                    formattedData += `ğŸ’° Ø§Ù„Ø¨ÙŠØ¹ ÙˆØ§Ù„Ø¥ÙØ±Ø§Øº: ${data.authorities.sale ? 'âœ…' : 'âŒ'}\n`;
                    formattedData += `ğŸ’µ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø¨Ø§Ù„Øº: ${data.authorities.receiveMoney ? 'âœ…' : 'âŒ'}\n`;
                    formattedData += `ğŸ“ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù‚ÙˆØ¯: ${data.authorities.signContracts ? 'âœ…' : 'âŒ'}\n`;
                    formattedData += `ğŸ”„ Ø§Ù„ØªÙ†Ø§Ø²Ù„ ÙˆØ§Ù„Ø¥Ø¨Ø±Ø§Ø¡: ${data.authorities.disposal ? 'âœ…' : 'âŒ'}\n`;
                }
                
                element.textContent = formattedData;
            }
        }

        function updateProcessButton() {
            const processBtn = document.getElementById('processBtn');
            const processText = document.getElementById('processText');
            const downloadBtn = document.getElementById('downloadBtn');
            
            if (heirsData && poaData && !isProcessing) {
                processBtn.disabled = false;
                processText.textContent = 'ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚';
                processBtn.classList.remove('pulse');
            } else if (isProcessing) {
                processBtn.disabled = true;
                processText.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';
            } else {
                processBtn.disabled = true;
                processText.textContent = heirsData && !poaData 
                    ? 'ğŸ“‹ Ø§Ù†ØªØ¸Ø± Ø±ÙØ¹ ØµÙƒ Ø§Ù„ÙˆÙƒØ§Ù„Ø©' 
                    : !heirsData && poaData 
                    ? 'ğŸ“„ Ø§Ù†ØªØ¸Ø± Ø±ÙØ¹ ØµÙƒ Ø§Ù„Ø­ØµØ±' 
                    : 'ğŸ“ Ø§Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙÙŠÙ† Ø£ÙˆÙ„Ø§Ù‹';
            }
            
            // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
            if (dataMatcher.results.timestamp) {
                downloadBtn.classList.remove('hidden');
            } else {
                downloadBtn.classList.add('hidden');
            }
        }

        // ==================== Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ====================

        async function processDocuments() {
            if (!heirsData || !poaData || isProcessing) {
                showAlert(document.getElementById('summary'), 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙÙŠÙ† Ø£ÙˆÙ„Ø§Ù‹', 'warning');
                return;
            }
            
            isProcessing = true;
            updateProcessButton();
            
            const processLoading = document.getElementById('processLoading');
            const processBtn = document.getElementById('processBtn');
            processLoading.classList.remove('hidden');
            processBtn.classList.add('shake');
            
            try {
                // Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©
                dataMatcher.matchHeirs(heirsData, poaData);
                dataMatcher.validateScope(heirsData, poaData);
                dataMatcher.validateAgent(heirsData, poaData);
                const { summary, summaryClass } = dataMatcher.generateSummary(heirsData, poaData);
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                displayResults(summary, summaryClass);
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
                setTimeout(() => {
                    if (dataMatcher.results.heirsMatch.complete) {
                        showAlert(document.getElementById('summary'), 
                            'âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„ÙˆÙƒØ§Ù„Ø© ØµØ§Ù„Ø­Ø© Ù„Ù„Ø¨ÙŠØ¹',
                            'success'
                        );
                    }
                }, 1000);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:', error);
                showAlert(document.getElementById('summary'), 
                    `âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: ${error.message}`,
                    'danger'
                );
            } finally {
                isProcessing = false;
                processLoading.classList.add('hidden');
                processBtn.classList.remove('shake');
                updateProcessButton();
                
                // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                setTimeout(() => {
                    document.getElementById('resultsSection').scrollIntoView({ 
                        behavior: 'smooth',
                        block: 'start'
                    });
                }, 300);
            }
        }

        function displayResults(summary, summaryClass) {
            const results = dataMatcher.getAllResults();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ø®Øµ
            const summaryDiv = document.getElementById('summary');
            summaryDiv.className = `summary-card ${summaryClass}`;
            summaryDiv.innerHTML = `
                <h3>ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h3>
                <div class="summary-content">${summary.replace(/\n/g, '<br>')}</div>
                <div style="margin-top: 15px; font-size: 0.9rem; opacity: 0.9;">
                    â° ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ ÙÙŠ: ${results.timestamp}
                </div>
            `;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            document.getElementById('statsGrid').classList.remove('hidden');
            document.getElementById('statTotal').textContent = results.heirsMatch.totalHeirs;
            document.getElementById('statAuthorized').textContent = results.heirsMatch.matchedHeirs.length;
            document.getElementById('statMissing').textContent = results.heirsMatch.missingHeirs.length;
            document.getElementById('statPercentage').textContent = results.heirsMatch.percentage + '%';
            
            // Ø¹Ø±Ø¶ Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„ÙˆØ±Ø«Ø©
            const heirsMatchDiv = document.getElementById('heirsMatchResult');
            if (results.heirsMatch.totalHeirs === 0) {
                heirsMatchDiv.innerHTML = `
                    <div class="alert alert-warning">
                        âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙˆØ±Ø«Ø© ÙÙŠ ØµÙƒ Ø§Ù„Ø­ØµØ±
                        <br><small>Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ù…Ø®ØªÙ„Ù</small>
                    </div>
                `;
            } else if (results.heirsMatch.complete) {
                heirsMatchDiv.innerHTML = `
                    <div class="alert alert-success">
                        âœ… ØªÙ… ØªÙˆÙƒÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ±Ø«Ø©
                        <br><small>${results.heirsMatch.matchedHeirs.length} ÙˆØ§Ø±Ø« ØªÙ… ØªÙˆÙƒÙŠÙ„Ù‡Ù… Ø¨Ù†Ø¬Ø§Ø­</small>
                        <br><br>
                        <strong>Ø§Ù„ÙˆÙƒØ§Ù„Ø© ØµØ§Ù„Ø­Ø© Ù„Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ</strong>
                    </div>
                `;
            } else {
                const missingList = results.heirsMatch.missingHeirs
                    .map(h => `â€¢ <strong>${h.name}</strong> (${h.id}) - ${h.relation}`)
                    .join('<br>');
                
                heirsMatchDiv.innerHTML = `
                    <div class="alert alert-danger">
                        âŒ ÙŠÙˆØ¬Ø¯ ${results.heirsMatch.missingHeirs.length} ÙˆØ±Ø«Ø© Ù„Ù… ÙŠÙˆÙ‚Ø¹ÙˆØ§
                        <br><br>
                        <strong>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙˆØ±Ø«Ø© Ø§Ù„Ù†Ø§Ù‚ØµÙŠÙ†:</strong>
                        <br>${missingList}
                        <br><br>
                        <small>âš ï¸ <strong>Ø§Ù„ÙˆÙƒØ§Ù„Ø© Ù†Ø§Ù‚ØµØ© ÙˆÙ„Ø§ ØªØµÙ„Ø­ Ù„Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ</strong></small>
                    </div>
                `;
            }
            
            // Ø¹Ø±Ø¶ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù†Ø·Ø§Ù‚
            const scopeDiv = document.getElementById('scopeValidationResult');
            const scopeDetails = results.scopeValidation.details
                .map(d => {
                    let className = '';
                    if (d.status === 'success') className = 'status-complete';
                    else if (d.status === 'error') className = 'status-incomplete';
                    else if (d.status === 'warning') className = 'alert alert-warning';
                    else if (d.status === 'info') className = 'alert alert-info';
                    
                    return `<div class="${className}">${d.message}</div>`;
                })
                .join('');
            scopeDiv.innerHTML = scopeDetails || '<div class="alert alert-warning">âš ï¸ Ù„Ù… ØªØªØ­Ù‚Ù‚ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù†Ø·Ø§Ù‚</div>';
            
            // Ø¹Ø±Ø¶ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆÙƒÙŠÙ„
            const agentDiv = document.getElementById('agentValidationResult');
            const agentDetails = results.agentValidation.details
                .map(d => {
                    let className = '';
                    if (d.status === 'success') className = 'status-complete';
                    else if (d.status === 'error') className = 'status-incomplete';
                    else if (d.status === 'warning') className = 'alert alert-warning';
                    else if (d.status === 'info') className = 'alert alert-info';
                    
                    return `<div class="${className}">${d.message}</div>`;
                })
                .join('');
            agentDiv.innerHTML = agentDetails || '<div class="alert alert-warning">âš ï¸ Ù„Ù… ØªØªØ­Ù‚Ù‚ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆÙƒÙŠÙ„</div>';
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ
            displayDetailsTable();
        }

        function displayDetailsTable() {
            const tableBody = document.getElementById('tableBody');
            const results = dataMatcher.getAllResults();
            
            let html = '';
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØªÙˆÙÙ‰
            if (heirsData.deceased.name) {
                html += `
                    <tr style="background: linear-gradient(90deg, #f8fafc, #f1f5f9);">
                        <td><strong>${heirsData.deceased.name}</strong></td>
                        <td>${heirsData.deceased.id || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                        <td><em>ğŸ‘‘ Ø§Ù„Ù…ØªÙˆÙÙ‰</em></td>
                        <td><div class="status-warning">âš°ï¸ Ù…ØªÙˆÙÙ‰</div></td>
                    </tr>
                `;
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ±Ø«Ø©
            heirsData.heirs.forEach(heir => {
                const isAuthorized = results.heirsMatch.matchedHeirs.some(h => h.id === heir.id);
                
                html += `
                    <tr>
                        <td>${heir.name}</td>
                        <td>${heir.id}</td>
                        <td>${heir.relation}</td>
                        <td>
                            <div class="${isAuthorized ? 'status-complete' : 'status-incomplete'}">
                                ${isAuthorized ? 'âœ… Ù…ÙƒØªÙ…Ù„' : 'âŒ Ù†Ø§Ù‚Øµ'}
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆÙƒÙŠÙ„
            if (poaData.agent.name || poaData.agent.id) {
                const isHeir = results.agentValidation.isHeir;
                html += `
                    <tr style="background: linear-gradient(90deg, #f0f9ff, #e0f2fe);">
                        <td><strong>${poaData.agent.name || 'Ø§Ù„ÙˆÙƒÙŠÙ„'}</strong></td>
                        <td>${poaData.agent.id || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                        <td><strong>ğŸ‘¤ ÙˆÙƒÙŠÙ„</strong> ${isHeir ? '(Ø£Ø­Ø¯ Ø§Ù„ÙˆØ±Ø«Ø©)' : ''}</td>
                        <td><div class="status-complete">âœ… Ù…ÙÙˆØ¶</div></td>
                    </tr>
                `;
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆÙƒÙ„ÙŠÙ† Ø§Ù„Ø¥Ø¶Ø§ÙÙŠÙŠÙ† (ØºÙŠØ± Ø§Ù„ÙˆØ±Ø«Ø©)
            const nonHeirPrincipals = poaData.principals.filter(principal => 
                !heirsData.heirs.some(heir => heir.id === principal.id) &&
                (!poaData.agent.id || principal.id !== poaData.agent.id)
            );
            
            nonHeirPrincipals.forEach(principal => {
                html += `
                    <tr style="background-color: #fff7ed;">
                        <td>${principal.name}</td>
                        <td>${principal.id || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                        <td>ğŸ‘¥ Ù…ÙˆÙƒÙ„ Ø¥Ø¶Ø§ÙÙŠ</td>
                        <td><div class="status-complete">âœ… Ù…ÙÙˆØ¶</div></td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html || `
                <tr>
                    <td colspan="4" style="text-align: center; padding: 40px; color: #94a3b8;">
                        âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§
                    </td>
                </tr>
            `;
        }

        // ==================== ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¶Ø§ÙÙŠØ© ====================

        function downloadReport() {
            const results = dataMatcher.getAllResults();
            if (!results.timestamp) {
                alert('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„ØªØ­Ù…ÙŠÙ„Ù‡Ø§');
                return;
            }
            
            const report = dataMatcher.generateReport();
            const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ØªÙ‚Ø±ÙŠØ±_ØªÙˆÙƒÙŠÙ„_Ø§Ù„ÙˆØ±Ø«Ø©_${new Date().toISOString().slice(0,10)}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø§Ù„ØªØ­Ù…ÙŠÙ„
            const downloadBtn = document.getElementById('downloadBtn');
            const originalText = downloadBtn.innerHTML;
            downloadBtn.innerHTML = 'âœ… ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„';
            downloadBtn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
            
            setTimeout(() => {
                downloadBtn.innerHTML = originalText;
                downloadBtn.style.background = '';
            }, 2000);
        }

        function resetAll() {
            if (isProcessing) {
                if (!confirm('Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„ÙØ§ØªØŒ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø¥Ù„ØºØ§Ø¡ØŸ')) {
                    return;
                }
                isProcessing = false;
            }
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            heirsData = null;
            poaData = null;
            dataMatcher = new DataMatcher();
            pdfParser = new PDFParser();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            document.getElementById('heirsFile').value = '';
            document.getElementById('poaFile').value = '';
            
            document.getElementById('heirsInfo').innerHTML = `
                <div class="file-name">Ù„Ù… ÙŠØªÙ… Ø±ÙØ¹ Ù…Ù„Ù Ø¨Ø¹Ø¯</div>
                <div class="file-size">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: 10 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª</div>
            `;
            
            document.getElementById('poaInfo').innerHTML = `
                <div class="file-name">Ù„Ù… ÙŠØªÙ… Ø±ÙØ¹ Ù…Ù„Ù Ø¨Ø¹Ø¯</div>
                <div class="file-size">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: 10 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª</div>
            `;
            
            document.getElementById('heirsProgress').classList.add('hidden');
            document.getElementById('poaProgress').classList.add('hidden');
            
            document.getElementById('summary').className = 'summary-card';
            document.getElementById('summary').innerHTML = `
                <h3>ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h3>
                <div class="summary-content">Ù‚Ù… Ø¨Ø±ÙØ¹ Ù…Ù„ÙÙŠ PDF (ØµÙƒ Ø­ØµØ± Ø§Ù„ÙˆØ±Ø«Ø© ÙˆØµÙƒ Ø§Ù„ÙˆÙƒØ§Ù„Ø©) Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</div>
            `;
            
            document.getElementById('statsGrid').classList.add('hidden');
            
            document.getElementById('heirsMatchResult').innerHTML = 'Ø§Ù†ØªØ¸Ø± Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª...';
            document.getElementById('scopeValidationResult').innerHTML = 'Ø§Ù†ØªØ¸Ø± Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª...';
            document.getElementById('agentValidationResult').innerHTML = 'Ø§Ù†ØªØ¸Ø± Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª...';
            
            document.getElementById('tableBody').innerHTML = `
                <tr>
                    <td colspan="4" style="text-align: center; padding: 40px; color: #94a3b8;">
                        â³ Ù„Ù… ÙŠØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ø¹Ø¯
                    </td>
                </tr>
            `;
            
            document.getElementById('heirsRawData').textContent = 'Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ù…Ø­ØªÙˆÙ‰ ØµÙƒ Ø­ØµØ± Ø§Ù„ÙˆØ±Ø«Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø±ÙØ¹...';
            document.getElementById('poaRawData').textContent = 'Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ù…Ø­ØªÙˆÙ‰ ØµÙƒ Ø§Ù„ÙˆÙƒØ§Ù„Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø±ÙØ¹...';
            
            document.getElementById('processLoading').classList.add('hidden');
            document.getElementById('downloadBtn').classList.add('hidden');
            document.getElementById('processBtn').classList.remove('pulse', 'shake');
            
            updateProcessButton();
            
            // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ø£Ø¹Ù„Ù‰
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø§Ù„Ø¥Ø¹Ø§Ø¯Ø©
            const resetBtn = document.getElementById('resetBtn');
            const originalText = resetBtn.innerHTML;
            resetBtn.innerHTML = 'âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¹Ø§Ø¯Ø©';
            resetBtn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
            
            setTimeout(() => {
                resetBtn.innerHTML = originalText;
                resetBtn.style.background = '';
            }, 1500);
        }

        // ==================== Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ====================

        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙƒÙŠÙ„ Ø§Ù„ÙˆØ±Ø«Ø©');
            updateProcessButton();
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ù„Ø£Ø®Ø·Ø§Ø¡
            window.addEventListener('error', function(e) {
                console.error('ğŸ’¥ Ø®Ø·Ø£ Ø¹Ø§Ù…:', e.error);
                showAlert(document.getElementById('summary'), 
                    'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.',
                    'danger'
                );
            });
            
            // Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨
            setTimeout(() => {
                console.log('ğŸ’¡ ØªÙ„Ù…ÙŠØ­: ÙŠÙ…ÙƒÙ†Ùƒ Ø±ÙØ¹ Ù…Ù„ÙÙŠ PDF Ù„Ù„Ø¨Ø¯Ø¡ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚');
            }, 1000);
        });

        // ==================== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ====================

        function simulateFileUpload() {
            // Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
            if (!heirsData && !poaData) {
                alert('ğŸ”§ Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙÙ‚Ø·\n\nØ³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©');
                
                // Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
                heirsData = {
                    deceased: { 
                        name: "ØµØ§Ù„Ø­ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø«ÙŠÙ…ÙŠÙ†",
                        id: "1012345678"
                    },
                    heirs: [
                        { name: "Ù†Ø§ØµØ± ØµØ§Ù„Ø­ Ø§Ù„Ø¹Ø«ÙŠÙ…ÙŠÙ†", id: "1122334455", relation: "Ø§Ø¨Ù†" },
                        { name: "ÙÙ‡Ø¯ ØµØ§Ù„Ø­ Ø§Ù„Ø¹Ø«ÙŠÙ…ÙŠÙ†", id: "2233445566", relation: "Ø§Ø¨Ù†" },
                        { name: "Ø³Ø§Ø±Ø© ØµØ§Ù„Ø­ Ø§Ù„Ø¹Ø«ÙŠÙ…ÙŠÙ†", id: "3344556677", relation: "Ø§Ø¨Ù†Ø©" },
                        { name: "Ù…Ù†ÙŠØ±Ø© ØµØ§Ù„Ø­ Ø§Ù„Ø¹Ø«ÙŠÙ…ÙŠÙ†", id: "4455667788", relation: "Ø§Ø¨Ù†Ø©" },
                        { name: "Ù…ÙˆØ¶ÙŠ ØµØ§Ù„Ø­ Ø§Ù„Ø¹Ø«ÙŠÙ…ÙŠÙ†", id: "5566778899", relation: "Ø²ÙˆØ¬Ø©" }
                    ],
                    documentNumber: "1445/12345"
                };
                
                poaData = {
                    principals: [
                        { name: "Ù†Ø§ØµØ± ØµØ§Ù„Ø­ Ø§Ù„Ø¹Ø«ÙŠÙ…ÙŠÙ†", id: "1122334455" },
                        { name: "ÙÙ‡Ø¯ ØµØ§Ù„Ø­ Ø§Ù„Ø¹Ø«ÙŠÙ…ÙŠÙ†", id: "2233445566" },
                        { name: "Ø³Ø§Ø±Ø© ØµØ§Ù„Ø­ Ø§Ù„Ø¹Ø«ÙŠÙ…ÙŠÙ†", id: "3344556677" },
                        { name: "Ù…Ù†ÙŠØ±Ø© ØµØ§Ù„Ø­ Ø§Ù„Ø¹Ø«ÙŠÙ…ÙŠÙ†", id: "4455667788" },
                        { name: "Ù…ÙˆØ¶ÙŠ ØµØ§Ù„Ø­ Ø§Ù„Ø¹Ø«ÙŠÙ…ÙŠÙ†", id: "5566778899" }
                    ],
                    agent: { 
                        name: "Ù†Ø§ØµØ± ØµØ§Ù„Ø­ Ø§Ù„Ø¹Ø«ÙŠÙ…ÙŠÙ†",
                        id: "1122334455"
                    },
                    documentNumber: "526/01/2026",
                    deceasedName: "ØµØ§Ù„Ø­ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø«ÙŠÙ…ÙŠÙ†",
                    heirsCertificateNumber: "1445/12345",
                    authorities: {
                        sale: true,
                        receiveMoney: true,
                        signContracts: true,
                        disposal: true
                    }
                };
                
                displayRawData('heirsRawData', heirsData, 'heirs');
                displayRawData('poaRawData', poaData, 'poa');
                
                document.getElementById('heirsInfo').innerHTML = `
                    <div class="alert alert-success">
                        âœ… ØªÙ… ØªØ­Ù„ÙŠÙ„ ØµÙƒ Ø­ØµØ± Ø§Ù„ÙˆØ±Ø«Ø© (Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©)
                        <br><small>ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ 5 ÙˆØ±Ø«Ø©</small>
                    </div>
                `;
                
                document.getElementById('poaInfo').innerHTML = `
                    <div class="alert alert-success">
                        âœ… ØªÙ… ØªØ­Ù„ÙŠÙ„ ØµÙƒ Ø§Ù„ÙˆÙƒØ§Ù„Ø© (Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©)
                        <br><small>ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ 5 Ù…ÙˆÙƒÙ„ÙŠÙ†</small>
                    </div>
                `;
                
                updateProcessButton();
                document.getElementById('processBtn').classList.add('pulse');
            }
        }

        // Ø§Ø®ØªØµØ§Ø± Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'T') {
                simulateFileUpload();
            }
        });
    </script>
</body>
</html>
